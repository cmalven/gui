var St=Object.defineProperty;var wt=(L,O,U)=>O in L?St(L,O,{enumerable:!0,configurable:!0,writable:!0,value:U}):L[O]=U;var g=(L,O,U)=>(wt(L,typeof O!="symbol"?O+"":O,U),U);(function(L,O){typeof exports=="object"&&typeof module!="undefined"?module.exports=O():typeof define=="function"&&define.amd?define(O):(L=typeof globalThis!="undefined"?globalThis:L||self,L.Gui=O())})(this,function(){"use strict";function L(o){if(!!o&&typeof window!="undefined"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=o,document.head.appendChild(e),o}}function O(o,e){var n=o.__state.conversionName.toString(),i=Math.round(o.r),s=Math.round(o.g),u=Math.round(o.b),t=o.a,r=Math.round(o.h),a=o.s.toFixed(1),l=o.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var f=o.hex.toString(16);f.length<6;)f="0"+f;return"#"+f}else{if(n==="CSS_RGB")return"rgb("+i+","+s+","+u+")";if(n==="CSS_RGBA")return"rgba("+i+","+s+","+u+","+t+")";if(n==="HEX")return"0x"+o.hex.toString(16);if(n==="RGB_ARRAY")return"["+i+","+s+","+u+"]";if(n==="RGBA_ARRAY")return"["+i+","+s+","+u+","+t+"]";if(n==="RGB_OBJ")return"{r:"+i+",g:"+s+",b:"+u+"}";if(n==="RGBA_OBJ")return"{r:"+i+",g:"+s+",b:"+u+",a:"+t+"}";if(n==="HSV_OBJ")return"{h:"+r+",s:"+a+",v:"+l+"}";if(n==="HSVA_OBJ")return"{h:"+r+",s:"+a+",v:"+l+",a:"+t+"}"}return"unknown format"}var U=Array.prototype.forEach,ne=Array.prototype.slice,h={BREAK:{},extend:function(e){return this.each(ne.call(arguments,1),function(n){var i=this.isObject(n)?Object.keys(n):[];i.forEach(function(s){this.isUndefined(n[s])||(e[s]=n[s])}.bind(this))},this),e},defaults:function(e){return this.each(ne.call(arguments,1),function(n){var i=this.isObject(n)?Object.keys(n):[];i.forEach(function(s){this.isUndefined(e[s])&&(e[s]=n[s])}.bind(this))},this),e},compose:function(){var e=ne.call(arguments);return function(){for(var n=ne.call(arguments),i=e.length-1;i>=0;i--)n=[e[i].apply(this,n)];return n[0]}},each:function(e,n,i){if(!!e){if(U&&e.forEach&&e.forEach===U)e.forEach(n,i);else if(e.length===e.length+0){var s=void 0,u=void 0;for(s=0,u=e.length;s<u;s++)if(s in e&&n.call(i,e[s],s)===this.BREAK)return}else for(var t in e)if(n.call(i,e[t],t)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,n,i){var s=void 0;return function(){var u=this,t=arguments;function r(){s=null,i||e.apply(u,t)}var a=i||!s;clearTimeout(s),s=setTimeout(r,n),a&&e.apply(u,t)}},toArray:function(e){return e.toArray?e.toArray():ne.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(o){function e(n){return o.apply(this,arguments)}return e.toString=function(){return o.toString()},e}(function(o){return isNaN(o)}),isArray:Array.isArray||function(o){return o.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},Xe=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:O},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:O},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:O},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:O}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],ie=void 0,le=void 0,he=function(){le=!1;var e=arguments.length>1?h.toArray(arguments):arguments[0];return h.each(Xe,function(n){if(n.litmus(e))return h.each(n.conversions,function(i,s){if(ie=i.read(e),le===!1&&ie!==!1)return le=ie,ie.conversionName=s,ie.conversion=i,h.BREAK}),h.BREAK}),le},Ie=void 0,de={hsv_to_rgb:function(e,n,i){var s=Math.floor(e/60)%6,u=e/60-Math.floor(e/60),t=i*(1-n),r=i*(1-u*n),a=i*(1-(1-u)*n),l=[[i,a,t],[r,i,t],[t,i,a],[t,r,i],[a,t,i],[i,t,r]][s];return{r:l[0]*255,g:l[1]*255,b:l[2]*255}},rgb_to_hsv:function(e,n,i){var s=Math.min(e,n,i),u=Math.max(e,n,i),t=u-s,r=void 0,a=void 0;if(u!==0)a=t/u;else return{h:NaN,s:0,v:0};return e===u?r=(n-i)/t:n===u?r=2+(i-e)/t:r=4+(e-n)/t,r/=6,r<0&&(r+=1),{h:r*360,s:a,v:u/255}},rgb_to_hex:function(e,n,i){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,n),s=this.hex_with_component(s,0,i),s},component_from_hex:function(e,n){return e>>n*8&255},hex_with_component:function(e,n,i){return i<<(Ie=n*8)|e&~(255<<Ie)}},je=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},H=function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")},G=function(){function o(e,n){for(var i=0;i<n.length;i++){var s=n[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,i){return n&&o(e.prototype,n),i&&o(e,i),e}}(),$=function o(e,n,i){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(s===void 0){var u=Object.getPrototypeOf(e);return u===null?void 0:o(u,n,i)}else{if("value"in s)return s.value;var t=s.get;return t===void 0?void 0:t.call(i)}},Y=function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)},K=function(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:o},k=function(){function o(){if(H(this,o),this.__state=he.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return G(o,[{key:"toString",value:function(){return O(this)}},{key:"toHexString",value:function(){return O(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),o}();function _e(o,e,n){Object.defineProperty(o,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(k.recalculateRGB(this,e,n),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(k.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=s}})}function pe(o,e){Object.defineProperty(o,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(k.recalculateHSV(this),this.__state[e])},set:function(i){this.__state.space!=="HSV"&&(k.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=i}})}k.recalculateRGB=function(o,e,n){if(o.__state.space==="HEX")o.__state[e]=de.component_from_hex(o.__state.hex,n);else if(o.__state.space==="HSV")h.extend(o.__state,de.hsv_to_rgb(o.__state.h,o.__state.s,o.__state.v));else throw new Error("Corrupted color state")},k.recalculateHSV=function(o){var e=de.rgb_to_hsv(o.r,o.g,o.b);h.extend(o.__state,{s:e.s,v:e.v}),h.isNaN(e.h)?h.isUndefined(o.__state.h)&&(o.__state.h=0):o.__state.h=e.h},k.COMPONENTS=["r","g","b","h","s","v","hex","a"],_e(k.prototype,"r",2),_e(k.prototype,"g",1),_e(k.prototype,"b",0),pe(k.prototype,"h"),pe(k.prototype,"s"),pe(k.prototype,"v"),Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(k.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=de.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var J=function(){function o(e,n){H(this,o),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return G(o,[{key:"onChange",value:function(n){return this.__onChange=n,this}},{key:"onFinishChange",value:function(n){return this.__onFinishChange=n,this}},{key:"setValue",value:function(n){return this.object[this.property]=n,this.__onChange&&this.__onChange.call(this,n),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),o}(),Je={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Te={};h.each(Je,function(o,e){h.each(o,function(n){Te[n]=e})});var Qe=/(\d+(\.\d+)?)px/;function B(o){if(o==="0"||h.isUndefined(o))return 0;var e=o.match(Qe);return h.isNull(e)?0:parseFloat(e[1])}var d={makeSelectable:function(e,n){e===void 0||e.style===void 0||(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,i){var s=i,u=n;h.isUndefined(u)&&(u=!0),h.isUndefined(s)&&(s=!0),e.style.position="absolute",u&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,i,s){var u=i||{},t=Te[n];if(!t)throw new Error("Event type "+n+" not supported.");var r=document.createEvent(t);switch(t){case"MouseEvents":{var a=u.x||u.clientX||0,l=u.y||u.clientY||0;r.initMouseEvent(n,u.bubbles||!1,u.cancelable||!0,window,u.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var f=r.initKeyboardEvent||r.initKeyEvent;h.defaults(u,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),f(n,u.bubbles||!1,u.cancelable,window,u.ctrlKey,u.altKey,u.shiftKey,u.metaKey,u.keyCode,u.charCode);break}default:{r.initEvent(n,u.bubbles||!1,u.cancelable||!0);break}}h.defaults(r,s),e.dispatchEvent(r)},bind:function(e,n,i,s){var u=s||!1;return e.addEventListener?e.addEventListener(n,i,u):e.attachEvent&&e.attachEvent("on"+n,i),d},unbind:function(e,n,i,s){var u=s||!1;return e.removeEventListener?e.removeEventListener(n,i,u):e.detachEvent&&e.detachEvent("on"+n,i),d},addClass:function(e,n){if(e.className===void 0)e.className=n;else if(e.className!==n){var i=e.className.split(/ +/);i.indexOf(n)===-1&&(i.push(n),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var i=e.className.split(/ +/),s=i.indexOf(n);s!==-1&&(i.splice(s,1),e.className=i.join(" "))}else e.className=void 0;return d},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return B(n["border-left-width"])+B(n["border-right-width"])+B(n["padding-left"])+B(n["padding-right"])+B(n.width)},getHeight:function(e){var n=getComputedStyle(e);return B(n["border-top-width"])+B(n["border-bottom-width"])+B(n["padding-top"])+B(n["padding-bottom"])+B(n.height)},getOffset:function(e){var n=e,i={left:0,top:0};if(n.offsetParent)do i.left+=n.offsetLeft,i.top+=n.offsetTop,n=n.offsetParent;while(n);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Ne=function(o){Y(e,o);function e(n,i){H(this,e);var s=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i)),u=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function t(){u.setValue(!u.__prev)}return d.bind(s.__checkbox,"change",t,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return G(e,[{key:"setValue",value:function(i){var s=$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(J),Ze=function(o){Y(e,o);function e(n,i,s){H(this,e);var u=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i)),t=s,r=u;if(u.__select=document.createElement("select"),h.isArray(t)){var a={};h.each(t,function(l){a[l]=l}),t=a}return h.each(t,function(l,f){var c=document.createElement("option");c.innerHTML=f,c.setAttribute("value",l),r.__select.appendChild(c)}),u.updateDisplay(),d.bind(u.__select,"change",function(){var l=this.options[this.selectedIndex].value;r.setValue(l)}),u.domElement.appendChild(u.__select),u}return G(e,[{key:"setValue",value:function(i){var s=$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return d.isActive(this.__select)?this:(this.__select.value=this.getValue(),$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(J),et=function(o){Y(e,o);function e(n,i){H(this,e);var s=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i)),u=s;function t(){u.setValue(u.__input.value)}function r(){u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),d.bind(s.__input,"keyup",t),d.bind(s.__input,"change",t),d.bind(s.__input,"blur",r),d.bind(s.__input,"keydown",function(a){a.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return G(e,[{key:"updateDisplay",value:function(){return d.isActive(this.__input)||(this.__input.value=this.getValue()),$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(J);function Re(o){var e=o.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Oe=function(o){Y(e,o);function e(n,i,s){H(this,e);var u=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i)),t=s||{};return u.__min=t.min,u.__max=t.max,u.__step=t.step,h.isUndefined(u.__step)?u.initialValue===0?u.__impliedStep=1:u.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(u.initialValue))/Math.LN10))/10:u.__impliedStep=u.__step,u.__precision=Re(u.__impliedStep),u}return G(e,[{key:"setValue",value:function(i){var s=i;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!=0&&(s=Math.round(s/this.__step)*this.__step),$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=Re(i),this}}]),e}(J);function tt(o,e){var n=Math.pow(10,e);return Math.round(o*n)/n}var ce=function(o){Y(e,o);function e(n,i,s){H(this,e);var u=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i,s));u.__truncationSuspended=!1;var t=u,r=void 0;function a(){var E=parseFloat(t.__input.value);h.isNaN(E)||t.setValue(E)}function l(){t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}function f(){l()}function c(E){var v=r-E.clientY;t.setValue(t.getValue()+v*t.__impliedStep),r=E.clientY}function p(){d.unbind(window,"mousemove",c),d.unbind(window,"mouseup",p),l()}function y(E){d.bind(window,"mousemove",c),d.bind(window,"mouseup",p),r=E.clientY}return u.__input=document.createElement("input"),u.__input.setAttribute("type","text"),d.bind(u.__input,"change",a),d.bind(u.__input,"blur",f),d.bind(u.__input,"mousedown",y),d.bind(u.__input,"keydown",function(E){E.keyCode===13&&(t.__truncationSuspended=!0,this.blur(),t.__truncationSuspended=!1,l())}),u.updateDisplay(),u.domElement.appendChild(u.__input),u}return G(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():tt(this.getValue(),this.__precision),$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Oe);function ke(o,e,n,i,s){return i+(s-i)*((o-e)/(n-e))}var me=function(o){Y(e,o);function e(n,i,s,u,t){H(this,e);var r=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i,{min:s,max:u,step:t})),a=r;r.__background=document.createElement("div"),r.__foreground=document.createElement("div"),d.bind(r.__background,"mousedown",l),d.bind(r.__background,"touchstart",p),d.addClass(r.__background,"slider"),d.addClass(r.__foreground,"slider-fg");function l(v){document.activeElement.blur(),d.bind(window,"mousemove",f),d.bind(window,"mouseup",c),f(v)}function f(v){v.preventDefault();var M=a.__background.getBoundingClientRect();return a.setValue(ke(v.clientX,M.left,M.right,a.__min,a.__max)),!1}function c(){d.unbind(window,"mousemove",f),d.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function p(v){v.touches.length===1&&(d.bind(window,"touchmove",y),d.bind(window,"touchend",E),y(v))}function y(v){var M=v.touches[0].clientX,N=a.__background.getBoundingClientRect();a.setValue(ke(M,N.left,N.right,a.__min,a.__max))}function E(){d.unbind(window,"touchmove",y),d.unbind(window,"touchend",E),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return r.updateDisplay(),r.__background.appendChild(r.__foreground),r.domElement.appendChild(r.__background),r}return G(e,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=i*100+"%",$(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Oe),De=function(o){Y(e,o);function e(n,i,s){H(this,e);var u=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i)),t=u;return u.__button=document.createElement("div"),u.__button.innerHTML=s===void 0?"Fire":s,d.bind(u.__button,"click",function(r){return r.preventDefault(),t.fire(),!1}),d.addClass(u.__button,"button"),u.domElement.appendChild(u.__button),u}return G(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(J),ge=function(o){Y(e,o);function e(n,i){H(this,e);var s=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,i));s.__color=new k(s.getValue()),s.__temp=new k(0);var u=s;s.domElement=document.createElement("div"),d.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",d.bind(s.__input,"keydown",function(v){v.keyCode===13&&c.call(this)}),d.bind(s.__input,"blur",c),d.bind(s.__selector,"mousedown",function(){d.addClass(this,"drag").bind(window,"mouseup",function(){d.removeClass(u.__selector,"drag")})}),d.bind(s.__selector,"touchstart",function(){d.addClass(this,"drag").bind(window,"touchend",function(){d.removeClass(u.__selector,"drag")})});var t=document.createElement("div");h.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),h.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),h.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),h.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),h.extend(t.style,{width:"100%",height:"100%",background:"none"}),Pe(t,"top","rgba(0,0,0,0)","#000"),h.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),it(s.__hue_field),h.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),d.bind(s.__saturation_field,"mousedown",r),d.bind(s.__saturation_field,"touchstart",r),d.bind(s.__field_knob,"mousedown",r),d.bind(s.__field_knob,"touchstart",r),d.bind(s.__hue_field,"mousedown",a),d.bind(s.__hue_field,"touchstart",a);function r(v){y(v),d.bind(window,"mousemove",y),d.bind(window,"touchmove",y),d.bind(window,"mouseup",l),d.bind(window,"touchend",l)}function a(v){E(v),d.bind(window,"mousemove",E),d.bind(window,"touchmove",E),d.bind(window,"mouseup",f),d.bind(window,"touchend",f)}function l(){d.unbind(window,"mousemove",y),d.unbind(window,"touchmove",y),d.unbind(window,"mouseup",l),d.unbind(window,"touchend",l),p()}function f(){d.unbind(window,"mousemove",E),d.unbind(window,"touchmove",E),d.unbind(window,"mouseup",f),d.unbind(window,"touchend",f),p()}function c(){var v=he(this.value);v!==!1?(u.__color.__state=v,u.setValue(u.__color.toOriginal())):this.value=u.__color.toString()}function p(){u.__onFinishChange&&u.__onFinishChange.call(u,u.__color.toOriginal())}s.__saturation_field.appendChild(t),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function y(v){v.type.indexOf("touch")===-1&&v.preventDefault();var M=u.__saturation_field.getBoundingClientRect(),N=v.touches&&v.touches[0]||v,F=N.clientX,V=N.clientY,W=(F-M.left)/(M.right-M.left),q=1-(V-M.top)/(M.bottom-M.top);return q>1?q=1:q<0&&(q=0),W>1?W=1:W<0&&(W=0),u.__color.v=q,u.__color.s=W,u.setValue(u.__color.toOriginal()),!1}function E(v){v.type.indexOf("touch")===-1&&v.preventDefault();var M=u.__hue_field.getBoundingClientRect(),N=v.touches&&v.touches[0]||v,F=N.clientY,V=1-(F-M.top)/(M.bottom-M.top);return V>1?V=1:V<0&&(V=0),u.__color.h=V*360,u.setValue(u.__color.toOriginal()),!1}return s}return G(e,[{key:"updateDisplay",value:function(){var i=he(this.getValue());if(i!==!1){var s=!1;h.each(k.COMPONENTS,function(r){if(!h.isUndefined(i[r])&&!h.isUndefined(this.__color.__state[r])&&i[r]!==this.__color.__state[r])return s=!0,{}},this),s&&h.extend(this.__color.__state,i)}h.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var u=this.__color.v<.5||this.__color.s>.5?255:0,t=255-u;h.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+u+","+u+","+u+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Pe(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),h.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+u+","+u+","+u+")",textShadow:this.__input_textShadow+"rgba("+t+","+t+","+t+",.7)"})}}]),e}(J),nt=["-moz-","-o-","-webkit-","-ms-",""];function Pe(o,e,n,i){o.style.background="",h.each(nt,function(s){o.style.cssText+="background: "+s+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "})}function it(o){o.style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var rt={load:function(e,n){var i=n||document,s=i.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,i.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,n){var i=n||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var u=i.getElementsByTagName("head")[0];try{u.appendChild(s)}catch{}}},ot=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,st=function(e,n){var i=e[n];return h.isArray(arguments[2])||h.isObject(arguments[2])?new Ze(e,n,arguments[2]):h.isNumber(i)?h.isNumber(arguments[2])&&h.isNumber(arguments[3])?h.isNumber(arguments[4])?new me(e,n,arguments[2],arguments[3],arguments[4]):new me(e,n,arguments[2],arguments[3]):h.isNumber(arguments[4])?new ce(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ce(e,n,{min:arguments[2],max:arguments[3]}):h.isString(i)?new et(e,n):h.isFunction(i)?new De(e,n,""):h.isBoolean(i)?new Ne(e,n):null};function at(o){setTimeout(o,1e3/60)}var ut=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||at,lt=function(){function o(){H(this,o),this.backgroundElement=document.createElement("div"),h.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),d.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),h.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;d.bind(this.backgroundElement,"click",function(){e.hide()})}return G(o,[{key:"show",value:function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),h.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var n=this,i=function s(){n.domElement.style.display="none",n.backgroundElement.style.display="none",d.unbind(n.domElement,"webkitTransitionEnd",s),d.unbind(n.domElement,"transitionend",s),d.unbind(n.domElement,"oTransitionEnd",s)};d.bind(this.domElement,"webkitTransitionEnd",i),d.bind(this.domElement,"transitionend",i),d.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"}}]),o}(),dt=L(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);rt.inject(dt);var Le="dg",He=72,Ge=20,re="Default",oe=function(){try{return!!window.localStorage}catch{return!1}}(),se=void 0,Be=!0,Z=void 0,ve=!1,Fe=[],A=function o(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),d.addClass(this.domElement,Le),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=h.defaults(i,{closeOnTop:!1,autoPlace:!0,width:o.DEFAULT_WIDTH}),i=h.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),h.isUndefined(i.load)?i.load={preset:re}:i.preset&&(i.load.preset=i.preset),h.isUndefined(i.parent)&&i.hideable&&Fe.push(this),i.resizable=h.isUndefined(i.parent)&&i.resizable,i.autoPlace&&h.isUndefined(i.scrollable)&&(i.scrollable=!0);var s=oe&&localStorage.getItem(ee(this,"isLocal"))==="true",u=void 0,t=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(p){n.parent?n.getRoot().preset=p:i.load.preset=p,_t(this),n.revert()}},width:{get:function(){return i.width},set:function(p){i.width=p,Se(n,p)}},name:{get:function(){return i.name},set:function(p){i.name=p,t&&(t.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(p){i.closed=p,i.closed?d.addClass(n.__ul,o.CLASS_CLOSED):d.removeClass(n.__ul,o.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=p?o.TEXT_OPEN:o.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return s},set:function(p){oe&&(s=p,p?d.bind(window,"unload",u):d.unbind(window,"unload",u),localStorage.setItem(ee(n,"isLocal"),p))}}}),h.isUndefined(i.parent)){if(this.closed=i.closed||!1,d.addClass(this.domElement,o.CLASS_MAIN),d.makeSelectable(this.domElement,!1),oe&&s){n.useLocalStorage=!0;var r=localStorage.getItem(ee(this,"gui"));r&&(i.load=JSON.parse(r))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=o.TEXT_CLOSED,d.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON),i.closeOnTop?(d.addClass(this.__closeButton,o.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(d.addClass(this.__closeButton,o.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),d.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{i.closed===void 0&&(i.closed=!0);var a=document.createTextNode(i.name);d.addClass(a,"controller-name"),t=be(n,a);var l=function(p){return p.preventDefault(),n.closed=!n.closed,!1};d.addClass(this.__ul,o.CLASS_CLOSED),d.addClass(t,"title"),d.bind(t,"click",l),i.closed||(this.closed=!1)}i.autoPlace&&(h.isUndefined(i.parent)&&(Be&&(Z=document.createElement("div"),d.addClass(Z,Le),d.addClass(Z,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Z),Be=!1),Z.appendChild(this.domElement),d.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||Se(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},d.bind(window,"resize",this.__resizeHandler),d.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),d.bind(this.__ul,"transitionend",this.__resizeHandler),d.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&ht(this),u=function(){oe&&localStorage.getItem(ee(n,"isLocal"))==="true"&&localStorage.setItem(ee(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=u;function f(){var c=n.getRoot();c.width+=1,h.defer(function(){c.width-=1})}i.parent||f()};A.toggleHide=function(){ve=!ve,h.each(Fe,function(o){o.domElement.style.display=ve?"none":""})},A.CLASS_AUTO_PLACE="a",A.CLASS_AUTO_PLACE_CONTAINER="ac",A.CLASS_MAIN="main",A.CLASS_CONTROLLER_ROW="cr",A.CLASS_TOO_TALL="taller-than-window",A.CLASS_CLOSED="closed",A.CLASS_CLOSE_BUTTON="close-button",A.CLASS_CLOSE_TOP="close-top",A.CLASS_CLOSE_BOTTOM="close-bottom",A.CLASS_DRAG="drag",A.DEFAULT_WIDTH=245,A.TEXT_CLOSED="Close Controls",A.TEXT_OPEN="Open Controls",A._keydownHandler=function(o){document.activeElement.type!=="text"&&(o.which===He||o.keyCode===He)&&A.toggleHide()},d.bind(window,"keydown",A._keydownHandler,!1),h.extend(A.prototype,{add:function(e,n){return ae(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return ae(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;h.defer(function(){n.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Z.removeChild(this.domElement);var e=this;h.each(this.__folders,function(n){e.removeFolder(n)}),d.unbind(window,"keydown",A._keydownHandler,!1),Ve(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var i=new A(n);this.__folders[e]=i;var s=be(this,i.domElement);return d.addClass(s,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Ve(e);var n=this;h.each(e.__folders,function(i){e.removeFolder(i)}),h.defer(function(){n.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=d.getOffset(e.__ul).top,i=0;h.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(i+=d.getHeight(s))}),window.innerHeight-n-Ge<i?(d.addClass(e.domElement,A.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-Ge+"px"):(d.removeClass(e.domElement,A.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&h.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:h.debounce(function(){this.onResize()},50),remember:function(){if(h.isUndefined(se)&&(se=new lt,se.domElement.innerHTML=ot),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;h.each(Array.prototype.slice.call(arguments),function(n){e.__rememberedObjects.length===0&&ft(e),e.__rememberedObjects.indexOf(n)===-1&&e.__rememberedObjects.push(n)}),this.autoPlace&&Se(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=fe(this)),e.folders={},h.each(this.__folders,function(n,i){e.folders[i]=n.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=fe(this),ye(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[re]=fe(this,!0)),this.load.remembered[e]=fe(this),this.preset=e,Ee(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){h.each(this.__controllers,function(n){this.getRoot().load.remembered?ze(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())},this),h.each(this.__folders,function(n){n.revert(n)}),e||ye(this.getRoot(),!1)},listen:function(e){var n=this.__listening.length===0;this.__listening.push(e),n&&$e(this.__listening)},updateDisplay:function(){h.each(this.__controllers,function(e){e.updateDisplay()}),h.each(this.__folders,function(e){e.updateDisplay()})}});function be(o,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?o.__ul.insertBefore(i,n):o.__ul.appendChild(i),o.onResize(),i}function Ve(o){d.unbind(window,"resize",o.__resizeHandler),o.saveToLocalStorageIfPossible&&d.unbind(window,"unload",o.saveToLocalStorageIfPossible)}function ye(o,e){var n=o.__preset_select[o.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function ct(o,e,n){if(n.__li=e,n.__gui=o,h.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),ae(o,n.object,n.property,{before:r,factoryArgs:[h.toArray(arguments)]})}if(h.isArray(t)||h.isObject(t)){var a=n.__li.nextElementSibling;return n.remove(),ae(o,n.object,n.property,{before:a,factoryArgs:[t]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof me){var i=new ce(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});h.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(u){var t=n[u],r=i[u];n[u]=i[u]=function(){var a=Array.prototype.slice.call(arguments);return r.apply(i,a),t.apply(n,a)}}),d.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof ce){var s=function(t){if(h.isNumber(n.__min)&&h.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,a=n.__gui.__listening.indexOf(n)>-1;n.remove();var l=ae(o,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return l.name(r),a&&l.listen(),l}return t};n.min=h.compose(s,n.min),n.max=h.compose(s,n.max)}else n instanceof Ne?(d.bind(e,"click",function(){d.fakeEvent(n.__checkbox,"click")}),d.bind(n.__checkbox,"click",function(u){u.stopPropagation()})):n instanceof De?(d.bind(e,"click",function(){d.fakeEvent(n.__button,"click")}),d.bind(e,"mouseover",function(){d.addClass(n.__button,"hover")}),d.bind(e,"mouseout",function(){d.removeClass(n.__button,"hover")})):n instanceof ge&&(d.addClass(e,"color"),n.updateDisplay=h.compose(function(u){return e.style.borderLeftColor=n.__color.toString(),u},n.updateDisplay),n.updateDisplay());n.setValue=h.compose(function(u){return o.getRoot().__preset_select&&n.isModified()&&ye(o.getRoot(),!0),u},n.setValue)}function ze(o,e){var n=o.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(i!==-1){var s=n.__rememberedObjectIndecesToControllers[i];if(s===void 0&&(s={},n.__rememberedObjectIndecesToControllers[i]=s),s[e.property]=e,n.load&&n.load.remembered){var u=n.load.remembered,t=void 0;if(u[o.preset])t=u[o.preset];else if(u[re])t=u[re];else return;if(t[i]&&t[i][e.property]!==void 0){var r=t[i][e.property];e.initialValue=r,e.setValue(r)}}}}function ae(o,e,n,i){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var s=void 0;if(i.color)s=new ge(e,n);else{var u=[e,n].concat(i.factoryArgs);s=st.apply(o,u)}i.before instanceof J&&(i.before=i.before.__li),ze(o,s),d.addClass(s.domElement,"c");var t=document.createElement("span");d.addClass(t,"property-name"),t.innerHTML=s.property;var r=document.createElement("div");r.appendChild(t),r.appendChild(s.domElement);var a=be(o,r,i.before);return d.addClass(a,A.CLASS_CONTROLLER_ROW),s instanceof ge?d.addClass(a,"color"):d.addClass(a,je(s.getValue())),ct(o,a,s),o.__controllers.push(s),s}function ee(o,e){return document.location.href+"."+e}function Ee(o,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,o.__preset_select.appendChild(i),n&&(o.__preset_select.selectedIndex=o.__preset_select.length-1)}function Ue(o,e){e.style.display=o.useLocalStorage?"block":"none"}function ft(o){var e=o.__save_row=document.createElement("li");d.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),d.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",d.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",d.addClass(i,"button"),d.addClass(i,"save");var s=document.createElement("span");s.innerHTML="New",d.addClass(s,"button"),d.addClass(s,"save-as");var u=document.createElement("span");u.innerHTML="Revert",d.addClass(u,"button"),d.addClass(u,"revert");var t=o.__preset_select=document.createElement("select");if(o.load&&o.load.remembered?h.each(o.load.remembered,function(c,p){Ee(o,p,p===o.preset)}):Ee(o,re,!1),d.bind(t,"change",function(){for(var c=0;c<o.__preset_select.length;c++)o.__preset_select[c].innerHTML=o.__preset_select[c].value;o.preset=this.value}),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(s),e.appendChild(u),oe){var r=document.getElementById("dg-local-explain"),a=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(ee(o,"isLocal"))==="true"&&a.setAttribute("checked","checked"),Ue(o,r),d.bind(a,"change",function(){o.useLocalStorage=!o.useLocalStorage,Ue(o,r)})}var f=document.getElementById("dg-new-constructor");d.bind(f,"keydown",function(c){c.metaKey&&(c.which===67||c.keyCode===67)&&se.hide()}),d.bind(n,"click",function(){f.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),se.show(),f.focus(),f.select()}),d.bind(i,"click",function(){o.save()}),d.bind(s,"click",function(){var c=prompt("Enter a new preset name.");c&&o.saveAs(c)}),d.bind(u,"click",function(){o.revert()})}function ht(o){var e=void 0;o.__resize_handle=document.createElement("div"),h.extend(o.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(u){return u.preventDefault(),o.width+=e-u.clientX,o.onResize(),e=u.clientX,!1}function i(){d.removeClass(o.__closeButton,A.CLASS_DRAG),d.unbind(window,"mousemove",n),d.unbind(window,"mouseup",i)}function s(u){return u.preventDefault(),e=u.clientX,d.addClass(o.__closeButton,A.CLASS_DRAG),d.bind(window,"mousemove",n),d.bind(window,"mouseup",i),!1}d.bind(o.__resize_handle,"mousedown",s),d.bind(o.__closeButton,"mousedown",s),o.domElement.insertBefore(o.__resize_handle,o.domElement.firstElementChild)}function Se(o,e){o.domElement.style.width=e+"px",o.__save_row&&o.autoPlace&&(o.__save_row.style.width=e+"px"),o.__closeButton&&(o.__closeButton.style.width=e+"px")}function fe(o,e){var n={};return h.each(o.__rememberedObjects,function(i,s){var u={},t=o.__rememberedObjectIndecesToControllers[s];h.each(t,function(r,a){u[a]=e?r.initialValue:r.getValue()}),n[s]=u}),n}function _t(o){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].value===o.preset&&(o.__preset_select.selectedIndex=e)}function $e(o){o.length!==0&&ut.call(window,function(){$e(o)}),h.each(o,function(e){e.updateDisplay()})}var Ye=A,pt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Ke={exports:{}};(function(o){(function(e){function n(){if(n.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(n.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return this.interface!==void 0}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(t){return this._nrpnEventsEnabled=t,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var i=new n;function s(t){var r=this;this._userHandlers={channel:{},system:{}},this._midiInput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return r._midiInput.connection}},id:{enumerable:!0,get:function(){return r._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return r._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return r._midiInput.name}},state:{enumerable:!0,get:function(){return r._midiInput.state}},type:{enumerable:!0,get:function(){return r._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function u(t){var r=this;this._midiOutput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return r._midiOutput.connection}},id:{enumerable:!0,get:function(){return r._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return r._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return r._midiOutput.name}},state:{enumerable:!0,get:function(){return r._midiOutput.state}},type:{enumerable:!0,get:function(){return r._midiOutput.type}}})}n.prototype.enable=function(t,r){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:r}).then(function(a){var l,f=[],c=[];this.interface=a,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(N){f.push(N)};for(var p=a.inputs.values(),y=p.next();y&&!y.done;y=p.next())c.push(y.value.open());for(var E=a.outputs.values(),v=E.next();v&&!v.done;v=E.next())c.push(v.value.open());function M(){clearTimeout(l),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),typeof t=="function"&&t.call(this),f.forEach(function(N){this._onInterfaceStateChange(N)}.bind(this))}l=setTimeout(M.bind(this),200),Promise&&Promise.all(c).catch(function(N){}).then(M.bind(this))}.bind(this),function(a){typeof t=="function"&&t.call(this,a)}.bind(this)):typeof t=="function"&&t(new Error("The Web MIDI API is not supported by your browser.")))},n.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.enabled&&(this.removeListener(),this.inputs.forEach(function(t){t.removeListener()})),this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},n.prototype.addListener=function(t,r){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if(typeof r!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[t].push(r),this},n.prototype.hasListener=function(t,r){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if(typeof r!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");for(var a=0;a<this._userHandlers[t].length;a++)if(this._userHandlers[t][a]===r)return!0;return!1},n.prototype.removeListener=function(t,r){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(r!==void 0&&typeof r!="function")throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(t))if(r)for(var a=0;a<this._userHandlers[t].length;a++)this._userHandlers[t][a]===r&&this._userHandlers[t].splice(a,1);else this._userHandlers[t]=[];else{if(t!==void 0)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},n.prototype.toMIDIChannels=function(t){var r;if(t==="all"||t===void 0)r=["all"];else{if(t==="none")return r=[];r=Array.isArray(t)?t:[t]}return-1<r.indexOf("all")&&(r=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),r.map(function(a){return parseInt(a)}).filter(function(a){return 1<=a&&a<=16})},n.prototype.getInputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var r=0;r<this.inputs.length;r++)if(this.inputs[r].id===t)return this.inputs[r];return!1},n.prototype.getOutputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var r=0;r<this.outputs.length;r++)if(this.outputs[r].id===t)return this.outputs[r];return!1},n.prototype.getInputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var r=0;r<this.inputs.length;r++)if(~this.inputs[r].name.indexOf(t))return this.inputs[r];return!1},n.prototype.getOctave=function(t){if(t!=null&&0<=t&&t<=127)return Math.floor(Math.floor(t)/12-1)+Math.floor(i.octaveOffset)},n.prototype.getOutputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var r=0;r<this.outputs.length;r++)if(~this.outputs[r].name.indexOf(t))return this.outputs[r];return!1},n.prototype.guessNoteNumber=function(t){var r=!1;if(t&&t.toFixed&&0<=t&&t<=127?r=Math.round(t):0<=parseInt(t)&&parseInt(t)<=127?r=parseInt(t):(typeof t=="string"||t instanceof String)&&(r=this.noteNameToNumber(t)),r===!1)throw new Error("Invalid input value ("+t+").");return r},n.prototype.noteNameToNumber=function(t){typeof t!="string"&&(t="");var r=t.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!r)throw new RangeError("Invalid note name.");var a=i._semitones[r[1].toUpperCase()],l=12*(parseInt(r[3])+1-Math.floor(i.octaveOffset))+a;if(-1<r[2].toLowerCase().indexOf("b")?l-=r[2].length:-1<r[2].toLowerCase().indexOf("#")&&(l+=r[2].length),l<0||127<l)throw new RangeError("Invalid note name or note outside valid range.");return l},n.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},n.prototype._updateInputs=function(){for(var t=0;t<this._inputs.length;t++){for(var r=!0,a=this.interface.inputs.values(),l=a.next();l&&!l.done;l=a.next())if(this._inputs[t]._midiInput===l.value){r=!1;break}r&&this._inputs.splice(t,1)}this.interface&&this.interface.inputs.forEach(function(f){for(var c=!0,p=0;p<this._inputs.length;p++)this._inputs[p]._midiInput===f&&(c=!1);c&&this._inputs.push(new s(f))}.bind(this))},n.prototype._updateOutputs=function(){for(var t=0;t<this._outputs.length;t++){for(var r=!0,a=this.interface.outputs.values(),l=a.next();l&&!l.done;l=a.next())if(this._outputs[t]._midiOutput===l.value){r=!1;break}r&&this._outputs.splice(t,1)}this.interface&&this.interface.outputs.forEach(function(f){for(var c=!0,p=0;p<this._outputs.length;p++)this._outputs[p]._midiOutput===f&&(c=!1);c&&this._outputs.push(new u(f))}.bind(this))},n.prototype._onInterfaceStateChange=function(t){this._updateInputsAndOutputs();var r={timestamp:t.timeStamp,type:t.port.state};this.interface&&t.port.state==="connected"?t.port.type==="output"?r.port=this.getOutputById(t.port.id):t.port.type==="input"&&(r.port=this.getInputById(t.port.id)):r.port={connection:"closed",id:t.port.id,manufacturer:t.port.manufacturer,name:t.port.name,state:t.port.state,type:t.port.type},this._userHandlers[t.port.state].forEach(function(a){a(r)})},n.prototype._resetInterfaceUserHandlers=function(){for(var t=0;t<this._midiInterfaceEvents.length;t++)this._userHandlers[this._midiInterfaceEvents[t]]=[]},s.prototype.on=s.prototype.addListener=function(t,r,a){var l=this;if(r===void 0&&(r="all"),Array.isArray(r)||(r=[r]),r.forEach(function(c){if(c!=="all"&&!(1<=c&&c<=16))throw new RangeError("The 'channel' parameter is invalid.")}),typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i.MIDI_SYSTEM_MESSAGES[t]!==void 0)this._userHandlers.system[t]||(this._userHandlers.system[t]=[]),this._userHandlers.system[t].push(a);else{if(i.MIDI_CHANNEL_MESSAGES[t]===void 0)throw new TypeError("The specified event type is not supported.");if(-1<r.indexOf("all")){r=[];for(var f=1;f<=16;f++)r.push(f)}this._userHandlers.channel[t]||(this._userHandlers.channel[t]=[]),r.forEach(function(c){l._userHandlers.channel[t][c]||(l._userHandlers.channel[t][c]=[]),l._userHandlers.channel[t][c].push(a)})}return this},s.prototype.hasListener=function(t,r,a){var l=this;if(typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(r===void 0&&(r="all"),r.constructor!==Array&&(r=[r]),i.MIDI_SYSTEM_MESSAGES[t]!==void 0){for(var f=0;f<this._userHandlers.system[t].length;f++)if(this._userHandlers.system[t][f]===a)return!0}else if(i.MIDI_CHANNEL_MESSAGES[t]!==void 0){if(-1<r.indexOf("all")){r=[];for(var c=1;c<=16;c++)r.push(c)}return!!this._userHandlers.channel[t]&&r.every(function(p){var y=l._userHandlers.channel[t][p];return y&&-1<y.indexOf(a)})}return!1},s.prototype.removeListener=function(t,r,a){var l=this;if(a!==void 0&&typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(r===void 0&&(r="all"),r.constructor!==Array&&(r=[r]),i.MIDI_SYSTEM_MESSAGES[t]!==void 0)if(a===void 0)this._userHandlers.system[t]=[];else for(var f=0;f<this._userHandlers.system[t].length;f++)this._userHandlers.system[t][f]===a&&this._userHandlers.system[t].splice(f,1);else if(i.MIDI_CHANNEL_MESSAGES[t]!==void 0){if(-1<r.indexOf("all")){r=[];for(var c=1;c<=16;c++)r.push(c)}if(!this._userHandlers.channel[t])return this;r.forEach(function(p){var y=l._userHandlers.channel[t][p];if(y)if(a===void 0)l._userHandlers.channel[t][p]=[];else for(var E=0;E<y.length;E++)y[E]===a&&y.splice(E,1)})}else{if(t!==void 0)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},s.prototype._initializeUserHandlers=function(){for(var t in i.MIDI_CHANNEL_MESSAGES)Object.prototype.hasOwnProperty.call(i.MIDI_CHANNEL_MESSAGES,t)&&(this._userHandlers.channel[t]={});for(var r in i.MIDI_SYSTEM_MESSAGES)Object.prototype.hasOwnProperty.call(i.MIDI_SYSTEM_MESSAGES,r)&&(this._userHandlers.system[r]=[])},s.prototype._onMidiMessage=function(t){if(0<this._userHandlers.system.midimessage.length){var r={target:this,data:t.data,timestamp:t.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(a){a(r)})}t.data[0]<240?(this._parseChannelEvent(t),this._parseNrpnEvent(t)):t.data[0]<=255&&this._parseSystemEvent(t)},s.prototype._parseNrpnEvent=function(t){var r,a,l=t.data[0]>>4,f=15&t.data[0],c=1+f;if(1<t.data.length&&(r=t.data[1],a=2<t.data.length?t.data[2]:void 0),i.nrpnEventsEnabled&&l===i.MIDI_CHANNEL_MESSAGES.controlchange&&(r>=i.MIDI_NRPN_MESSAGES.increment&&r<=i.MIDI_NRPN_MESSAGES.parammsb||r===i.MIDI_NRPN_MESSAGES.entrymsb||r===i.MIDI_NRPN_MESSAGES.entrylsb)){var p={target:this,type:"controlchange",data:t.data,timestamp:t.timeStamp,channel:c,controller:{number:r,name:this.getCcNameByNumber(r)},value:a};if(p.controller.number===i.MIDI_NRPN_MESSAGES.parammsb&&p.value!=i.MIDI_NRPN_MESSAGES.nullactiveparameter)i._nrpnBuffer[f]=[],i._nrpnBuffer[f][0]=p;else if(i._nrpnBuffer[f].length===1&&p.controller.number===i.MIDI_NRPN_MESSAGES.paramlsb)i._nrpnBuffer[f].push(p);else if(i._nrpnBuffer[f].length!==2||p.controller.number!==i.MIDI_NRPN_MESSAGES.increment&&p.controller.number!==i.MIDI_NRPN_MESSAGES.decrement&&p.controller.number!==i.MIDI_NRPN_MESSAGES.entrymsb)if(i._nrpnBuffer[f].length===3&&i._nrpnBuffer[f][2].number===i.MIDI_NRPN_MESSAGES.entrymsb&&p.controller.number===i.MIDI_NRPN_MESSAGES.entrylsb)i._nrpnBuffer[f].push(p);else if(3<=i._nrpnBuffer[f].length&&i._nrpnBuffer[f].length<=4&&p.controller.number===i.MIDI_NRPN_MESSAGES.parammsb&&p.value===i.MIDI_NRPN_MESSAGES.nullactiveparameter)i._nrpnBuffer[f].push(p);else if(4<=i._nrpnBuffer[f].length&&i._nrpnBuffer[f].length<=5&&p.controller.number===i.MIDI_NRPN_MESSAGES.paramlsb&&p.value===i.MIDI_NRPN_MESSAGES.nullactiveparameter){i._nrpnBuffer[f].push(p);var y=[];i._nrpnBuffer[f].forEach(function(F){y.push(F.data)});var E=i._nrpnBuffer[f][0].value<<7|i._nrpnBuffer[f][1].value,v=i._nrpnBuffer[f][2].value;i._nrpnBuffer[f].length===6&&(v=i._nrpnBuffer[f][2].value<<7|i._nrpnBuffer[f][3].value);var M="";switch(i._nrpnBuffer[f][2].controller.number){case i.MIDI_NRPN_MESSAGES.entrymsb:M=i._nrpnTypes[0];break;case i.MIDI_NRPN_MESSAGES.increment:M=i._nrpnTypes[1];break;case i.MIDI_NRPN_MESSAGES.decrement:M=i._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var N={timestamp:p.timestamp,channel:p.channel,type:"nrpn",data:y,controller:{number:E,type:M,name:"Non-Registered Parameter "+E},value:v};i._nrpnBuffer[f]=[],this._userHandlers.channel[N.type]&&this._userHandlers.channel[N.type][N.channel]&&this._userHandlers.channel[N.type][N.channel].forEach(function(F){F(N)})}else i._nrpnBuffer[f]=[];else i._nrpnBuffer[f].push(p)}},s.prototype._parseChannelEvent=function(t){var r,a,l=t.data[0]>>4,f=1+(15&t.data[0]);1<t.data.length&&(r=t.data[1],a=2<t.data.length?t.data[2]:void 0);var c={target:this,data:t.data,timestamp:t.timeStamp,channel:f};l===i.MIDI_CHANNEL_MESSAGES.noteoff||l===i.MIDI_CHANNEL_MESSAGES.noteon&&a===0?(c.type="noteoff",c.note={number:r,name:i._notes[r%12],octave:i.getOctave(r)},c.velocity=a/127,c.rawVelocity=a):l===i.MIDI_CHANNEL_MESSAGES.noteon?(c.type="noteon",c.note={number:r,name:i._notes[r%12],octave:i.getOctave(r)},c.velocity=a/127,c.rawVelocity=a):l===i.MIDI_CHANNEL_MESSAGES.keyaftertouch?(c.type="keyaftertouch",c.note={number:r,name:i._notes[r%12],octave:i.getOctave(r)},c.value=a/127):l===i.MIDI_CHANNEL_MESSAGES.controlchange&&0<=r&&r<=119?(c.type="controlchange",c.controller={number:r,name:this.getCcNameByNumber(r)},c.value=a):l===i.MIDI_CHANNEL_MESSAGES.channelmode&&120<=r&&r<=127?(c.type="channelmode",c.controller={number:r,name:this.getChannelModeByNumber(r)},c.value=a):l===i.MIDI_CHANNEL_MESSAGES.programchange?(c.type="programchange",c.value=r):l===i.MIDI_CHANNEL_MESSAGES.channelaftertouch?(c.type="channelaftertouch",c.value=r/127):l===i.MIDI_CHANNEL_MESSAGES.pitchbend?(c.type="pitchbend",c.value=((a<<7)+r-8192)/8192):c.type="unknownchannelmessage",this._userHandlers.channel[c.type]&&this._userHandlers.channel[c.type][f]&&this._userHandlers.channel[c.type][f].forEach(function(p){p(c)})},s.prototype.getCcNameByNumber=function(t){if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var r in i.MIDI_CONTROL_CHANGE_MESSAGES)if(Object.prototype.hasOwnProperty.call(i.MIDI_CONTROL_CHANGE_MESSAGES,r)&&t===i.MIDI_CONTROL_CHANGE_MESSAGES[r])return r},s.prototype.getChannelModeByNumber=function(t){if(!(120<=(t=Math.floor(t))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var r in i.MIDI_CHANNEL_MODE_MESSAGES)if(Object.prototype.hasOwnProperty.call(i.MIDI_CHANNEL_MODE_MESSAGES,r)&&t===i.MIDI_CHANNEL_MODE_MESSAGES[r])return r},s.prototype._parseSystemEvent=function(t){var r=t.data[0],a={target:this,data:t.data,timestamp:t.timeStamp};r===i.MIDI_SYSTEM_MESSAGES.sysex?a.type="sysex":r===i.MIDI_SYSTEM_MESSAGES.timecode?a.type="timecode":r===i.MIDI_SYSTEM_MESSAGES.songposition?a.type="songposition":r===i.MIDI_SYSTEM_MESSAGES.songselect?(a.type="songselect",a.song=t.data[1]):r===i.MIDI_SYSTEM_MESSAGES.tuningrequest?a.type="tuningrequest":r===i.MIDI_SYSTEM_MESSAGES.clock?a.type="clock":r===i.MIDI_SYSTEM_MESSAGES.start?a.type="start":r===i.MIDI_SYSTEM_MESSAGES.continue?a.type="continue":r===i.MIDI_SYSTEM_MESSAGES.stop?a.type="stop":r===i.MIDI_SYSTEM_MESSAGES.activesensing?a.type="activesensing":r===i.MIDI_SYSTEM_MESSAGES.reset?a.type="reset":a.type="unknownsystemmessage",this._userHandlers.system[a.type]&&this._userHandlers.system[a.type].forEach(function(l){l(a)})},u.prototype.send=function(t,r,a){if(!(128<=t&&t<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");r===void 0&&(r=[]),Array.isArray(r)||(r=[r]);var l=[];return r.forEach(function(f){var c=Math.floor(f);if(!(0<=c&&c<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");l.push(c)}),this._midiOutput.send([t].concat(l),parseFloat(a)||0),this},u.prototype.sendSysex=function(t,r,a){if(!i.sysexEnabled)throw new Error("Sysex message support must first be activated.");return a=a||{},t=[].concat(t),r.forEach(function(l){if(l<0||127<l)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),r=t.concat(r,i.MIDI_SYSTEM_MESSAGES.sysexend),this.send(i.MIDI_SYSTEM_MESSAGES.sysex,r,this._parseTimeParameter(a.time)),this},u.prototype.sendTimecodeQuarterFrame=function(t,r){return r=r||{},this.send(i.MIDI_SYSTEM_MESSAGES.timecode,t,this._parseTimeParameter(r.time)),this},u.prototype.sendSongPosition=function(t,r){r=r||{};var a=(t=Math.floor(t)||0)>>7&127,l=127&t;return this.send(i.MIDI_SYSTEM_MESSAGES.songposition,[a,l],this._parseTimeParameter(r.time)),this},u.prototype.sendSongSelect=function(t,r){if(r=r||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(i.MIDI_SYSTEM_MESSAGES.songselect,[t],this._parseTimeParameter(r.time)),this},u.prototype.sendTuningRequest=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendClock=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendStart=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendContinue=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendStop=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendActiveSensing=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(t.time)),this},u.prototype.sendReset=function(t){return t=t||{},this.send(i.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(t.time)),this},u.prototype.stopNote=function(t,r,a){if(t==="all")return this.sendChannelMode("allnotesoff",0,r,a);var l=64;return(a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(l=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(l=127*a.velocity),this._convertNoteToArray(t).forEach(function(f){i.toMIDIChannels(r).forEach(function(c){this.send((i.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(c-1),[f,Math.round(l)],this._parseTimeParameter(a.time))}.bind(this))}.bind(this)),this},u.prototype.playNote=function(t,r,a){var l,f=64;if((a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(f=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(f=127*a.velocity),l=this._parseTimeParameter(a.time),this._convertNoteToArray(t).forEach(function(p){i.toMIDIChannels(r).forEach(function(y){this.send((i.MIDI_CHANNEL_MESSAGES.noteon<<4)+(y-1),[p,Math.round(f)],l)}.bind(this))}.bind(this)),!isNaN(a.duration)){a.duration<=0&&(a.duration=0);var c=64;a.rawVelocity?!isNaN(a.release)&&0<=a.release&&a.release<=127&&(c=a.release):!isNaN(a.release)&&0<=a.release&&a.release<=1&&(c=127*a.release),this._convertNoteToArray(t).forEach(function(p){i.toMIDIChannels(r).forEach(function(y){this.send((i.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(y-1),[p,Math.round(c)],(l||i.time)+a.duration)}.bind(this))}.bind(this))}return this},u.prototype.sendKeyAftertouch=function(t,r,a,l){var f=this;if(l=l||{},r<1||16<r)throw new RangeError("The channel must be between 1 and 16.");(isNaN(a)||a<0||1<a)&&(a=.5);var c=Math.round(127*a);return this._convertNoteToArray(t).forEach(function(p){i.toMIDIChannels(r).forEach(function(y){f.send((i.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(y-1),[p,c],f._parseTimeParameter(l.time))})}),this},u.prototype.sendControlChange=function(t,r,a,l){if(l=l||{},typeof t=="string"){if((t=i.MIDI_CONTROL_CHANGE_MESSAGES[t])===void 0)throw new TypeError("Invalid controller name.")}else if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(r=Math.floor(r)||0)&&r<=127))throw new RangeError("Controller value must be between 0 and 127.");return i.toMIDIChannels(a).forEach(function(f){this.send((i.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(f-1),[t,r],this._parseTimeParameter(l.time))}.bind(this)),this},u.prototype._selectRegisteredParameter=function(t,r,a){var l=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return i.toMIDIChannels(r).forEach(function(){l.sendControlChange(101,t[0],r,{time:a}),l.sendControlChange(100,t[1],r,{time:a})}),this},u.prototype._selectNonRegisteredParameter=function(t,r,a){var l=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return i.toMIDIChannels(r).forEach(function(){l.sendControlChange(99,t[0],r,{time:a}),l.sendControlChange(98,t[1],r,{time:a})}),this},u.prototype._setCurrentRegisteredParameter=function(t,r,a){var l=this;if((t=[].concat(t))[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return i.toMIDIChannels(r).forEach(function(){l.sendControlChange(6,t[0],r,{time:a})}),t[1]=Math.floor(t[1]),0<=t[1]&&t[1]<=127&&i.toMIDIChannels(r).forEach(function(){l.sendControlChange(38,t[1],r,{time:a})}),this},u.prototype._deselectRegisteredParameter=function(t,r){var a=this;return i.toMIDIChannels(t).forEach(function(){a.sendControlChange(101,127,t,{time:r}),a.sendControlChange(100,127,t,{time:r})}),this},u.prototype.setRegisteredParameter=function(t,r,a,l){var f=this;if(l=l||{},!Array.isArray(t)){if(!i.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=i.MIDI_REGISTERED_PARAMETER[t]}return i.toMIDIChannels(a).forEach(function(){f._selectRegisteredParameter(t,a,l.time),f._setCurrentRegisteredParameter(r,a,l.time),f._deselectRegisteredParameter(a,l.time)}),this},u.prototype.setNonRegisteredParameter=function(t,r,a,l){var f=this;if(l=l||{},!(0<=t[0]&&t[0]<=127&&0<=t[1]&&t[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return r=[].concat(r),i.toMIDIChannels(a).forEach(function(){f._selectNonRegisteredParameter(t,a,l.time),f._setCurrentRegisteredParameter(r,a,l.time),f._deselectRegisteredParameter(a,l.time)}),this},u.prototype.incrementRegisteredParameter=function(t,r,a){var l=this;if(a=a||{},!Array.isArray(t)){if(!i.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=i.MIDI_REGISTERED_PARAMETER[t]}return i.toMIDIChannels(r).forEach(function(){l._selectRegisteredParameter(t,r,a.time),l.sendControlChange(96,0,r,{time:a.time}),l._deselectRegisteredParameter(r,a.time)}),this},u.prototype.decrementRegisteredParameter=function(t,r,a){if(a=a||{},!Array.isArray(t)){if(!i.MIDI_REGISTERED_PARAMETER[t])throw new TypeError("The specified parameter is not available.");t=i.MIDI_REGISTERED_PARAMETER[t]}return i.toMIDIChannels(r).forEach(function(){this._selectRegisteredParameter(t,r,a.time),this.sendControlChange(97,0,r,{time:a.time}),this._deselectRegisteredParameter(r,a.time)}.bind(this)),this},u.prototype.setPitchBendRange=function(t,r,a,l){var f=this;if(l=l||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(r=Math.floor(r)||0)&&r<=127))throw new RangeError("The cents value must be between 0 and 127");return i.toMIDIChannels(a).forEach(function(){f.setRegisteredParameter("pitchbendrange",[t,r],a,{time:l.time})}),this},u.prototype.setModulationRange=function(t,r,a,l){var f=this;if(l=l||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(r=Math.floor(r)||0)&&r<=127))throw new RangeError("The cents value must be between 0 and 127");return i.toMIDIChannels(a).forEach(function(){f.setRegisteredParameter("modulationrange",[t,r],a,{time:l.time})}),this},u.prototype.setMasterTuning=function(t,r,a){var l=this;if(a=a||{},(t=parseFloat(t)||0)<=-65||64<=t)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var f=Math.floor(t)+64,c=t-Math.floor(t),p=(c=Math.round((c+1)/2*16383))>>7&127,y=127&c;return i.toMIDIChannels(r).forEach(function(){l.setRegisteredParameter("channelcoarsetuning",f,r,{time:a.time}),l.setRegisteredParameter("channelfinetuning",[p,y],r,{time:a.time})}),this},u.prototype.setTuningProgram=function(t,r,a){var l=this;if(a=a||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The program value must be between 0 and 127");return i.toMIDIChannels(r).forEach(function(){l.setRegisteredParameter("tuningprogram",t,r,{time:a.time})}),this},u.prototype.setTuningBank=function(t,r,a){var l=this;if(a=a||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The bank value must be between 0 and 127");return i.toMIDIChannels(r).forEach(function(){l.setRegisteredParameter("tuningbank",t,r,{time:a.time})}),this},u.prototype.sendChannelMode=function(t,r,a,l){if(l=l||{},typeof t=="string"){if(!(t=i.MIDI_CHANNEL_MODE_MESSAGES[t]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(t=Math.floor(t))&&t<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((r=Math.floor(r)||0)<0||127<r)throw new RangeError("Value must be an integer between 0 and 127.");return i.toMIDIChannels(a).forEach(function(f){this.send((i.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(f-1),[t,r],this._parseTimeParameter(l.time))}.bind(this)),this},u.prototype.sendProgramChange=function(t,r,a){var l=this;if(a=a||{},t=Math.floor(t),isNaN(t)||t<0||127<t)throw new RangeError("Program numbers must be between 0 and 127.");return i.toMIDIChannels(r).forEach(function(f){l.send((i.MIDI_CHANNEL_MESSAGES.programchange<<4)+(f-1),[t],l._parseTimeParameter(a.time))}),this},u.prototype.sendChannelAftertouch=function(t,r,a){var l=this;a=a||{},t=parseFloat(t),(isNaN(t)||t<0||1<t)&&(t=.5);var f=Math.round(127*t);return i.toMIDIChannels(r).forEach(function(c){l.send((i.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(c-1),[f],l._parseTimeParameter(a.time))}),this},u.prototype.sendPitchBend=function(t,r,a){var l=this;if(a=a||{},isNaN(t)||t<-1||1<t)throw new RangeError("Pitch bend value must be between -1 and 1.");var f=Math.round((t+1)/2*16383),c=f>>7&127,p=127&f;return i.toMIDIChannels(r).forEach(function(y){l.send((i.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(y-1),[p,c],l._parseTimeParameter(a.time))}),this},u.prototype._parseTimeParameter=function(t){var r,a=parseFloat(t);return typeof t=="string"&&t.substring(0,1)==="+"?a&&0<a&&(r=i.time+a):a>i.time&&(r=a),r},u.prototype._convertNoteToArray=function(t){var r=[];return Array.isArray(t)||(t=[t]),t.forEach(function(a){r.push(i.guessNoteNumber(a))}),r},o.exports?o.exports=i:e.WebMidi||(e.WebMidi=i)})(pt)})(Ke);var mt=Ke.exports,we={exports:{}};(function(o){(function(e,n,i){if(!e)return;for(var s={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},r={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},a,l=1;l<20;++l)s[111+l]="f"+l;for(l=0;l<=9;++l)s[l+96]=l.toString();function f(_,m,S){if(_.addEventListener){_.addEventListener(m,S,!1);return}_.attachEvent("on"+m,S)}function c(_){if(_.type=="keypress"){var m=String.fromCharCode(_.which);return _.shiftKey||(m=m.toLowerCase()),m}return s[_.which]?s[_.which]:u[_.which]?u[_.which]:String.fromCharCode(_.which).toLowerCase()}function p(_,m){return _.sort().join(",")===m.sort().join(",")}function y(_){var m=[];return _.shiftKey&&m.push("shift"),_.altKey&&m.push("alt"),_.ctrlKey&&m.push("ctrl"),_.metaKey&&m.push("meta"),m}function E(_){if(_.preventDefault){_.preventDefault();return}_.returnValue=!1}function v(_){if(_.stopPropagation){_.stopPropagation();return}_.cancelBubble=!0}function M(_){return _=="shift"||_=="ctrl"||_=="alt"||_=="meta"}function N(){if(!a){a={};for(var _ in s)_>95&&_<112||s.hasOwnProperty(_)&&(a[s[_]]=_)}return a}function F(_,m,S){return S||(S=N()[_]?"keydown":"keypress"),S=="keypress"&&m.length&&(S="keydown"),S}function V(_){return _==="+"?["+"]:(_=_.replace(/\+{2}/g,"+plus"),_.split("+"))}function W(_,m){var S,R,X,Q=[];for(S=V(_),X=0;X<S.length;++X)R=S[X],r[R]&&(R=r[R]),m&&m!="keypress"&&t[R]&&(R=t[R],Q.push("shift")),M(R)&&Q.push(R);return m=F(R,Q,m),{key:R,modifiers:Q,action:m}}function q(_,m){return _===null||_===n?!1:_===m?!0:q(_.parentNode,m)}function D(_){var m=this;if(_=_||n,!(m instanceof D))return new D(_);m.target=_,m._callbacks={},m._directMap={};var S={},R,X=!1,Q=!1,Ce=!1;function Me(b){b=b||{};var C=!1,I;for(I in S){if(b[I]){C=!0;continue}S[I]=0}C||(Ce=!1)}function We(b,C,I,w,T,z){var x,P,te=[],j=I.type;if(!m._callbacks[b])return[];for(j=="keyup"&&M(b)&&(C=[b]),x=0;x<m._callbacks[b].length;++x)if(P=m._callbacks[b][x],!(!w&&P.seq&&S[P.seq]!=P.level)&&j==P.action&&(j=="keypress"&&!I.metaKey&&!I.ctrlKey||p(C,P.modifiers))){var yt=!w&&P.combo==T,Et=w&&P.seq==w&&P.level==z;(yt||Et)&&m._callbacks[b].splice(x,1),te.push(P)}return te}function Ae(b,C,I,w){m.stopCallback(C,C.target||C.srcElement,I,w)||b(C,I)===!1&&(E(C),v(C))}m._handleKey=function(b,C,I){var w=We(b,C,I),T,z={},x=0,P=!1;for(T=0;T<w.length;++T)w[T].seq&&(x=Math.max(x,w[T].level));for(T=0;T<w.length;++T){if(w[T].seq){if(w[T].level!=x)continue;P=!0,z[w[T].seq]=1,Ae(w[T].callback,I,w[T].combo,w[T].seq);continue}P||Ae(w[T].callback,I,w[T].combo)}var te=I.type=="keypress"&&Q;I.type==Ce&&!M(b)&&!te&&Me(z),Q=P&&I.type=="keydown"};function xe(b){typeof b.which!="number"&&(b.which=b.keyCode);var C=c(b);if(!!C){if(b.type=="keyup"&&X===C){X=!1;return}m.handleKey(C,y(b),b)}}function vt(){clearTimeout(R),R=setTimeout(Me,1e3)}function bt(b,C,I,w){S[b]=0;function T(j){return function(){Ce=j,++S[b],vt()}}function z(j){Ae(I,j,b),w!=="keyup"&&(X=c(j)),setTimeout(Me,10)}for(var x=0;x<C.length;++x){var P=x+1===C.length,te=P?z:T(w||W(C[x+1]).action);qe(C[x],te,w,b,x)}}function qe(b,C,I,w,T){m._directMap[b+":"+I]=C,b=b.replace(/\s+/g," ");var z=b.split(" "),x;if(z.length>1){bt(b,z,C,I);return}x=W(b,I),m._callbacks[x.key]=m._callbacks[x.key]||[],We(x.key,x.modifiers,{type:x.action},w,b,T),m._callbacks[x.key][w?"unshift":"push"]({callback:C,modifiers:x.modifiers,action:x.action,seq:w,level:T,combo:b})}m._bindMultiple=function(b,C,I){for(var w=0;w<b.length;++w)qe(b[w],C,I)},f(_,"keypress",xe),f(_,"keydown",xe),f(_,"keyup",xe)}D.prototype.bind=function(_,m,S){var R=this;return _=_ instanceof Array?_:[_],R._bindMultiple.call(R,_,m,S),R},D.prototype.unbind=function(_,m){var S=this;return S.bind.call(S,_,function(){},m)},D.prototype.trigger=function(_,m){var S=this;return S._directMap[_+":"+m]&&S._directMap[_+":"+m]({},_),S},D.prototype.reset=function(){var _=this;return _._callbacks={},_._directMap={},_},D.prototype.stopCallback=function(_,m){var S=this;if((" "+m.className+" ").indexOf(" mousetrap ")>-1||q(m,S.target))return!1;if("composedPath"in _&&typeof _.composedPath=="function"){var R=_.composedPath()[0];R!==_.target&&(m=R)}return m.tagName=="INPUT"||m.tagName=="SELECT"||m.tagName=="TEXTAREA"||m.isContentEditable},D.prototype.handleKey=function(){var _=this;return _._handleKey.apply(_,arguments)},D.addKeycodes=function(_){for(var m in _)_.hasOwnProperty(m)&&(s[m]=_[m]);a=null},D.init=function(){var _=D(n);for(var m in _)m.charAt(0)!=="_"&&(D[m]=function(S){return function(){return _[S].apply(_,arguments)}}(m))},D.init(),e.Mousetrap=D,o.exports&&(o.exports=D),typeof i=="function"&&i.amd&&i(function(){return D})})(typeof window!="undefined"?window:null,typeof window!="undefined"?document:null)})(we);const ue={};ue.write=async o=>{await navigator.clipboard.writeText(o)},ue.read=async()=>navigator.clipboard.readText(),ue.readSync=()=>{throw new Error("`.readSync()` is not supported in browsers!")},ue.writeSync=()=>{throw new Error("`.writeSync()` is not supported in browsers!")};class gt{constructor(e={}){g(this,"gui",new Ye);g(this,"midiPerColor");g(this,"midi");g(this,"colors");g(this,"folders",[]);g(this,"currentFolder",this.gui);g(this,"midiConnectRange",[]);g(this,"customControls",{});g(this,"debugMidi",!1);g(this,"hidden",!1);g(this,"Midi",null);g(this,"midiReady");g(this,"supportedMidiOutputDevices",{"Midi Fighter Twister":{sync:(e,n,i)=>{e.sendControlChange(n,i,1),e.sendControlChange(n,47,6)},clear:(e,n)=>{e.sendControlChange(n,0,1),e.sendControlChange(n,20,6)},configure:()=>{this.connectMidiRange(0,15)}},"nanoKONTROL2 CTRL":{configure:()=>{this.connectMidiRange(16,23),this.connectMidiRange(0,7)}}});g(this,"add",(e,n,i,s,u)=>{const t=this.currentFolder.add(e,n,i,s,u);return this._updateControllerColors(),this.syncMidi(),t});g(this,"addColor",(e,n)=>this.currentFolder.addColor(e,n));g(this,"setFolder",e=>{const n=this.gui.addFolder(e);return this.folders.push(n),this.currentFolder=n,n});g(this,"getControllers",(e=!1)=>{const n=this._getAllFolders();return(e?n.filter(s=>!s.closed):n).reduce((s,u)=>s.concat(u.__controllers),[])});g(this,"removeFolder",e=>{const n=this.folders.findIndex(i=>i.name===e.name);this.folders.splice(n,1),this.gui.removeFolder(e),this.currentFolder=this.gui});g(this,"connectMidiRange",(e,n)=>{for(let i=e,s=n+1;i<s;i++)this.midiConnectRange.push(i)});g(this,"addControl",(e,n)=>{this.customControls[e]=n});g(this,"destroy",()=>{this.gui.destroy(),this.Midi&&(this.Midi.inputs.forEach(e=>{e.removeListener("midimessage","all")}),this.Midi.disable())});g(this,"clear",()=>{this.gui.destroy(),this.gui=new Ye,this.currentFolder=this.gui,this.customControls={}});g(this,"hide",()=>{this.hidden=!0,this.gui.hide()});g(this,"show",()=>{this.hidden=!1,this.gui.show()});g(this,"toggle",()=>{this.hidden=!this.hidden,this.hidden?this.hide():this.show()});g(this,"update",()=>{this.getControllers().forEach(e=>{e.updateDisplay()})});g(this,"configureDevice",e=>{const n=this.supportedMidiOutputDevices[e];if(!n||!n.configure)return console.warn(`No built-in configuration is available for "${e}"`);n.configure()});g(this,"syncMidi",()=>{!this.Midi||this.midiConnectRange.forEach((e,n)=>{const i=this._getNumericControllerAtIndex(n);this.midiReady.then(()=>{this.Midi.outputs.forEach(s=>{const u=this.supportedMidiOutputDevices[s.name];if(!!u)if(i){const t=this._controllerValueToMidi(i);u.sync&&u.sync(s,e,t)}else u.clear&&u.clear(s,e)})})})});g(this,"_mapRange",(e,n,i,s,u)=>(u-e)*(s-i)/(n-e)+i);g(this,"_snap",(e,n)=>Math.round(n/e)*e);g(this,"_getNumericControllerAtIndex",(e,n=!1)=>{const s=this.getControllers(n)[e];return typeof s!="undefined"&&typeof s.min!="undefined"&&typeof s.max!="undefined"?s:null});g(this,"_getAggregatedSettings",()=>this._getAllFolders().reduce((n,i)=>(n[i.name]=i.__controllers.reduce((s,u)=>(s[u.property]=u.getValue(),s),{}),n),{}));g(this,"_controllerValueToMidi",e=>{const n=e.getValue(),i=e.__min,s=e.__max,u=this._mapRange(i,s,1,127,n);return Math.round(u)});g(this,"_init",()=>{this._addMidi(),this._addEventListeners(),this._addSaveMarkup(),this._addSaveEventListeners(),this._addStyles()});g(this,"_addMidi",()=>{!this.midi||(this.midiReady=new Promise(e=>{navigator.requestMIDIAccess&&(this.Midi=mt,this.Midi.enable(i=>{i?console.error("WebMIDI is not supported in this browser."):(console.log("MIDI devices successfully connected."),this._setupMidiInputs(),e(this.Midi))},!0))}).catch(e=>{console.error(e)}))});g(this,"_addEventListeners",()=>{document.addEventListener("keydown",({keyCode:e})=>{e===18&&(this.debugMidi=!0)}),document.addEventListener("keyup",({keyCode:e})=>{e===18&&(this.debugMidi=!1)}),document.addEventListener("keyup",({keyCode:e})=>{e===17&&this.toggle()})});g(this,"_addSaveMarkup",()=>{const e=`
  <div class="gui-save__inner">
    <span class="gui-save__close">&times;</span>
    <p class="gui-save__clipboard-notification">This code has been saved to your clipboard.</p>
    <textarea
      class="gui-save__textarea"
      name="gui-save-text"
      id="gui-save-text"
      autocomplete="off" autocapitalize="off" spellcheck="false"
    ></textarea>
  </div>
`,n=document.querySelector("body"),i=document.createElement("div");i.classList.add("gui-save"),i.innerHTML=e,n.appendChild(i),n.insertBefore(i,null),n.insertBefore(i,n.childNodes[0]||null)});g(this,"_addSaveEventListeners",()=>{we.exports.bind("alt+s",this._saveMarkup),we.exports.bind("esc",this._closeSave),document.querySelector(".gui-save__close").addEventListener("click",this._closeSave)});g(this,"_saveMarkup",()=>{const e=this._getAggregatedSettings();let i=JSON.stringify(e,null,1).replace(/\\"/g,"\uFFFF");i=i.replace(/"([^"]+)":/g,"$1:").replace(/\uFFFF/g,'\\"'),i.replace(/"/g,"'");const s=document.querySelector(".gui-save__textarea");s.value=i,this._openSave(),this._copySaveToClipboard()});g(this,"_openSave",()=>{document.querySelector(".gui-save").classList.add("is-visible")});g(this,"_copySaveToClipboard",()=>{const e=document.querySelector(".gui-save__textarea");ue.write(e.value);const n=document.querySelector(".gui-save__clipboard-notification");n.classList.add("is-visible"),window.setTimeout(()=>{n.classList.remove("is-visible")},2e3)});g(this,"_closeSave",()=>{document.querySelector(".gui-save").classList.remove("is-visible")});g(this,"_addStyles",()=>{const e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(`
  .dg.ac {
    z-index: 9999;
  }

  .gui-save {
    display: none;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    justify-content: center;
    align-items: center;
    box-sizing: border-box;
    background-color: rgba(255, 255, 255, 0.1);
    z-index: 999;
  }

  .gui-save *, .gui-save *:before, .gui-save *:after {
    box-sizing: inherit;
  }

  .gui-save.is-visible {
    display: flex;
  }

  .gui-save__inner {
    position: relative;
    width: 100%;
    max-width: 400px;
    margin: 20px;
  }

  .gui-save__textarea {
    appearance: none;
    border-radius: 5px;
    border: none;
    background-color: #1f1f1f;
    width: 100%;
    height: 300px;
    padding: 25px 23px;
    border-left: 4px solid #5887da;
    font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
    font-size: 14px;
    line-height: 1.5;
    font-weight: normal;
    color: white;
    transition: border-color 0.2s;
  }

  .gui-save__textarea:focus {
    outline: none;
    border-color: #ee907b;
  }

  .gui-save__clipboard-notification {
    font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
    font-size: 13px;
    pointer-events: none;
    position: absolute;
    bottom: -45px;
    left: 0;
    right: 0;
    opacity: 0;
    color: #5887da;
    transition: opacity 0.4s;
  }

  .gui-save__clipboard-notification.is-visible {
    opacity: 1;
  }

  .gui-save__close {
    position: absolute;
    width: 35px;
    height: 35px;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 0;
    right: 0;
    z-index: 1;
    font-size: 18px;
    cursor: pointer;
    color: #fff;
  }

  .gui-save__close:active {
    opacity: 0.7;
  }
`)),document.querySelector("head").appendChild(e)});g(this,"_setupMidiInputs",()=>{this.Midi.inputs.forEach(e=>{e.addListener("midimessage","all",this._onMidiMessage)})});g(this,"_onMidiMessage",e=>{const[n,i,s]=e.data;this.debugMidi&&console.log(`command: ${n} / note: ${i} / velocity: ${s}`),this._controlRangeChange(i,s),this._customControlChange(i,s)});g(this,"_controlRangeChange",(e,n)=>{const i=this.midiConnectRange.indexOf(e);if(i<0)return;const s=this._getNumericControllerAtIndex(i);if(!s)return;const{__min:u,__max:t,__step:r}=s,a=r||(t-u)/127,l=this._mapRange(0,127,u,t,n),f=this._snap(Number(a.toFixed(5)),l);s.setValue(f)});g(this,"_customControlChange",(e,n)=>{this.customControls[e]&&this.customControls[e].call(self,n)});g(this,"_getAllFolders",()=>this.folders.length?this.folders:[this.gui]);g(this,"_updateControllerColors",()=>{this.getControllers(!1).forEach((n,i)=>{const s=Math.floor(i/this.midiPerColor),u=this.colors[s],r=n.domElement.closest(".cr.number.has-slider");if(r){r.style.borderLeftColor=`${u}`;const a=r.querySelector(".slider-fg");a.style.backgroundColor=`${u}`}})});Object.assign(this,{midi:!0,colors:["#ee907b","#2ed9c3","#4888f5","#aa82ff"],midiPerColor:4},e),this._init()}}return gt});
