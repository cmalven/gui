(function(ie,$){typeof exports=="object"&&typeof module!="undefined"?module.exports=$():typeof define=="function"&&define.amd?define($):(ie=typeof globalThis!="undefined"?globalThis:ie||self,ie.Gui=$())})(this,function(){"use strict";function ie(o){if(!!o&&typeof window!="undefined"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=o,document.head.appendChild(e),o}}function $(o,e){var r=o.__state.conversionName.toString(),n=Math.round(o.r),a=Math.round(o.g),u=Math.round(o.b),t=o.a,i=Math.round(o.h),s=o.s.toFixed(1),l=o.v.toFixed(1);if(e||r==="THREE_CHAR_HEX"||r==="SIX_CHAR_HEX"){for(var f=o.hex.toString(16);f.length<6;)f="0"+f;return"#"+f}else{if(r==="CSS_RGB")return"rgb("+n+","+a+","+u+")";if(r==="CSS_RGBA")return"rgba("+n+","+a+","+u+","+t+")";if(r==="HEX")return"0x"+o.hex.toString(16);if(r==="RGB_ARRAY")return"["+n+","+a+","+u+"]";if(r==="RGBA_ARRAY")return"["+n+","+a+","+u+","+t+"]";if(r==="RGB_OBJ")return"{r:"+n+",g:"+a+",b:"+u+"}";if(r==="RGBA_OBJ")return"{r:"+n+",g:"+a+",b:"+u+",a:"+t+"}";if(r==="HSV_OBJ")return"{h:"+i+",s:"+s+",v:"+l+"}";if(r==="HSVA_OBJ")return"{h:"+i+",s:"+s+",v:"+l+",a:"+t+"}"}return"unknown format"}var Ne=Array.prototype.forEach,oe=Array.prototype.slice,h={BREAK:{},extend:function(e){return this.each(oe.call(arguments,1),function(r){var n=this.isObject(r)?Object.keys(r):[];n.forEach(function(a){this.isUndefined(r[a])||(e[a]=r[a])}.bind(this))},this),e},defaults:function(e){return this.each(oe.call(arguments,1),function(r){var n=this.isObject(r)?Object.keys(r):[];n.forEach(function(a){this.isUndefined(e[a])&&(e[a]=r[a])}.bind(this))},this),e},compose:function(){var e=oe.call(arguments);return function(){for(var r=oe.call(arguments),n=e.length-1;n>=0;n--)r=[e[n].apply(this,r)];return r[0]}},each:function(e,r,n){if(!!e){if(Ne&&e.forEach&&e.forEach===Ne)e.forEach(r,n);else if(e.length===e.length+0){var a=void 0,u=void 0;for(a=0,u=e.length;a<u;a++)if(a in e&&r.call(n,e[a],a)===this.BREAK)return}else for(var t in e)if(r.call(n,e[t],t)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,r,n){var a=void 0;return function(){var u=this,t=arguments;function i(){a=null,n||e.apply(u,t)}var s=n||!a;clearTimeout(a),a=setTimeout(i,r),s&&e.apply(u,t)}},toArray:function(e){return e.toArray?e.toArray():oe.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(o){function e(r){return o.apply(this,arguments)}return e.toString=function(){return o.toString()},e}(function(o){return isNaN(o)}),isArray:Array.isArray||function(o){return o.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},je=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var r=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return r===null?!1:{space:"HEX",hex:parseInt("0x"+r[1].toString()+r[1].toString()+r[2].toString()+r[2].toString()+r[3].toString()+r[3].toString(),0)}},write:$},SIX_CHAR_HEX:{read:function(e){var r=e.match(/^#([A-F0-9]{6})$/i);return r===null?!1:{space:"HEX",hex:parseInt("0x"+r[1].toString(),0)}},write:$},CSS_RGB:{read:function(e){var r=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return r===null?!1:{space:"RGB",r:parseFloat(r[1]),g:parseFloat(r[2]),b:parseFloat(r[3])}},write:$},CSS_RGBA:{read:function(e){var r=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return r===null?!1:{space:"RGB",r:parseFloat(r[1]),g:parseFloat(r[2]),b:parseFloat(r[3]),a:parseFloat(r[4])}},write:$}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],se=void 0,he=void 0,be=function(){he=!1;var e=arguments.length>1?h.toArray(arguments):arguments[0];return h.each(je,function(r){if(r.litmus(e))return h.each(r.conversions,function(n,a){if(se=n.read(e),he===!1&&se!==!1)return he=se,se.conversionName=a,se.conversion=n,h.BREAK}),h.BREAK}),he},Oe=void 0,_e={hsv_to_rgb:function(e,r,n){var a=Math.floor(e/60)%6,u=e/60-Math.floor(e/60),t=n*(1-r),i=n*(1-u*r),s=n*(1-(1-u)*r),l=[[n,s,t],[i,n,t],[t,n,s],[t,i,n],[s,t,n],[n,t,i]][a];return{r:l[0]*255,g:l[1]*255,b:l[2]*255}},rgb_to_hsv:function(e,r,n){var a=Math.min(e,r,n),u=Math.max(e,r,n),t=u-a,i=void 0,s=void 0;if(u!==0)s=t/u;else return{h:NaN,s:0,v:0};return e===u?i=(r-n)/t:r===u?i=2+(n-e)/t:i=4+(e-r)/t,i/=6,i<0&&(i+=1),{h:i*360,s,v:u/255}},rgb_to_hex:function(e,r,n){var a=this.hex_with_component(0,2,e);return a=this.hex_with_component(a,1,r),a=this.hex_with_component(a,0,n),a},component_from_hex:function(e,r){return e>>r*8&255},hex_with_component:function(e,r,n){return n<<(Oe=r*8)|e&~(255<<Oe)}},Je=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},F=function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")},V=function(){function o(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,r,n){return r&&o(e.prototype,r),n&&o(e,n),e}}(),j=function o(e,r,n){e===null&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,r);if(a===void 0){var u=Object.getPrototypeOf(e);return u===null?void 0:o(u,r,n)}else{if("value"in a)return a.value;var t=a.get;return t===void 0?void 0:t.call(n)}},J=function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)},Q=function(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:o},L=function(){function o(){if(F(this,o),this.__state=be.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return V(o,[{key:"toString",value:function(){return $(this)}},{key:"toHexString",value:function(){return $(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),o}();function ve(o,e,r){Object.defineProperty(o,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(L.recalculateRGB(this,e,r),this.__state[e])},set:function(a){this.__state.space!=="RGB"&&(L.recalculateRGB(this,e,r),this.__state.space="RGB"),this.__state[e]=a}})}function ye(o,e){Object.defineProperty(o,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(L.recalculateHSV(this),this.__state[e])},set:function(n){this.__state.space!=="HSV"&&(L.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=n}})}L.recalculateRGB=function(o,e,r){if(o.__state.space==="HEX")o.__state[e]=_e.component_from_hex(o.__state.hex,r);else if(o.__state.space==="HSV")h.extend(o.__state,_e.hsv_to_rgb(o.__state.h,o.__state.s,o.__state.v));else throw new Error("Corrupted color state")},L.recalculateHSV=function(o){var e=_e.rgb_to_hsv(o.r,o.g,o.b);h.extend(o.__state,{s:e.s,v:e.v}),h.isNaN(e.h)?h.isUndefined(o.__state.h)&&(o.__state.h=0):o.__state.h=e.h},L.COMPONENTS=["r","g","b","h","s","v","hex","a"],ve(L.prototype,"r",2),ve(L.prototype,"g",1),ve(L.prototype,"b",0),ye(L.prototype,"h"),ye(L.prototype,"s"),ye(L.prototype,"v"),Object.defineProperty(L.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(L.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=_e.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ee=function(){function o(e,r){F(this,o),this.initialValue=e[r],this.domElement=document.createElement("div"),this.object=e,this.property=r,this.__onChange=void 0,this.__onFinishChange=void 0}return V(o,[{key:"onChange",value:function(r){return this.__onChange=r,this}},{key:"onFinishChange",value:function(r){return this.__onFinishChange=r,this}},{key:"setValue",value:function(r){return this.object[this.property]=r,this.__onChange&&this.__onChange.call(this,r),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),o}(),Qe={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},ke={};h.each(Qe,function(o,e){h.each(o,function(r){ke[r]=e})});var Ze=/(\d+(\.\d+)?)px/;function Y(o){if(o==="0"||h.isUndefined(o))return 0;var e=o.match(Ze);return h.isNull(e)?0:parseFloat(e[1])}var d={makeSelectable:function(e,r){e===void 0||e.style===void 0||(e.onselectstart=r?function(){return!1}:function(){},e.style.MozUserSelect=r?"auto":"none",e.style.KhtmlUserSelect=r?"auto":"none",e.unselectable=r?"on":"off")},makeFullscreen:function(e,r,n){var a=n,u=r;h.isUndefined(u)&&(u=!0),h.isUndefined(a)&&(a=!0),e.style.position="absolute",u&&(e.style.left=0,e.style.right=0),a&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,r,n,a){var u=n||{},t=ke[r];if(!t)throw new Error("Event type "+r+" not supported.");var i=document.createEvent(t);switch(t){case"MouseEvents":{var s=u.x||u.clientX||0,l=u.y||u.clientY||0;i.initMouseEvent(r,u.bubbles||!1,u.cancelable||!0,window,u.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var f=i.initKeyboardEvent||i.initKeyEvent;h.defaults(u,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),f(r,u.bubbles||!1,u.cancelable,window,u.ctrlKey,u.altKey,u.shiftKey,u.metaKey,u.keyCode,u.charCode);break}default:{i.initEvent(r,u.bubbles||!1,u.cancelable||!0);break}}h.defaults(i,a),e.dispatchEvent(i)},bind:function(e,r,n,a){var u=a||!1;return e.addEventListener?e.addEventListener(r,n,u):e.attachEvent&&e.attachEvent("on"+r,n),d},unbind:function(e,r,n,a){var u=a||!1;return e.removeEventListener?e.removeEventListener(r,n,u):e.detachEvent&&e.detachEvent("on"+r,n),d},addClass:function(e,r){if(e.className===void 0)e.className=r;else if(e.className!==r){var n=e.className.split(/ +/);n.indexOf(r)===-1&&(n.push(r),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(e,r){if(r)if(e.className===r)e.removeAttribute("class");else{var n=e.className.split(/ +/),a=n.indexOf(r);a!==-1&&(n.splice(a,1),e.className=n.join(" "))}else e.className=void 0;return d},hasClass:function(e,r){return new RegExp("(?:^|\\s+)"+r+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var r=getComputedStyle(e);return Y(r["border-left-width"])+Y(r["border-right-width"])+Y(r["padding-left"])+Y(r["padding-right"])+Y(r.width)},getHeight:function(e){var r=getComputedStyle(e);return Y(r["border-top-width"])+Y(r["border-bottom-width"])+Y(r["padding-top"])+Y(r["padding-bottom"])+Y(r.height)},getOffset:function(e){var r=e,n={left:0,top:0};if(r.offsetParent)do n.left+=r.offsetLeft,n.top+=r.offsetTop,r=r.offsetParent;while(r);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Re=function(o){J(e,o);function e(r,n){F(this,e);var a=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),u=a;a.__prev=a.getValue(),a.__checkbox=document.createElement("input"),a.__checkbox.setAttribute("type","checkbox");function t(){u.setValue(!u.__prev)}return d.bind(a.__checkbox,"change",t,!1),a.domElement.appendChild(a.__checkbox),a.updateDisplay(),a}return V(e,[{key:"setValue",value:function(n){var a=j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),a}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ee),et=function(o){J(e,o);function e(r,n,a){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),t=a,i=u;if(u.__select=document.createElement("select"),h.isArray(t)){var s={};h.each(t,function(l){s[l]=l}),t=s}return h.each(t,function(l,f){var c=document.createElement("option");c.innerHTML=f,c.setAttribute("value",l),i.__select.appendChild(c)}),u.updateDisplay(),d.bind(u.__select,"change",function(){var l=this.options[this.selectedIndex].value;i.setValue(l)}),u.domElement.appendChild(u.__select),u}return V(e,[{key:"setValue",value:function(n){var a=j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),a}},{key:"updateDisplay",value:function(){return d.isActive(this.__select)?this:(this.__select.value=this.getValue(),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(ee),tt=function(o){J(e,o);function e(r,n){F(this,e);var a=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),u=a;function t(){u.setValue(u.__input.value)}function i(){u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),d.bind(a.__input,"keyup",t),d.bind(a.__input,"change",t),d.bind(a.__input,"blur",i),d.bind(a.__input,"keydown",function(s){s.keyCode===13&&this.blur()}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return V(e,[{key:"updateDisplay",value:function(){return d.isActive(this.__input)||(this.__input.value=this.getValue()),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ee);function De(o){var e=o.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Pe=function(o){J(e,o);function e(r,n,a){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),t=a||{};return u.__min=t.min,u.__max=t.max,u.__step=t.step,h.isUndefined(u.__step)?u.initialValue===0?u.__impliedStep=1:u.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(u.initialValue))/Math.LN10))/10:u.__impliedStep=u.__step,u.__precision=De(u.__impliedStep),u}return V(e,[{key:"setValue",value:function(n){var a=n;return this.__min!==void 0&&a<this.__min?a=this.__min:this.__max!==void 0&&a>this.__max&&(a=this.__max),this.__step!==void 0&&a%this.__step!=0&&(a=Math.round(a/this.__step)*this.__step),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,a)}},{key:"min",value:function(n){return this.__min=n,this}},{key:"max",value:function(n){return this.__max=n,this}},{key:"step",value:function(n){return this.__step=n,this.__impliedStep=n,this.__precision=De(n),this}}]),e}(ee);function nt(o,e){var r=Math.pow(10,e);return Math.round(o*r)/r}var pe=function(o){J(e,o);function e(r,n,a){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n,a));u.__truncationSuspended=!1;var t=u,i=void 0;function s(){var A=parseFloat(t.__input.value);h.isNaN(A)||t.setValue(A)}function l(){t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}function f(){l()}function c(A){var y=i-A.clientY;t.setValue(t.getValue()+y*t.__impliedStep),i=A.clientY}function m(){d.unbind(window,"mousemove",c),d.unbind(window,"mouseup",m),l()}function E(A){d.bind(window,"mousemove",c),d.bind(window,"mouseup",m),i=A.clientY}return u.__input=document.createElement("input"),u.__input.setAttribute("type","text"),d.bind(u.__input,"change",s),d.bind(u.__input,"blur",f),d.bind(u.__input,"mousedown",E),d.bind(u.__input,"keydown",function(A){A.keyCode===13&&(t.__truncationSuspended=!0,this.blur(),t.__truncationSuspended=!1,l())}),u.updateDisplay(),u.domElement.appendChild(u.__input),u}return V(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():nt(this.getValue(),this.__precision),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Pe);function Le(o,e,r,n,a){return n+(a-n)*((o-e)/(r-e))}var Ee=function(o){J(e,o);function e(r,n,a,u,t){F(this,e);var i=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n,{min:a,max:u,step:t})),s=i;i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),d.bind(i.__background,"mousedown",l),d.bind(i.__background,"touchstart",m),d.addClass(i.__background,"slider"),d.addClass(i.__foreground,"slider-fg");function l(y){document.activeElement.blur(),d.bind(window,"mousemove",f),d.bind(window,"mouseup",c),f(y)}function f(y){y.preventDefault();var x=s.__background.getBoundingClientRect();return s.setValue(Le(y.clientX,x.left,x.right,s.__min,s.__max)),!1}function c(){d.unbind(window,"mousemove",f),d.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function m(y){y.touches.length===1&&(d.bind(window,"touchmove",E),d.bind(window,"touchend",A),E(y))}function E(y){var x=y.touches[0].clientX,R=s.__background.getBoundingClientRect();s.setValue(Le(x,R.left,R.right,s.__min,s.__max))}function A(){d.unbind(window,"touchmove",E),d.unbind(window,"touchend",A),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}return V(e,[{key:"updateDisplay",value:function(){var n=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=n*100+"%",j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Pe),He=function(o){J(e,o);function e(r,n,a){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),t=u;return u.__button=document.createElement("div"),u.__button.innerHTML=a===void 0?"Fire":a,d.bind(u.__button,"click",function(i){return i.preventDefault(),t.fire(),!1}),d.addClass(u.__button,"button"),u.domElement.appendChild(u.__button),u}return V(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(ee),Se=function(o){J(e,o);function e(r,n){F(this,e);var a=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n));a.__color=new L(a.getValue()),a.__temp=new L(0);var u=a;a.domElement=document.createElement("div"),d.makeSelectable(a.domElement,!1),a.__selector=document.createElement("div"),a.__selector.className="selector",a.__saturation_field=document.createElement("div"),a.__saturation_field.className="saturation-field",a.__field_knob=document.createElement("div"),a.__field_knob.className="field-knob",a.__field_knob_border="2px solid ",a.__hue_knob=document.createElement("div"),a.__hue_knob.className="hue-knob",a.__hue_field=document.createElement("div"),a.__hue_field.className="hue-field",a.__input=document.createElement("input"),a.__input.type="text",a.__input_textShadow="0 1px 1px ",d.bind(a.__input,"keydown",function(y){y.keyCode===13&&c.call(this)}),d.bind(a.__input,"blur",c),d.bind(a.__selector,"mousedown",function(){d.addClass(this,"drag").bind(window,"mouseup",function(){d.removeClass(u.__selector,"drag")})}),d.bind(a.__selector,"touchstart",function(){d.addClass(this,"drag").bind(window,"touchend",function(){d.removeClass(u.__selector,"drag")})});var t=document.createElement("div");h.extend(a.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),h.extend(a.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:a.__field_knob_border+(a.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),h.extend(a.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),h.extend(a.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),h.extend(t.style,{width:"100%",height:"100%",background:"none"}),Ge(t,"top","rgba(0,0,0,0)","#000"),h.extend(a.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),it(a.__hue_field),h.extend(a.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:a.__input_textShadow+"rgba(0,0,0,0.7)"}),d.bind(a.__saturation_field,"mousedown",i),d.bind(a.__saturation_field,"touchstart",i),d.bind(a.__field_knob,"mousedown",i),d.bind(a.__field_knob,"touchstart",i),d.bind(a.__hue_field,"mousedown",s),d.bind(a.__hue_field,"touchstart",s);function i(y){E(y),d.bind(window,"mousemove",E),d.bind(window,"touchmove",E),d.bind(window,"mouseup",l),d.bind(window,"touchend",l)}function s(y){A(y),d.bind(window,"mousemove",A),d.bind(window,"touchmove",A),d.bind(window,"mouseup",f),d.bind(window,"touchend",f)}function l(){d.unbind(window,"mousemove",E),d.unbind(window,"touchmove",E),d.unbind(window,"mouseup",l),d.unbind(window,"touchend",l),m()}function f(){d.unbind(window,"mousemove",A),d.unbind(window,"touchmove",A),d.unbind(window,"mouseup",f),d.unbind(window,"touchend",f),m()}function c(){var y=be(this.value);y!==!1?(u.__color.__state=y,u.setValue(u.__color.toOriginal())):this.value=u.__color.toString()}function m(){u.__onFinishChange&&u.__onFinishChange.call(u,u.__color.toOriginal())}a.__saturation_field.appendChild(t),a.__selector.appendChild(a.__field_knob),a.__selector.appendChild(a.__saturation_field),a.__selector.appendChild(a.__hue_field),a.__hue_field.appendChild(a.__hue_knob),a.domElement.appendChild(a.__input),a.domElement.appendChild(a.__selector),a.updateDisplay();function E(y){y.type.indexOf("touch")===-1&&y.preventDefault();var x=u.__saturation_field.getBoundingClientRect(),R=y.touches&&y.touches[0]||y,z=R.clientX,B=R.clientY,K=(z-x.left)/(x.right-x.left),W=1-(B-x.top)/(x.bottom-x.top);return W>1?W=1:W<0&&(W=0),K>1?K=1:K<0&&(K=0),u.__color.v=W,u.__color.s=K,u.setValue(u.__color.toOriginal()),!1}function A(y){y.type.indexOf("touch")===-1&&y.preventDefault();var x=u.__hue_field.getBoundingClientRect(),R=y.touches&&y.touches[0]||y,z=R.clientY,B=1-(z-x.top)/(x.bottom-x.top);return B>1?B=1:B<0&&(B=0),u.__color.h=B*360,u.setValue(u.__color.toOriginal()),!1}return a}return V(e,[{key:"updateDisplay",value:function(){var n=be(this.getValue());if(n!==!1){var a=!1;h.each(L.COMPONENTS,function(i){if(!h.isUndefined(n[i])&&!h.isUndefined(this.__color.__state[i])&&n[i]!==this.__color.__state[i])return a=!0,{}},this),a&&h.extend(this.__color.__state,n)}h.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var u=this.__color.v<.5||this.__color.s>.5?255:0,t=255-u;h.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+u+","+u+","+u+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Ge(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),h.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+u+","+u+","+u+")",textShadow:this.__input_textShadow+"rgba("+t+","+t+","+t+",.7)"})}}]),e}(ee),rt=["-moz-","-o-","-webkit-","-ms-",""];function Ge(o,e,r,n){o.style.background="",h.each(rt,function(a){o.style.cssText+="background: "+a+"linear-gradient("+e+", "+r+" 0%, "+n+" 100%); "})}function it(o){o.style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var ot={load:function(e,r){var n=r||document,a=n.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=e,n.getElementsByTagName("head")[0].appendChild(a)},inject:function(e,r){var n=r||document,a=document.createElement("style");a.type="text/css",a.innerHTML=e;var u=n.getElementsByTagName("head")[0];try{u.appendChild(a)}catch{}}},st=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,at=function(e,r){var n=e[r];return h.isArray(arguments[2])||h.isObject(arguments[2])?new et(e,r,arguments[2]):h.isNumber(n)?h.isNumber(arguments[2])&&h.isNumber(arguments[3])?h.isNumber(arguments[4])?new Ee(e,r,arguments[2],arguments[3],arguments[4]):new Ee(e,r,arguments[2],arguments[3]):h.isNumber(arguments[4])?new pe(e,r,{min:arguments[2],max:arguments[3],step:arguments[4]}):new pe(e,r,{min:arguments[2],max:arguments[3]}):h.isString(n)?new tt(e,r):h.isFunction(n)?new He(e,r,""):h.isBoolean(n)?new Re(e,r):null};function ut(o){setTimeout(o,1e3/60)}var lt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||ut,dt=function(){function o(){F(this,o),this.backgroundElement=document.createElement("div"),h.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),d.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),h.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;d.bind(this.backgroundElement,"click",function(){e.hide()})}return V(o,[{key:"show",value:function(){var r=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),h.defer(function(){r.backgroundElement.style.opacity=1,r.domElement.style.opacity=1,r.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var r=this,n=function a(){r.domElement.style.display="none",r.backgroundElement.style.display="none",d.unbind(r.domElement,"webkitTransitionEnd",a),d.unbind(r.domElement,"transitionend",a),d.unbind(r.domElement,"oTransitionEnd",a)};d.bind(this.domElement,"webkitTransitionEnd",n),d.bind(this.domElement,"transitionend",n),d.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"}}]),o}(),ct=ie(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);ot.inject(ct);var Be="dg",Fe=72,Ve=20,ae="Default",ue=function(){try{return!!window.localStorage}catch{return!1}}(),le=void 0,ze=!0,te=void 0,we=!1,Ue=[],T=function o(e){var r=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),d.addClass(this.domElement,Be),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=h.defaults(n,{closeOnTop:!1,autoPlace:!0,width:o.DEFAULT_WIDTH}),n=h.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),h.isUndefined(n.load)?n.load={preset:ae}:n.preset&&(n.load.preset=n.preset),h.isUndefined(n.parent)&&n.hideable&&Ue.push(this),n.resizable=h.isUndefined(n.parent)&&n.resizable,n.autoPlace&&h.isUndefined(n.scrollable)&&(n.scrollable=!0);var a=ue&&localStorage.getItem(ne(this,"isLocal"))==="true",u=void 0,t=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:n.load.preset},set:function(m){r.parent?r.getRoot().preset=m:n.load.preset=m,pt(this),r.revert()}},width:{get:function(){return n.width},set:function(m){n.width=m,xe(r,m)}},name:{get:function(){return n.name},set:function(m){n.name=m,t&&(t.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(m){n.closed=m,n.closed?d.addClass(r.__ul,o.CLASS_CLOSED):d.removeClass(r.__ul,o.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=m?o.TEXT_OPEN:o.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return a},set:function(m){ue&&(a=m,m?d.bind(window,"unload",u):d.unbind(window,"unload",u),localStorage.setItem(ne(r,"isLocal"),m))}}}),h.isUndefined(n.parent)){if(this.closed=n.closed||!1,d.addClass(this.domElement,o.CLASS_MAIN),d.makeSelectable(this.domElement,!1),ue&&a){r.useLocalStorage=!0;var i=localStorage.getItem(ne(this,"gui"));i&&(n.load=JSON.parse(i))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=o.TEXT_CLOSED,d.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON),n.closeOnTop?(d.addClass(this.__closeButton,o.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(d.addClass(this.__closeButton,o.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),d.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{n.closed===void 0&&(n.closed=!0);var s=document.createTextNode(n.name);d.addClass(s,"controller-name"),t=Ce(r,s);var l=function(m){return m.preventDefault(),r.closed=!r.closed,!1};d.addClass(this.__ul,o.CLASS_CLOSED),d.addClass(t,"title"),d.bind(t,"click",l),n.closed||(this.closed=!1)}n.autoPlace&&(h.isUndefined(n.parent)&&(ze&&(te=document.createElement("div"),d.addClass(te,Be),d.addClass(te,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(te),ze=!1),te.appendChild(this.domElement),d.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||xe(r,n.width)),this.__resizeHandler=function(){r.onResizeDebounced()},d.bind(window,"resize",this.__resizeHandler),d.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),d.bind(this.__ul,"transitionend",this.__resizeHandler),d.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&_t(this),u=function(){ue&&localStorage.getItem(ne(r,"isLocal"))==="true"&&localStorage.setItem(ne(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=u;function f(){var c=r.getRoot();c.width+=1,h.defer(function(){c.width-=1})}n.parent||f()};T.toggleHide=function(){we=!we,h.each(Ue,function(o){o.domElement.style.display=we?"none":""})},T.CLASS_AUTO_PLACE="a",T.CLASS_AUTO_PLACE_CONTAINER="ac",T.CLASS_MAIN="main",T.CLASS_CONTROLLER_ROW="cr",T.CLASS_TOO_TALL="taller-than-window",T.CLASS_CLOSED="closed",T.CLASS_CLOSE_BUTTON="close-button",T.CLASS_CLOSE_TOP="close-top",T.CLASS_CLOSE_BOTTOM="close-bottom",T.CLASS_DRAG="drag",T.DEFAULT_WIDTH=245,T.TEXT_CLOSED="Close Controls",T.TEXT_OPEN="Open Controls",T._keydownHandler=function(o){document.activeElement.type!=="text"&&(o.which===Fe||o.keyCode===Fe)&&T.toggleHide()},d.bind(window,"keydown",T._keydownHandler,!1),h.extend(T.prototype,{add:function(e,r){return de(this,e,r,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,r){return de(this,e,r,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var r=this;h.defer(function(){r.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&te.removeChild(this.domElement);var e=this;h.each(this.__folders,function(r){e.removeFolder(r)}),d.unbind(window,"keydown",T._keydownHandler,!1),$e(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var r={name:e,parent:this};r.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(r.closed=this.load.folders[e].closed,r.load=this.load.folders[e]);var n=new T(r);this.__folders[e]=n;var a=Ce(this,n.domElement);return d.addClass(a,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],$e(e);var r=this;h.each(e.__folders,function(n){e.removeFolder(n)}),h.defer(function(){r.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var r=d.getOffset(e.__ul).top,n=0;h.each(e.__ul.childNodes,function(a){e.autoPlace&&a===e.__save_row||(n+=d.getHeight(a))}),window.innerHeight-r-Ve<n?(d.addClass(e.domElement,T.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-r-Ve+"px"):(d.removeClass(e.domElement,T.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&h.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:h.debounce(function(){this.onResize()},50),remember:function(){if(h.isUndefined(le)&&(le=new dt,le.domElement.innerHTML=st),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;h.each(Array.prototype.slice.call(arguments),function(r){e.__rememberedObjects.length===0&&ht(e),e.__rememberedObjects.indexOf(r)===-1&&e.__rememberedObjects.push(r)}),this.autoPlace&&xe(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=me(this)),e.folders={},h.each(this.__folders,function(r,n){e.folders[n]=r.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=me(this),Ae(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ae]=me(this,!0)),this.load.remembered[e]=me(this),this.preset=e,Me(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){h.each(this.__controllers,function(r){this.getRoot().load.remembered?Ye(e||this.getRoot(),r):r.setValue(r.initialValue),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())},this),h.each(this.__folders,function(r){r.revert(r)}),e||Ae(this.getRoot(),!1)},listen:function(e){var r=this.__listening.length===0;this.__listening.push(e),r&&We(this.__listening)},updateDisplay:function(){h.each(this.__controllers,function(e){e.updateDisplay()}),h.each(this.__folders,function(e){e.updateDisplay()})}});function Ce(o,e,r){var n=document.createElement("li");return e&&n.appendChild(e),r?o.__ul.insertBefore(n,r):o.__ul.appendChild(n),o.onResize(),n}function $e(o){d.unbind(window,"resize",o.__resizeHandler),o.saveToLocalStorageIfPossible&&d.unbind(window,"unload",o.saveToLocalStorageIfPossible)}function Ae(o,e){var r=o.__preset_select[o.__preset_select.selectedIndex];e?r.innerHTML=r.value+"*":r.innerHTML=r.value}function ft(o,e,r){if(r.__li=e,r.__gui=o,h.extend(r,{options:function(t){if(arguments.length>1){var i=r.__li.nextElementSibling;return r.remove(),de(o,r.object,r.property,{before:i,factoryArgs:[h.toArray(arguments)]})}if(h.isArray(t)||h.isObject(t)){var s=r.__li.nextElementSibling;return r.remove(),de(o,r.object,r.property,{before:s,factoryArgs:[t]})}},name:function(t){return r.__li.firstElementChild.firstElementChild.innerHTML=t,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof Ee){var n=new pe(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});h.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(u){var t=r[u],i=n[u];r[u]=n[u]=function(){var s=Array.prototype.slice.call(arguments);return i.apply(n,s),t.apply(r,s)}}),d.addClass(e,"has-slider"),r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof pe){var a=function(t){if(h.isNumber(r.__min)&&h.isNumber(r.__max)){var i=r.__li.firstElementChild.firstElementChild.innerHTML,s=r.__gui.__listening.indexOf(r)>-1;r.remove();var l=de(o,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]});return l.name(i),s&&l.listen(),l}return t};r.min=h.compose(a,r.min),r.max=h.compose(a,r.max)}else r instanceof Re?(d.bind(e,"click",function(){d.fakeEvent(r.__checkbox,"click")}),d.bind(r.__checkbox,"click",function(u){u.stopPropagation()})):r instanceof He?(d.bind(e,"click",function(){d.fakeEvent(r.__button,"click")}),d.bind(e,"mouseover",function(){d.addClass(r.__button,"hover")}),d.bind(e,"mouseout",function(){d.removeClass(r.__button,"hover")})):r instanceof Se&&(d.addClass(e,"color"),r.updateDisplay=h.compose(function(u){return e.style.borderLeftColor=r.__color.toString(),u},r.updateDisplay),r.updateDisplay());r.setValue=h.compose(function(u){return o.getRoot().__preset_select&&r.isModified()&&Ae(o.getRoot(),!0),u},r.setValue)}function Ye(o,e){var r=o.getRoot(),n=r.__rememberedObjects.indexOf(e.object);if(n!==-1){var a=r.__rememberedObjectIndecesToControllers[n];if(a===void 0&&(a={},r.__rememberedObjectIndecesToControllers[n]=a),a[e.property]=e,r.load&&r.load.remembered){var u=r.load.remembered,t=void 0;if(u[o.preset])t=u[o.preset];else if(u[ae])t=u[ae];else return;if(t[n]&&t[n][e.property]!==void 0){var i=t[n][e.property];e.initialValue=i,e.setValue(i)}}}}function de(o,e,r,n){if(e[r]===void 0)throw new Error('Object "'+e+'" has no property "'+r+'"');var a=void 0;if(n.color)a=new Se(e,r);else{var u=[e,r].concat(n.factoryArgs);a=at.apply(o,u)}n.before instanceof ee&&(n.before=n.before.__li),Ye(o,a),d.addClass(a.domElement,"c");var t=document.createElement("span");d.addClass(t,"property-name"),t.innerHTML=a.property;var i=document.createElement("div");i.appendChild(t),i.appendChild(a.domElement);var s=Ce(o,i,n.before);return d.addClass(s,T.CLASS_CONTROLLER_ROW),a instanceof Se?d.addClass(s,"color"):d.addClass(s,Je(a.getValue())),ft(o,s,a),o.__controllers.push(a),a}function ne(o,e){return document.location.href+"."+e}function Me(o,e,r){var n=document.createElement("option");n.innerHTML=e,n.value=e,o.__preset_select.appendChild(n),r&&(o.__preset_select.selectedIndex=o.__preset_select.length-1)}function Ke(o,e){e.style.display=o.useLocalStorage?"block":"none"}function ht(o){var e=o.__save_row=document.createElement("li");d.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),d.addClass(e,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",d.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save",d.addClass(n,"button"),d.addClass(n,"save");var a=document.createElement("span");a.innerHTML="New",d.addClass(a,"button"),d.addClass(a,"save-as");var u=document.createElement("span");u.innerHTML="Revert",d.addClass(u,"button"),d.addClass(u,"revert");var t=o.__preset_select=document.createElement("select");if(o.load&&o.load.remembered?h.each(o.load.remembered,function(c,m){Me(o,m,m===o.preset)}):Me(o,ae,!1),d.bind(t,"change",function(){for(var c=0;c<o.__preset_select.length;c++)o.__preset_select[c].innerHTML=o.__preset_select[c].value;o.preset=this.value}),e.appendChild(t),e.appendChild(r),e.appendChild(n),e.appendChild(a),e.appendChild(u),ue){var i=document.getElementById("dg-local-explain"),s=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(ne(o,"isLocal"))==="true"&&s.setAttribute("checked","checked"),Ke(o,i),d.bind(s,"change",function(){o.useLocalStorage=!o.useLocalStorage,Ke(o,i)})}var f=document.getElementById("dg-new-constructor");d.bind(f,"keydown",function(c){c.metaKey&&(c.which===67||c.keyCode===67)&&le.hide()}),d.bind(r,"click",function(){f.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),le.show(),f.focus(),f.select()}),d.bind(n,"click",function(){o.save()}),d.bind(a,"click",function(){var c=prompt("Enter a new preset name.");c&&o.saveAs(c)}),d.bind(u,"click",function(){o.revert()})}function _t(o){var e=void 0;o.__resize_handle=document.createElement("div"),h.extend(o.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function r(u){return u.preventDefault(),o.width+=e-u.clientX,o.onResize(),e=u.clientX,!1}function n(){d.removeClass(o.__closeButton,T.CLASS_DRAG),d.unbind(window,"mousemove",r),d.unbind(window,"mouseup",n)}function a(u){return u.preventDefault(),e=u.clientX,d.addClass(o.__closeButton,T.CLASS_DRAG),d.bind(window,"mousemove",r),d.bind(window,"mouseup",n),!1}d.bind(o.__resize_handle,"mousedown",a),d.bind(o.__closeButton,"mousedown",a),o.domElement.insertBefore(o.__resize_handle,o.domElement.firstElementChild)}function xe(o,e){o.domElement.style.width=e+"px",o.__save_row&&o.autoPlace&&(o.__save_row.style.width=e+"px"),o.__closeButton&&(o.__closeButton.style.width=e+"px")}function me(o,e){var r={};return h.each(o.__rememberedObjects,function(n,a){var u={},t=o.__rememberedObjectIndecesToControllers[a];h.each(t,function(i,s){u[s]=e?i.initialValue:i.getValue()}),r[a]=u}),r}function pt(o){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].value===o.preset&&(o.__preset_select.selectedIndex=e)}function We(o){o.length!==0&&lt.call(window,function(){We(o)}),h.each(o,function(e){e.updateDisplay()})}var qe=T,mt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Xe={exports:{}};(function(o){(function(e){function r(){if(r.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(r.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return this.interface!==void 0}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(t){return this._nrpnEventsEnabled=t,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var n=new r;function a(t){var i=this;this._userHandlers={channel:{},system:{}},this._midiInput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiInput.connection}},id:{enumerable:!0,get:function(){return i._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiInput.name}},state:{enumerable:!0,get:function(){return i._midiInput.state}},type:{enumerable:!0,get:function(){return i._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function u(t){var i=this;this._midiOutput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiOutput.connection}},id:{enumerable:!0,get:function(){return i._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiOutput.name}},state:{enumerable:!0,get:function(){return i._midiOutput.state}},type:{enumerable:!0,get:function(){return i._midiOutput.type}}})}r.prototype.enable=function(t,i){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:i}).then(function(s){var l,f=[],c=[];this.interface=s,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(R){f.push(R)};for(var m=s.inputs.values(),E=m.next();E&&!E.done;E=m.next())c.push(E.value.open());for(var A=s.outputs.values(),y=A.next();y&&!y.done;y=A.next())c.push(y.value.open());function x(){clearTimeout(l),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),typeof t=="function"&&t.call(this),f.forEach(function(R){this._onInterfaceStateChange(R)}.bind(this))}l=setTimeout(x.bind(this),200),Promise&&Promise.all(c).catch(function(R){}).then(x.bind(this))}.bind(this),function(s){typeof t=="function"&&t.call(this,s)}.bind(this)):typeof t=="function"&&t(new Error("The Web MIDI API is not supported by your browser.")))},r.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.enabled&&(this.removeListener(),this.inputs.forEach(function(t){t.removeListener()})),this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},r.prototype.addListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if(typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[t].push(i),this},r.prototype.hasListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if(typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");for(var s=0;s<this._userHandlers[t].length;s++)if(this._userHandlers[t][s]===i)return!0;return!1},r.prototype.removeListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(i!==void 0&&typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(t))if(i)for(var s=0;s<this._userHandlers[t].length;s++)this._userHandlers[t][s]===i&&this._userHandlers[t].splice(s,1);else this._userHandlers[t]=[];else{if(t!==void 0)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},r.prototype.toMIDIChannels=function(t){var i;if(t==="all"||t===void 0)i=["all"];else{if(t==="none")return i=[];i=Array.isArray(t)?t:[t]}return-1<i.indexOf("all")&&(i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),i.map(function(s){return parseInt(s)}).filter(function(s){return 1<=s&&s<=16})},r.prototype.getInputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===t)return this.inputs[i];return!1},r.prototype.getOutputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===t)return this.outputs[i];return!1},r.prototype.getInputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(t))return this.inputs[i];return!1},r.prototype.getOctave=function(t){if(t!=null&&0<=t&&t<=127)return Math.floor(Math.floor(t)/12-1)+Math.floor(n.octaveOffset)},r.prototype.getOutputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(t))return this.outputs[i];return!1},r.prototype.guessNoteNumber=function(t){var i=!1;if(t&&t.toFixed&&0<=t&&t<=127?i=Math.round(t):0<=parseInt(t)&&parseInt(t)<=127?i=parseInt(t):(typeof t=="string"||t instanceof String)&&(i=this.noteNameToNumber(t)),i===!1)throw new Error("Invalid input value ("+t+").");return i},r.prototype.noteNameToNumber=function(t){typeof t!="string"&&(t="");var i=t.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!i)throw new RangeError("Invalid note name.");var s=n._semitones[i[1].toUpperCase()],l=12*(parseInt(i[3])+1-Math.floor(n.octaveOffset))+s;if(-1<i[2].toLowerCase().indexOf("b")?l-=i[2].length:-1<i[2].toLowerCase().indexOf("#")&&(l+=i[2].length),l<0||127<l)throw new RangeError("Invalid note name or note outside valid range.");return l},r.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},r.prototype._updateInputs=function(){for(var t=0;t<this._inputs.length;t++){for(var i=!0,s=this.interface.inputs.values(),l=s.next();l&&!l.done;l=s.next())if(this._inputs[t]._midiInput===l.value){i=!1;break}i&&this._inputs.splice(t,1)}this.interface&&this.interface.inputs.forEach(function(f){for(var c=!0,m=0;m<this._inputs.length;m++)this._inputs[m]._midiInput===f&&(c=!1);c&&this._inputs.push(new a(f))}.bind(this))},r.prototype._updateOutputs=function(){for(var t=0;t<this._outputs.length;t++){for(var i=!0,s=this.interface.outputs.values(),l=s.next();l&&!l.done;l=s.next())if(this._outputs[t]._midiOutput===l.value){i=!1;break}i&&this._outputs.splice(t,1)}this.interface&&this.interface.outputs.forEach(function(f){for(var c=!0,m=0;m<this._outputs.length;m++)this._outputs[m]._midiOutput===f&&(c=!1);c&&this._outputs.push(new u(f))}.bind(this))},r.prototype._onInterfaceStateChange=function(t){this._updateInputsAndOutputs();var i={timestamp:t.timeStamp,type:t.port.state};this.interface&&t.port.state==="connected"?t.port.type==="output"?i.port=this.getOutputById(t.port.id):t.port.type==="input"&&(i.port=this.getInputById(t.port.id)):i.port={connection:"closed",id:t.port.id,manufacturer:t.port.manufacturer,name:t.port.name,state:t.port.state,type:t.port.type},this._userHandlers[t.port.state].forEach(function(s){s(i)})},r.prototype._resetInterfaceUserHandlers=function(){for(var t=0;t<this._midiInterfaceEvents.length;t++)this._userHandlers[this._midiInterfaceEvents[t]]=[]},a.prototype.on=a.prototype.addListener=function(t,i,s){var l=this;if(i===void 0&&(i="all"),Array.isArray(i)||(i=[i]),i.forEach(function(c){if(c!=="all"&&!(1<=c&&c<=16))throw new RangeError("The 'channel' parameter is invalid.")}),typeof s!="function")throw new TypeError("The 'listener' parameter must be a function.");if(n.MIDI_SYSTEM_MESSAGES[t]!==void 0)this._userHandlers.system[t]||(this._userHandlers.system[t]=[]),this._userHandlers.system[t].push(s);else{if(n.MIDI_CHANNEL_MESSAGES[t]===void 0)throw new TypeError("The specified event type is not supported.");if(-1<i.indexOf("all")){i=[];for(var f=1;f<=16;f++)i.push(f)}this._userHandlers.channel[t]||(this._userHandlers.channel[t]=[]),i.forEach(function(c){l._userHandlers.channel[t][c]||(l._userHandlers.channel[t][c]=[]),l._userHandlers.channel[t][c].push(s)})}return this},a.prototype.hasListener=function(t,i,s){var l=this;if(typeof s!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i===void 0&&(i="all"),i.constructor!==Array&&(i=[i]),n.MIDI_SYSTEM_MESSAGES[t]!==void 0){for(var f=0;f<this._userHandlers.system[t].length;f++)if(this._userHandlers.system[t][f]===s)return!0}else if(n.MIDI_CHANNEL_MESSAGES[t]!==void 0){if(-1<i.indexOf("all")){i=[];for(var c=1;c<=16;c++)i.push(c)}return!!this._userHandlers.channel[t]&&i.every(function(m){var E=l._userHandlers.channel[t][m];return E&&-1<E.indexOf(s)})}return!1},a.prototype.removeListener=function(t,i,s){var l=this;if(s!==void 0&&typeof s!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i===void 0&&(i="all"),i.constructor!==Array&&(i=[i]),n.MIDI_SYSTEM_MESSAGES[t]!==void 0)if(s===void 0)this._userHandlers.system[t]=[];else for(var f=0;f<this._userHandlers.system[t].length;f++)this._userHandlers.system[t][f]===s&&this._userHandlers.system[t].splice(f,1);else if(n.MIDI_CHANNEL_MESSAGES[t]!==void 0){if(-1<i.indexOf("all")){i=[];for(var c=1;c<=16;c++)i.push(c)}if(!this._userHandlers.channel[t])return this;i.forEach(function(m){var E=l._userHandlers.channel[t][m];if(E)if(s===void 0)l._userHandlers.channel[t][m]=[];else for(var A=0;A<E.length;A++)E[A]===s&&E.splice(A,1)})}else{if(t!==void 0)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},a.prototype._initializeUserHandlers=function(){for(var t in n.MIDI_CHANNEL_MESSAGES)Object.prototype.hasOwnProperty.call(n.MIDI_CHANNEL_MESSAGES,t)&&(this._userHandlers.channel[t]={});for(var i in n.MIDI_SYSTEM_MESSAGES)Object.prototype.hasOwnProperty.call(n.MIDI_SYSTEM_MESSAGES,i)&&(this._userHandlers.system[i]=[])},a.prototype._onMidiMessage=function(t){if(0<this._userHandlers.system.midimessage.length){var i={target:this,data:t.data,timestamp:t.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(s){s(i)})}t.data[0]<240?(this._parseChannelEvent(t),this._parseNrpnEvent(t)):t.data[0]<=255&&this._parseSystemEvent(t)},a.prototype._parseNrpnEvent=function(t){var i,s,l=t.data[0]>>4,f=15&t.data[0],c=1+f;if(1<t.data.length&&(i=t.data[1],s=2<t.data.length?t.data[2]:void 0),n.nrpnEventsEnabled&&l===n.MIDI_CHANNEL_MESSAGES.controlchange&&(i>=n.MIDI_NRPN_MESSAGES.increment&&i<=n.MIDI_NRPN_MESSAGES.parammsb||i===n.MIDI_NRPN_MESSAGES.entrymsb||i===n.MIDI_NRPN_MESSAGES.entrylsb)){var m={target:this,type:"controlchange",data:t.data,timestamp:t.timeStamp,channel:c,controller:{number:i,name:this.getCcNameByNumber(i)},value:s};if(m.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&m.value!=n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[f]=[],n._nrpnBuffer[f][0]=m;else if(n._nrpnBuffer[f].length===1&&m.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb)n._nrpnBuffer[f].push(m);else if(n._nrpnBuffer[f].length!==2||m.controller.number!==n.MIDI_NRPN_MESSAGES.increment&&m.controller.number!==n.MIDI_NRPN_MESSAGES.decrement&&m.controller.number!==n.MIDI_NRPN_MESSAGES.entrymsb)if(n._nrpnBuffer[f].length===3&&n._nrpnBuffer[f][2].number===n.MIDI_NRPN_MESSAGES.entrymsb&&m.controller.number===n.MIDI_NRPN_MESSAGES.entrylsb)n._nrpnBuffer[f].push(m);else if(3<=n._nrpnBuffer[f].length&&n._nrpnBuffer[f].length<=4&&m.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&m.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[f].push(m);else if(4<=n._nrpnBuffer[f].length&&n._nrpnBuffer[f].length<=5&&m.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb&&m.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter){n._nrpnBuffer[f].push(m);var E=[];n._nrpnBuffer[f].forEach(function(z){E.push(z.data)});var A=n._nrpnBuffer[f][0].value<<7|n._nrpnBuffer[f][1].value,y=n._nrpnBuffer[f][2].value;n._nrpnBuffer[f].length===6&&(y=n._nrpnBuffer[f][2].value<<7|n._nrpnBuffer[f][3].value);var x="";switch(n._nrpnBuffer[f][2].controller.number){case n.MIDI_NRPN_MESSAGES.entrymsb:x=n._nrpnTypes[0];break;case n.MIDI_NRPN_MESSAGES.increment:x=n._nrpnTypes[1];break;case n.MIDI_NRPN_MESSAGES.decrement:x=n._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var R={timestamp:m.timestamp,channel:m.channel,type:"nrpn",data:E,controller:{number:A,type:x,name:"Non-Registered Parameter "+A},value:y};n._nrpnBuffer[f]=[],this._userHandlers.channel[R.type]&&this._userHandlers.channel[R.type][R.channel]&&this._userHandlers.channel[R.type][R.channel].forEach(function(z){z(R)})}else n._nrpnBuffer[f]=[];else n._nrpnBuffer[f].push(m)}},a.prototype._parseChannelEvent=function(t){var i,s,l=t.data[0]>>4,f=1+(15&t.data[0]);1<t.data.length&&(i=t.data[1],s=2<t.data.length?t.data[2]:void 0);var c={target:this,data:t.data,timestamp:t.timeStamp,channel:f};l===n.MIDI_CHANNEL_MESSAGES.noteoff||l===n.MIDI_CHANNEL_MESSAGES.noteon&&s===0?(c.type="noteoff",c.note={number:i,name:n._notes[i%12],octave:n.getOctave(i)},c.velocity=s/127,c.rawVelocity=s):l===n.MIDI_CHANNEL_MESSAGES.noteon?(c.type="noteon",c.note={number:i,name:n._notes[i%12],octave:n.getOctave(i)},c.velocity=s/127,c.rawVelocity=s):l===n.MIDI_CHANNEL_MESSAGES.keyaftertouch?(c.type="keyaftertouch",c.note={number:i,name:n._notes[i%12],octave:n.getOctave(i)},c.value=s/127):l===n.MIDI_CHANNEL_MESSAGES.controlchange&&0<=i&&i<=119?(c.type="controlchange",c.controller={number:i,name:this.getCcNameByNumber(i)},c.value=s):l===n.MIDI_CHANNEL_MESSAGES.channelmode&&120<=i&&i<=127?(c.type="channelmode",c.controller={number:i,name:this.getChannelModeByNumber(i)},c.value=s):l===n.MIDI_CHANNEL_MESSAGES.programchange?(c.type="programchange",c.value=i):l===n.MIDI_CHANNEL_MESSAGES.channelaftertouch?(c.type="channelaftertouch",c.value=i/127):l===n.MIDI_CHANNEL_MESSAGES.pitchbend?(c.type="pitchbend",c.value=((s<<7)+i-8192)/8192):c.type="unknownchannelmessage",this._userHandlers.channel[c.type]&&this._userHandlers.channel[c.type][f]&&this._userHandlers.channel[c.type][f].forEach(function(m){m(c)})},a.prototype.getCcNameByNumber=function(t){if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var i in n.MIDI_CONTROL_CHANGE_MESSAGES)if(Object.prototype.hasOwnProperty.call(n.MIDI_CONTROL_CHANGE_MESSAGES,i)&&t===n.MIDI_CONTROL_CHANGE_MESSAGES[i])return i},a.prototype.getChannelModeByNumber=function(t){if(!(120<=(t=Math.floor(t))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var i in n.MIDI_CHANNEL_MODE_MESSAGES)if(Object.prototype.hasOwnProperty.call(n.MIDI_CHANNEL_MODE_MESSAGES,i)&&t===n.MIDI_CHANNEL_MODE_MESSAGES[i])return i},a.prototype._parseSystemEvent=function(t){var i=t.data[0],s={target:this,data:t.data,timestamp:t.timeStamp};i===n.MIDI_SYSTEM_MESSAGES.sysex?s.type="sysex":i===n.MIDI_SYSTEM_MESSAGES.timecode?s.type="timecode":i===n.MIDI_SYSTEM_MESSAGES.songposition?s.type="songposition":i===n.MIDI_SYSTEM_MESSAGES.songselect?(s.type="songselect",s.song=t.data[1]):i===n.MIDI_SYSTEM_MESSAGES.tuningrequest?s.type="tuningrequest":i===n.MIDI_SYSTEM_MESSAGES.clock?s.type="clock":i===n.MIDI_SYSTEM_MESSAGES.start?s.type="start":i===n.MIDI_SYSTEM_MESSAGES.continue?s.type="continue":i===n.MIDI_SYSTEM_MESSAGES.stop?s.type="stop":i===n.MIDI_SYSTEM_MESSAGES.activesensing?s.type="activesensing":i===n.MIDI_SYSTEM_MESSAGES.reset?s.type="reset":s.type="unknownsystemmessage",this._userHandlers.system[s.type]&&this._userHandlers.system[s.type].forEach(function(l){l(s)})},u.prototype.send=function(t,i,s){if(!(128<=t&&t<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");i===void 0&&(i=[]),Array.isArray(i)||(i=[i]);var l=[];return i.forEach(function(f){var c=Math.floor(f);if(!(0<=c&&c<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");l.push(c)}),this._midiOutput.send([t].concat(l),parseFloat(s)||0),this},u.prototype.sendSysex=function(t,i,s){if(!n.sysexEnabled)throw new Error("Sysex message support must first be activated.");return s=s||{},t=[].concat(t),i.forEach(function(l){if(l<0||127<l)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),i=t.concat(i,n.MIDI_SYSTEM_MESSAGES.sysexend),this.send(n.MIDI_SYSTEM_MESSAGES.sysex,i,this._parseTimeParameter(s.time)),this},u.prototype.sendTimecodeQuarterFrame=function(t,i){return i=i||{},this.send(n.MIDI_SYSTEM_MESSAGES.timecode,t,this._parseTimeParameter(i.time)),this},u.prototype.sendSongPosition=function(t,i){i=i||{};var s=(t=Math.floor(t)||0)>>7&127,l=127&t;return this.send(n.MIDI_SYSTEM_MESSAGES.songposition,[s,l],this._parseTimeParameter(i.time)),this},u.prototype.sendSongSelect=function(t,i){if(i=i||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(n.MIDI_SYSTEM_MESSAGES.songselect,[t],this._parseTimeParameter(i.time)),this},u.prototype.sendTuningRequest=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendClock=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendStart=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendContinue=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendStop=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendActiveSensing=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(t.time)),this},u.prototype.sendReset=function(t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(t.time)),this},u.prototype.stopNote=function(t,i,s){if(t==="all")return this.sendChannelMode("allnotesoff",0,i,s);var l=64;return(s=s||{}).rawVelocity?!isNaN(s.velocity)&&0<=s.velocity&&s.velocity<=127&&(l=s.velocity):!isNaN(s.velocity)&&0<=s.velocity&&s.velocity<=1&&(l=127*s.velocity),this._convertNoteToArray(t).forEach(function(f){n.toMIDIChannels(i).forEach(function(c){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(c-1),[f,Math.round(l)],this._parseTimeParameter(s.time))}.bind(this))}.bind(this)),this},u.prototype.playNote=function(t,i,s){var l,f=64;if((s=s||{}).rawVelocity?!isNaN(s.velocity)&&0<=s.velocity&&s.velocity<=127&&(f=s.velocity):!isNaN(s.velocity)&&0<=s.velocity&&s.velocity<=1&&(f=127*s.velocity),l=this._parseTimeParameter(s.time),this._convertNoteToArray(t).forEach(function(m){n.toMIDIChannels(i).forEach(function(E){this.send((n.MIDI_CHANNEL_MESSAGES.noteon<<4)+(E-1),[m,Math.round(f)],l)}.bind(this))}.bind(this)),!isNaN(s.duration)){s.duration<=0&&(s.duration=0);var c=64;s.rawVelocity?!isNaN(s.release)&&0<=s.release&&s.release<=127&&(c=s.release):!isNaN(s.release)&&0<=s.release&&s.release<=1&&(c=127*s.release),this._convertNoteToArray(t).forEach(function(m){n.toMIDIChannels(i).forEach(function(E){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(E-1),[m,Math.round(c)],(l||n.time)+s.duration)}.bind(this))}.bind(this))}return this},u.prototype.sendKeyAftertouch=function(t,i,s,l){var f=this;if(l=l||{},i<1||16<i)throw new RangeError("The channel must be between 1 and 16.");(isNaN(s)||s<0||1<s)&&(s=.5);var c=Math.round(127*s);return this._convertNoteToArray(t).forEach(function(m){n.toMIDIChannels(i).forEach(function(E){f.send((n.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(E-1),[m,c],f._parseTimeParameter(l.time))})}),this},u.prototype.sendControlChange=function(t,i,s,l){if(l=l||{},typeof t=="string"){if((t=n.MIDI_CONTROL_CHANGE_MESSAGES[t])===void 0)throw new TypeError("Invalid controller name.")}else if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("Controller value must be between 0 and 127.");return n.toMIDIChannels(s).forEach(function(f){this.send((n.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(f-1),[t,i],this._parseTimeParameter(l.time))}.bind(this)),this},u.prototype._selectRegisteredParameter=function(t,i,s){var l=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){l.sendControlChange(101,t[0],i,{time:s}),l.sendControlChange(100,t[1],i,{time:s})}),this},u.prototype._selectNonRegisteredParameter=function(t,i,s){var l=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){l.sendControlChange(99,t[0],i,{time:s}),l.sendControlChange(98,t[1],i,{time:s})}),this},u.prototype._setCurrentRegisteredParameter=function(t,i,s){var l=this;if((t=[].concat(t))[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){l.sendControlChange(6,t[0],i,{time:s})}),t[1]=Math.floor(t[1]),0<=t[1]&&t[1]<=127&&n.toMIDIChannels(i).forEach(function(){l.sendControlChange(38,t[1],i,{time:s})}),this},u.prototype._deselectRegisteredParameter=function(t,i){var s=this;return n.toMIDIChannels(t).forEach(function(){s.sendControlChange(101,127,t,{time:i}),s.sendControlChange(100,127,t,{time:i})}),this},u.prototype.setRegisteredParameter=function(t,i,s,l){var f=this;if(l=l||{},!Array.isArray(t)){if(!n.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=n.MIDI_REGISTERED_PARAMETER[t]}return n.toMIDIChannels(s).forEach(function(){f._selectRegisteredParameter(t,s,l.time),f._setCurrentRegisteredParameter(i,s,l.time),f._deselectRegisteredParameter(s,l.time)}),this},u.prototype.setNonRegisteredParameter=function(t,i,s,l){var f=this;if(l=l||{},!(0<=t[0]&&t[0]<=127&&0<=t[1]&&t[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return i=[].concat(i),n.toMIDIChannels(s).forEach(function(){f._selectNonRegisteredParameter(t,s,l.time),f._setCurrentRegisteredParameter(i,s,l.time),f._deselectRegisteredParameter(s,l.time)}),this},u.prototype.incrementRegisteredParameter=function(t,i,s){var l=this;if(s=s||{},!Array.isArray(t)){if(!n.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=n.MIDI_REGISTERED_PARAMETER[t]}return n.toMIDIChannels(i).forEach(function(){l._selectRegisteredParameter(t,i,s.time),l.sendControlChange(96,0,i,{time:s.time}),l._deselectRegisteredParameter(i,s.time)}),this},u.prototype.decrementRegisteredParameter=function(t,i,s){if(s=s||{},!Array.isArray(t)){if(!n.MIDI_REGISTERED_PARAMETER[t])throw new TypeError("The specified parameter is not available.");t=n.MIDI_REGISTERED_PARAMETER[t]}return n.toMIDIChannels(i).forEach(function(){this._selectRegisteredParameter(t,i,s.time),this.sendControlChange(97,0,i,{time:s.time}),this._deselectRegisteredParameter(i,s.time)}.bind(this)),this},u.prototype.setPitchBendRange=function(t,i,s,l){var f=this;if(l=l||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(s).forEach(function(){f.setRegisteredParameter("pitchbendrange",[t,i],s,{time:l.time})}),this},u.prototype.setModulationRange=function(t,i,s,l){var f=this;if(l=l||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(s).forEach(function(){f.setRegisteredParameter("modulationrange",[t,i],s,{time:l.time})}),this},u.prototype.setMasterTuning=function(t,i,s){var l=this;if(s=s||{},(t=parseFloat(t)||0)<=-65||64<=t)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var f=Math.floor(t)+64,c=t-Math.floor(t),m=(c=Math.round((c+1)/2*16383))>>7&127,E=127&c;return n.toMIDIChannels(i).forEach(function(){l.setRegisteredParameter("channelcoarsetuning",f,i,{time:s.time}),l.setRegisteredParameter("channelfinetuning",[m,E],i,{time:s.time})}),this},u.prototype.setTuningProgram=function(t,i,s){var l=this;if(s=s||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The program value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){l.setRegisteredParameter("tuningprogram",t,i,{time:s.time})}),this},u.prototype.setTuningBank=function(t,i,s){var l=this;if(s=s||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The bank value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){l.setRegisteredParameter("tuningbank",t,i,{time:s.time})}),this},u.prototype.sendChannelMode=function(t,i,s,l){if(l=l||{},typeof t=="string"){if(!(t=n.MIDI_CHANNEL_MODE_MESSAGES[t]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(t=Math.floor(t))&&t<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((i=Math.floor(i)||0)<0||127<i)throw new RangeError("Value must be an integer between 0 and 127.");return n.toMIDIChannels(s).forEach(function(f){this.send((n.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(f-1),[t,i],this._parseTimeParameter(l.time))}.bind(this)),this},u.prototype.sendProgramChange=function(t,i,s){var l=this;if(s=s||{},t=Math.floor(t),isNaN(t)||t<0||127<t)throw new RangeError("Program numbers must be between 0 and 127.");return n.toMIDIChannels(i).forEach(function(f){l.send((n.MIDI_CHANNEL_MESSAGES.programchange<<4)+(f-1),[t],l._parseTimeParameter(s.time))}),this},u.prototype.sendChannelAftertouch=function(t,i,s){var l=this;s=s||{},t=parseFloat(t),(isNaN(t)||t<0||1<t)&&(t=.5);var f=Math.round(127*t);return n.toMIDIChannels(i).forEach(function(c){l.send((n.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(c-1),[f],l._parseTimeParameter(s.time))}),this},u.prototype.sendPitchBend=function(t,i,s){var l=this;if(s=s||{},isNaN(t)||t<-1||1<t)throw new RangeError("Pitch bend value must be between -1 and 1.");var f=Math.round((t+1)/2*16383),c=f>>7&127,m=127&f;return n.toMIDIChannels(i).forEach(function(E){l.send((n.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(E-1),[m,c],l._parseTimeParameter(s.time))}),this},u.prototype._parseTimeParameter=function(t){var i,s=parseFloat(t);return typeof t=="string"&&t.substring(0,1)==="+"?s&&0<s&&(i=n.time+s):s>n.time&&(i=s),i},u.prototype._convertNoteToArray=function(t){var i=[];return Array.isArray(t)||(t=[t]),t.forEach(function(s){i.push(n.guessNoteNumber(s))}),i},o.exports?o.exports=n:e.WebMidi||(e.WebMidi=n)})(mt)})(Xe);var gt=Xe.exports,Ie={exports:{}};(function(o){(function(e,r,n){if(!e)return;for(var a={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},i={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},s,l=1;l<20;++l)a[111+l]="f"+l;for(l=0;l<=9;++l)a[l+96]=l.toString();function f(_,g,C){if(_.addEventListener){_.addEventListener(g,C,!1);return}_.attachEvent("on"+g,C)}function c(_){if(_.type=="keypress"){var g=String.fromCharCode(_.which);return _.shiftKey||(g=g.toLowerCase()),g}return a[_.which]?a[_.which]:u[_.which]?u[_.which]:String.fromCharCode(_.which).toLowerCase()}function m(_,g){return _.sort().join(",")===g.sort().join(",")}function E(_){var g=[];return _.shiftKey&&g.push("shift"),_.altKey&&g.push("alt"),_.ctrlKey&&g.push("ctrl"),_.metaKey&&g.push("meta"),g}function A(_){if(_.preventDefault){_.preventDefault();return}_.returnValue=!1}function y(_){if(_.stopPropagation){_.stopPropagation();return}_.cancelBubble=!0}function x(_){return _=="shift"||_=="ctrl"||_=="alt"||_=="meta"}function R(){if(!s){s={};for(var _ in a)_>95&&_<112||a.hasOwnProperty(_)&&(s[a[_]]=_)}return s}function z(_,g,C){return C||(C=R()[_]?"keydown":"keypress"),C=="keypress"&&g.length&&(C="keydown"),C}function B(_){return _==="+"?["+"]:(_=_.replace(/\+{2}/g,"+plus"),_.split("+"))}function K(_,g){var C,D,p,b=[];for(C=B(_),p=0;p<C.length;++p)D=C[p],i[D]&&(D=i[D]),g&&g!="keypress"&&t[D]&&(D=t[D],b.push("shift")),x(D)&&b.push(D);return g=z(D,b,g),{key:D,modifiers:b,action:g}}function W(_,g){return _===null||_===r?!1:_===g?!0:W(_.parentNode,g)}function H(_){var g=this;if(_=_||r,!(g instanceof H))return new H(_);g.target=_,g._callbacks={},g._directMap={};var C={},D,p=!1,b=!1,v=!1;function w(S){S=S||{};var I=!1,k;for(k in C){if(S[k]){I=!0;continue}C[k]=0}I||(v=!1)}function O(S,I,k,M,P,X){var N,G,re=[],Z=k.type;if(!g._callbacks[S])return[];for(Z=="keyup"&&x(S)&&(I=[S]),N=0;N<g._callbacks[S].length;++N)if(G=g._callbacks[S][N],!(!M&&G.seq&&C[G.seq]!=G.level)&&Z==G.action&&(Z=="keypress"&&!k.metaKey&&!k.ctrlKey||m(I,G.modifiers))){var bt=!M&&G.combo==P,vt=M&&G.seq==M&&G.level==X;(bt||vt)&&g._callbacks[S].splice(N,1),re.push(G)}return re}function U(S,I,k,M){g.stopCallback(I,I.target||I.srcElement,k,M)||S(I,k)===!1&&(A(I),y(I))}g._handleKey=function(S,I,k){var M=O(S,I,k),P,X={},N=0,G=!1;for(P=0;P<M.length;++P)M[P].seq&&(N=Math.max(N,M[P].level));for(P=0;P<M.length;++P){if(M[P].seq){if(M[P].level!=N)continue;G=!0,X[M[P].seq]=1,U(M[P].callback,k,M[P].combo,M[P].seq);continue}G||U(M[P].callback,k,M[P].combo)}var re=k.type=="keypress"&&b;k.type==v&&!x(S)&&!re&&w(X),b=G&&k.type=="keydown"};function q(S){typeof S.which!="number"&&(S.which=S.keyCode);var I=c(S);if(!!I){if(S.type=="keyup"&&p===I){p=!1;return}g.handleKey(I,E(S),S)}}function fe(){clearTimeout(D),D=setTimeout(w,1e3)}function Te(S,I,k,M){C[S]=0;function P(Z){return function(){v=Z,++C[S],fe()}}function X(Z){U(k,Z,S),M!=="keyup"&&(p=c(Z)),setTimeout(w,10)}for(var N=0;N<I.length;++N){var G=N+1===I.length,re=G?X:P(M||K(I[N+1]).action);ge(I[N],re,M,S,N)}}function ge(S,I,k,M,P){g._directMap[S+":"+k]=I,S=S.replace(/\s+/g," ");var X=S.split(" "),N;if(X.length>1){Te(S,X,I,k);return}N=K(S,k),g._callbacks[N.key]=g._callbacks[N.key]||[],O(N.key,N.modifiers,{type:N.action},M,S,P),g._callbacks[N.key][M?"unshift":"push"]({callback:I,modifiers:N.modifiers,action:N.action,seq:M,level:P,combo:S})}g._bindMultiple=function(S,I,k){for(var M=0;M<S.length;++M)ge(S[M],I,k)},f(_,"keypress",q),f(_,"keydown",q),f(_,"keyup",q)}H.prototype.bind=function(_,g,C){var D=this;return _=_ instanceof Array?_:[_],D._bindMultiple.call(D,_,g,C),D},H.prototype.unbind=function(_,g){var C=this;return C.bind.call(C,_,function(){},g)},H.prototype.trigger=function(_,g){var C=this;return C._directMap[_+":"+g]&&C._directMap[_+":"+g]({},_),C},H.prototype.reset=function(){var _=this;return _._callbacks={},_._directMap={},_},H.prototype.stopCallback=function(_,g){var C=this;if((" "+g.className+" ").indexOf(" mousetrap ")>-1||W(g,C.target))return!1;if("composedPath"in _&&typeof _.composedPath=="function"){var D=_.composedPath()[0];D!==_.target&&(g=D)}return g.tagName=="INPUT"||g.tagName=="SELECT"||g.tagName=="TEXTAREA"||g.isContentEditable},H.prototype.handleKey=function(){var _=this;return _._handleKey.apply(_,arguments)},H.addKeycodes=function(_){for(var g in _)_.hasOwnProperty(g)&&(a[g]=_[g]);s=null},H.init=function(){var _=H(r);for(var g in _)g.charAt(0)!=="_"&&(H[g]=function(C){return function(){return _[C].apply(_,arguments)}}(g))},H.init(),e.Mousetrap=H,o.exports&&(o.exports=H),typeof n=="function"&&n.amd&&n(function(){return H})})(typeof window!="undefined"?window:null,typeof window!="undefined"?document:null)})(Ie);const ce={};return ce.write=async o=>{await navigator.clipboard.writeText(o)},ce.read=async()=>navigator.clipboard.readText(),ce.readSync=()=>{throw new Error("`.readSync()` is not supported in browsers!")},ce.writeSync=()=>{throw new Error("`.writeSync()` is not supported in browsers!")},function(o){const e=Object.assign({},{enabled:!0,gui:new qe,midiPerColor:4,midi:!0,colors:["#ee907b","#2ed9c3","#4888f5","#aa82ff"],add:function(p,b,v,w,O){const U=a.add(p,b,v,w,O);return D(),e.syncMidi(),U},addColor:function(p,b){return a.addColor(p,b)},setFolder:function(p){const b=e.gui.addFolder(p);return n.push(b),a=b,b},getControllers:function(p=!1){const b=C();return(p?b.filter(w=>!w.closed):b).reduce((w,O)=>w.concat(O.__controllers),[])},removeFolder:function(p){const b=n.findIndex(v=>v.name===p.name);n.splice(b,1),e.gui.removeFolder(p),a=e.gui},connectMidiRange:function(p,b){for(let v=p,w=b+1;v<w;v++)u.push(v)},addControl:function(p,b){t[p]=b},destroy:function(){e.gui.destroy(),l&&(l.inputs.forEach(p=>{p.removeListener("midimessage","all")}),l.disable())},clear:function(){e.gui.destroy(),e.gui=new qe,a=e.gui,t={}},hide:function(){s=!0,e.gui.hide()},show:function(){s=!1,e.gui.show()},toggle:function(){s=!s,s?e.hide():e.show()},update:function(){e.getControllers().forEach(p=>{p.updateDisplay()})},configureDevice:function(p){const b=r[p];if(!b||!b.configure)return console.warn(`No built-in configuration is available for "${p}"`);b.configure()},syncMidi:function(){!l||u.forEach((p,b)=>{const v=e._getNumericControllerAtIndex(b);f.then(()=>{l.outputs.forEach(w=>{const O=r[w.name];if(!!O)if(v){const U=e._controllerValueToMidi(v);O.sync&&O.sync(w,p,U)}else O.clear&&O.clear(w,p)})})})},_mapRange:function(p,b,v,w,O){return(O-p)*(w-v)/(b-p)+v},_snap:function(p,b){return Math.round(b/p)*p},_getNumericControllerAtIndex:function(p,b=!1){const w=e.getControllers(b)[p];return typeof w!="undefined"&&typeof w.min!="undefined"&&typeof w.max!="undefined"?w:null},_getAggregatedSettings:function(){return C().reduce((b,v)=>(b[v.name]=v.__controllers.reduce((w,O)=>(w[O.property]=O.getValue(),w),{}),b),{})},_controllerValueToMidi:function(p){const b=p.getValue(),v=p.__min,w=p.__max,O=e._mapRange(v,w,1,127,b);return Math.round(O)}},o),r={"Midi Fighter Twister":{sync:(p,b,v)=>{p.sendControlChange(b,v,1),p.sendControlChange(b,47,6)},clear:(p,b)=>{p.sendControlChange(b,0,1),p.sendControlChange(b,20,6)},configure:()=>{e.connectMidiRange(0,15)}},"nanoKONTROL2 CTRL":{configure:()=>{e.connectMidiRange(16,23),e.connectMidiRange(0,7)}}},n=[];let a=e.gui;const u=[];let t={},i=!1,s=!1,l=null,f;const c=function(){m(),E(),A(),y(),K()},m=function(){!e.midi||(f=new Promise(p=>{navigator.requestMIDIAccess&&(l=gt,l.enable(v=>{v?console.error("WebMIDI is not supported in this browser."):(console.log("MIDI devices successfully connected."),W(),p(l))},!0))}).catch(p=>{console.error(p)}))},E=function(){document.addEventListener("keydown",({keyCode:p})=>{p===18&&(i=!0)}),document.addEventListener("keyup",({keyCode:p})=>{p===18&&(i=!1)}),document.addEventListener("keyup",({keyCode:p})=>{p===17&&e.toggle()})},A=()=>{const p=`
      <div class="gui-save__inner">
        <span class="gui-save__close">&times;</span>
        <p class="gui-save__clipboard-notification">This code has been saved to your clipboard.</p>
        <textarea
          class="gui-save__textarea"
          name="gui-save-text"
          id="gui-save-text"
          autocomplete="off" autocapitalize="off" spellcheck="false"
        ></textarea>
      </div>
    `,b=document.querySelector("body"),v=document.createElement("div");v.classList.add("gui-save"),v.innerHTML=p,b.appendChild(v),b.insertBefore(v,null),b.insertBefore(v,b.childNodes[0]||null)},y=()=>{Ie.exports.bind("alt+s",x),Ie.exports.bind("esc",B),document.querySelector(".gui-save__close").addEventListener("click",B)},x=()=>{const p=e._getAggregatedSettings();let v=JSON.stringify(p,null,1).replace(/\\"/g,"\uFFFF");v=v.replace(/"([^"]+)":/g,"$1:").replace(/\uFFFF/g,'\\"'),v.replace(/"/g,"'");const w=document.querySelector(".gui-save__textarea");w.value=v,R(),z()},R=()=>{document.querySelector(".gui-save").classList.add("is-visible")},z=()=>{const p=document.querySelector(".gui-save__textarea");ce.write(p.value);const b=document.querySelector(".gui-save__clipboard-notification");b.classList.add("is-visible"),window.setTimeout(()=>{b.classList.remove("is-visible")},2e3)},B=()=>{document.querySelector(".gui-save").classList.remove("is-visible")},K=function(){const p=document.createElement("style");p.type="text/css",p.appendChild(document.createTextNode(`
      .dg.ac {
        z-index: 9999;
      }

      .gui-save {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        background-color: rgba(255, 255, 255, 0.1);
        z-index: 999;
      }

      .gui-save *, .gui-save *:before, .gui-save *:after {
        box-sizing: inherit;
      }

      .gui-save.is-visible {
        display: flex;
      }

      .gui-save__inner {
        position: relative;
        width: 100%;
        max-width: 400px;
        margin: 20px;
      }

      .gui-save__textarea {
        appearance: none;
        border-radius: 5px;
        border: none;
        background-color: #1f1f1f;
        width: 100%;
        height: 300px;
        padding: 25px 23px;
        border-left: 4px solid #5887da;
        font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
        font-size: 14px;
        line-height: 1.5;
        font-weight: normal;
        color: white;
        transition: border-color 0.2s;
      }

      .gui-save__textarea:focus {
        outline: none;
        border-color: #ee907b;
      }

      .gui-save__clipboard-notification {
        font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
        font-size: 13px;
        pointer-events: none;
        position: absolute;
        bottom: -45px;
        left: 0;
        right: 0;
        opacity: 0;
        color: #5887da;
        transition: opacity 0.4s;
      }

      .gui-save__clipboard-notification.is-visible {
        opacity: 1;
      }

      .gui-save__close {
        position: absolute;
        width: 35px;
        height: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 0;
        right: 0;
        z-index: 1;
        font-size: 18px;
        cursor: pointer;
        color: #fff;
      }

      .gui-save__close:active {
        opacity: 0.7;
      }
    `)),document.querySelector("head").appendChild(p)},W=function(){l.inputs.forEach(p=>{p.addListener("midimessage","all",H)})},H=function(p){const[b,v,w]=p.data;i&&console.log(`command: ${b} / note: ${v} / velocity: ${w}`),_(v,w),g(v,w)},_=function(p,b){const v=u.indexOf(p);if(v<0)return;const w=e._getNumericControllerAtIndex(v);if(!w)return;const{__min:O,__max:U,__step:q}=w,fe=q||(U-O)/127,Te=e._mapRange(0,127,O,U,b),ge=e._snap(fe.toFixed(5),Te);w.setValue(ge)},g=function(p,b){t[p]&&t[p].call(e,b)},C=()=>n.length?n:[e.gui],D=function(){e.getControllers(!1).forEach((b,v)=>{const w=Math.floor(v/e.midiPerColor),O=e.colors[w],q=b.domElement.closest(".cr.number.has-slider");if(q){q.style.borderLeftColor=`${O}`;const fe=q.querySelector(".slider-fg");fe.style.backgroundColor=`${O}`}})};return c(),e}});
//# sourceMappingURL=gui.umd.js.map
