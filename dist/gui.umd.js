!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).gui=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e},r=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||Function("return this")(),o=function(e){try{return!!e()}catch(e){return!0}},i=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),a={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,u={f:s&&!a.call({1:2},1)?function(e){var t=s(this,e);return!!t&&t.enumerable}:a},l=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},c={}.toString,d=function(e){return c.call(e).slice(8,-1)},f="".split,h=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==d(e)?f.call(e,""):Object(e)}:Object,p=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},_=function(e){return h(p(e))},m=function(e){return"object"==typeof e?null!==e:"function"==typeof e},g=function(e,t){if(!m(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!m(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},b={}.hasOwnProperty,v=function(e,t){return b.call(e,t)},y=r.document,E=m(y)&&m(y.createElement),S=function(e){return E?y.createElement(e):{}},w=!i&&!o((function(){return 7!=Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a})),A=Object.getOwnPropertyDescriptor,M={f:i?A:function(e,t){if(e=_(e),t=g(t,!0),w)try{return A(e,t)}catch(e){}if(v(e,t))return l(!u.f.call(e,t),e[t])}},x=function(e){if(!m(e))throw TypeError(String(e)+" is not an object");return e},I=Object.defineProperty,C={f:i?I:function(e,t,n){if(x(e),t=g(t,!0),x(n),w)try{return I(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},T=i?function(e,t,n){return C.f(e,t,l(1,n))}:function(e,t,n){return e[t]=n,e},O=function(e,t){try{T(r,e,t)}catch(n){r[e]=t}return t},N=r["__core-js_shared__"]||O("__core-js_shared__",{}),k=Function.toString;"function"!=typeof N.inspectSource&&(N.inspectSource=function(e){return k.call(e)});var R,D,P,L=N.inspectSource,H=r.WeakMap,G="function"==typeof H&&/native code/.test(L(H)),B=t((function(e){(e.exports=function(e,t){return N[e]||(N[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),j=0,F=Math.random(),V=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++j+F).toString(36)},z=B("keys"),U=function(e){return z[e]||(z[e]=V(e))},Y={},W=r.WeakMap;if(G){var X=new W,K=X.get,J=X.has,q=X.set;R=function(e,t){return q.call(X,e,t),t},D=function(e){return K.call(X,e)||{}},P=function(e){return J.call(X,e)}}else{var Q=U("state");Y[Q]=!0,R=function(e,t){return T(e,Q,t),t},D=function(e){return v(e,Q)?e[Q]:{}},P=function(e){return v(e,Q)}}var Z,$,ee={set:R,get:D,has:P,enforce:function(e){return P(e)?D(e):R(e,{})},getterFor:function(e){return function(t){var n;if(!m(t)||(n=D(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},te=t((function(e){var t=ee.get,n=ee.enforce,o=String(String).split("String");(e.exports=function(e,t,i,a){var s=!!a&&!!a.unsafe,u=!!a&&!!a.enumerable,l=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof t||v(i,"name")||T(i,"name",t),n(i).source=o.join("string"==typeof t?t:"")),e!==r?(s?!l&&e[t]&&(u=!0):delete e[t],u?e[t]=i:T(e,t,i)):u?e[t]=i:O(t,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||L(this)}))})),ne=r,re=function(e){return"function"==typeof e?e:void 0},oe=function(e,t){return arguments.length<2?re(ne[e])||re(r[e]):ne[e]&&ne[e][t]||r[e]&&r[e][t]},ie=Math.ceil,ae=Math.floor,se=function(e){return isNaN(e=+e)?0:(e>0?ae:ie)(e)},ue=Math.min,le=function(e){return e>0?ue(se(e),9007199254740991):0},ce=Math.max,de=Math.min,fe=function(e,t){var n=se(e);return n<0?ce(n+t,0):de(n,t)},he=function(e){return function(t,n,r){var o,i=_(t),a=le(i.length),s=fe(r,a);if(e&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},pe={includes:he(!0),indexOf:he(!1)},_e=pe.indexOf,me=function(e,t){var n,r=_(e),o=0,i=[];for(n in r)!v(Y,n)&&v(r,n)&&i.push(n);for(;t.length>o;)v(r,n=t[o++])&&(~_e(i,n)||i.push(n));return i},ge=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],be=ge.concat("length","prototype"),ve={f:Object.getOwnPropertyNames||function(e){return me(e,be)}},ye={f:Object.getOwnPropertySymbols},Ee=oe("Reflect","ownKeys")||function(e){var t=ve.f(x(e)),n=ye.f;return n?t.concat(n(e)):t},Se=function(e,t){for(var n=Ee(t),r=C.f,o=M.f,i=0;i<n.length;i++){var a=n[i];v(e,a)||r(e,a,o(t,a))}},we=/#|\.prototype\./,Ae=function(e,t){var n=xe[Me(e)];return n==Ce||n!=Ie&&("function"==typeof t?o(t):!!t)},Me=Ae.normalize=function(e){return String(e).replace(we,".").toLowerCase()},xe=Ae.data={},Ie=Ae.NATIVE="N",Ce=Ae.POLYFILL="P",Te=Ae,Oe=M.f,Ne=function(e,t){var n,o,i,a,s,u=e.target,l=e.global,c=e.stat;if(n=l?r:c?r[u]||O(u,{}):(r[u]||{}).prototype)for(o in t){if(a=t[o],i=e.noTargetGet?(s=Oe(n,o))&&s.value:n[o],!Te(l?o:u+(c?".":"#")+o,e.forced)&&void 0!==i){if(typeof a==typeof i)continue;Se(a,i)}(e.sham||i&&i.sham)&&T(a,"sham",!0),te(n,o,a,e)}},ke=Array.isArray||function(e){return"Array"==d(e)},Re=function(e){return Object(p(e))},De=function(e,t,n){var r=g(t);r in e?C.f(e,r,l(0,n)):e[r]=n},Pe=!!Object.getOwnPropertySymbols&&!o((function(){return!String(Symbol())})),Le=Pe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,He=B("wks"),Ge=r.Symbol,Be=Le?Ge:Ge&&Ge.withoutSetter||V,je=function(e){return v(He,e)||(Pe&&v(Ge,e)?He[e]=Ge[e]:He[e]=Be("Symbol."+e)),He[e]},Fe=je("species"),Ve=function(e,t){var n;return ke(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!ke(n.prototype)?m(n)&&null===(n=n[Fe])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},ze=oe("navigator","userAgent")||"",Ue=r.process,Ye=Ue&&Ue.versions,We=Ye&&Ye.v8;We?$=(Z=We.split("."))[0]+Z[1]:ze&&(!(Z=ze.match(/Edge\/(\d+)/))||Z[1]>=74)&&(Z=ze.match(/Chrome\/(\d+)/))&&($=Z[1]);var Xe=$&&+$,Ke=je("species"),Je=function(e){return Xe>=51||!o((function(){var t=[];return(t.constructor={})[Ke]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},qe=je("isConcatSpreadable"),Qe=Xe>=51||!o((function(){var e=[];return e[qe]=!1,e.concat()[0]!==e})),Ze=Je("concat"),$e=function(e){if(!m(e))return!1;var t=e[qe];return void 0!==t?!!t:ke(e)};Ne({target:"Array",proto:!0,forced:!Qe||!Ze},{concat:function(e){var t,n,r,o,i,a=Re(this),s=Ve(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(i=-1===t?a:arguments[t],$e(i)){if(u+(o=le(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,u++)n in i&&De(s,u,i[n])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");De(s,u++,i)}return s.length=u,s}});var et=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},tt=[].push,nt=function(e){var t=1==e,n=2==e,r=3==e,o=4==e,i=6==e,a=5==e||i;return function(s,u,l,c){for(var d,f,p=Re(s),_=h(p),m=function(e,t,n){if(et(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}(u,l,3),g=le(_.length),b=0,v=c||Ve,y=t?v(s,g):n?v(s,0):void 0;g>b;b++)if((a||b in _)&&(f=m(d=_[b],b,p),e))if(t)y[b]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return b;case 2:tt.call(y,d)}else if(o)return!1;return i?-1:r||o?o:y}},rt={forEach:nt(0),map:nt(1),filter:nt(2),some:nt(3),every:nt(4),find:nt(5),findIndex:nt(6)},ot=Object.defineProperty,it={},at=function(e){throw e},st=function(e,t){if(v(it,e))return it[e];t||(t={});var n=[][e],r=!!v(t,"ACCESSORS")&&t.ACCESSORS,a=v(t,0)?t[0]:at,s=v(t,1)?t[1]:void 0;return it[e]=!!n&&!o((function(){if(r&&!i)return!0;var e={length:-1};r?ot(e,1,{enumerable:!0,get:at}):e[1]=1,n.call(e,a,s)}))},ut=rt.filter,lt=Je("filter"),ct=st("filter");Ne({target:"Array",proto:!0,forced:!lt||!ct},{filter:function(e){return ut(this,e,arguments.length>1?arguments[1]:void 0)}});var dt,ft=Object.keys||function(e){return me(e,ge)},ht=i?Object.defineProperties:function(e,t){x(e);for(var n,r=ft(t),o=r.length,i=0;o>i;)C.f(e,n=r[i++],t[n]);return e},pt=oe("document","documentElement"),_t=U("IE_PROTO"),mt=function(){},gt=function(e){return"<script>"+e+"<\/script>"},bt=function(){try{dt=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;bt=dt?function(e){e.write(gt("")),e.close();var t=e.parentWindow.Object;return e=null,t}(dt):((t=S("iframe")).style.display="none",pt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(gt("document.F=Object")),e.close(),e.F);for(var n=ge.length;n--;)delete bt.prototype[ge[n]];return bt()};Y[_t]=!0;var vt=Object.create||function(e,t){var n;return null!==e?(mt.prototype=x(e),n=new mt,mt.prototype=null,n[_t]=e):n=bt(),void 0===t?n:ht(n,t)},yt=je("unscopables"),Et=Array.prototype;null==Et[yt]&&C.f(Et,yt,{configurable:!0,value:vt(null)});var St,wt=rt.findIndex,At=!0,Mt=st("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){At=!1})),Ne({target:"Array",proto:!0,forced:At||!Mt},{findIndex:function(e){return wt(this,e,arguments.length>1?arguments[1]:void 0)}}),St="findIndex",Et[yt][St]=!0;var xt=function(e,t){var n=[][e];return!!n&&o((function(){n.call(null,t||function(){throw 1},1)}))},It=rt.forEach,Ct=xt("forEach"),Tt=st("forEach"),Ot=Ct&&Tt?[].forEach:function(e){return It(this,e,arguments.length>1?arguments[1]:void 0)};Ne({target:"Array",proto:!0,forced:[].forEach!=Ot},{forEach:Ot});var Nt=pe.indexOf,kt=[].indexOf,Rt=!!kt&&1/[1].indexOf(1,-0)<0,Dt=xt("indexOf"),Pt=st("indexOf",{ACCESSORS:!0,1:0});Ne({target:"Array",proto:!0,forced:Rt||!Dt||!Pt},{indexOf:function(e){return Rt?kt.apply(this,arguments)||0:Nt(this,e,arguments.length>1?arguments[1]:void 0)}});var Lt=function(e){return function(t,n,r,o){et(n);var i=Re(t),a=h(i),s=le(i.length),u=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(u in a){o=a[u],u+=l;break}if(u+=l,e?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=l)u in a&&(o=n(o,a[u],u,i));return o}},Ht={left:Lt(!1),right:Lt(!0)}.left,Gt=xt("reduce"),Bt=st("reduce",{1:0});Ne({target:"Array",proto:!0,forced:!Gt||!Bt},{reduce:function(e){return Ht(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var jt=Je("splice"),Ft=st("splice",{ACCESSORS:!0,0:0,1:2}),Vt=Math.max,zt=Math.min;Ne({target:"Array",proto:!0,forced:!jt||!Ft},{splice:function(e,t){var n,r,o,i,a,s,u=Re(this),l=le(u.length),c=fe(e,l),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=l-c):(n=d-2,r=zt(Vt(se(t),0),l-c)),l+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(o=Ve(u,r),i=0;i<r;i++)(a=c+i)in u&&De(o,i,u[a]);if(o.length=r,n<r){for(i=c;i<l-r;i++)s=i+n,(a=i+r)in u?u[s]=u[a]:delete u[s];for(i=l;i>l-r+n;i--)delete u[i-1]}else if(n>r)for(i=l-r;i>c;i--)s=i+n-1,(a=i+r-1)in u?u[s]=u[a]:delete u[s];for(i=0;i<n;i++)u[i+c]=arguments[i+2];return u.length=l-r+n,o}});var Ut=C.f,Yt=Function.prototype,Wt=Yt.toString,Xt=/^\s*function ([^ (]*)/;i&&!("name"in Yt)&&Ut(Yt,"name",{configurable:!0,get:function(){try{return Wt.call(this).match(Xt)[1]}catch(e){return""}}});var Kt="".repeat||function(e){var t=String(p(this)),n="",r=se(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},Jt=1..toFixed,qt=Math.floor,Qt=function(e,t,n){return 0===t?n:t%2==1?Qt(e,t-1,n*e):Qt(e*e,t/2,n)};Ne({target:"Number",proto:!0,forced:Jt&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o((function(){Jt.call({})}))},{toFixed:function(e){var t,n,r,o,i=function(e){if("number"!=typeof e&&"Number"!=d(e))throw TypeError("Incorrect invocation");return+e}(this),a=se(e),s=[0,0,0,0,0,0],u="",l="0",c=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*s[n],s[n]=r%1e7,r=qt(r/1e7)},f=function(e){for(var t=6,n=0;--t>=0;)n+=s[t],s[t]=qt(n/e),n=n%e*1e7},h=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var n=String(s[e]);t=""===t?n:t+Kt.call("0",7-n.length)+n}return t};if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return String(i);if(i<0&&(u="-",i=-i),i>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(i*Qt(2,69,1))-69)<0?i*Qt(2,-t,1):i/Qt(2,t,1),n*=4503599627370496,(t=52-t)>0){for(c(0,n),r=a;r>=7;)c(1e7,0),r-=7;for(c(Qt(10,r,1),0),r=t-1;r>=23;)f(1<<23),r-=23;f(1<<r),c(1,1),f(2),l=h()}else c(0,n),c(1<<-t,0),l=h()+Kt.call("0",a);return l=a>0?u+((o=l.length)<=a?"0."+Kt.call("0",a-o)+l:l.slice(0,o-a)+"."+l.slice(o-a)):u+l}});var Zt=Object.assign,$t=Object.defineProperty,en=!Zt||o((function(){if(i&&1!==Zt({b:1},Zt($t({},"a",{enumerable:!0,get:function(){$t(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Zt({},e)[n]||"abcdefghijklmnopqrst"!=ft(Zt({},t)).join("")}))?function(e,t){for(var n=Re(e),r=arguments.length,o=1,a=ye.f,s=u.f;r>o;)for(var l,c=h(arguments[o++]),d=a?ft(c).concat(a(c)):ft(c),f=d.length,p=0;f>p;)l=d[p++],i&&!s.call(c,l)||(n[l]=c[l]);return n}:Zt;Ne({target:"Object",stat:!0,forced:Object.assign!==en},{assign:en});for(var tn in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var nn=r[tn],rn=nn&&nn.prototype;if(rn&&rn.forEach!==Ot)try{T(rn,"forEach",Ot)}catch(e){rn.forEach=Ot}}function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function un(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),o=Math.round(e.g),i=Math.round(e.b),a=e.a,s=Math.round(e.h),u=e.s.toFixed(1),l=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+r+","+o+","+i+")":"CSS_RGBA"===n?"rgba("+r+","+o+","+i+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+o+","+i+"]":"RGBA_ARRAY"===n?"["+r+","+o+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+",a:"+a+"}":"unknown format"}var ln=Array.prototype.forEach,cn=Array.prototype.slice,dn={BREAK:{},extend:function(e){return this.each(cn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(cn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=cn.call(arguments);return function(){for(var t=cn.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(ln&&e.forEach&&e.forEach===ln)e.forEach(t,n);else if(e.length===e.length+0){var r,o=void 0;for(o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var i in e)if(t.call(n,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var o=this,i=arguments;function a(){r=null,n||e.apply(o,i)}var s=n||!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(o,i)}},toArray:function(e){return e.toArray?e.toArray():cn.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},fn=[{litmus:dn.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:un},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:un},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:un},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:un}}},{litmus:dn.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:dn.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:dn.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(dn.isNumber(e.r)&&dn.isNumber(e.g)&&dn.isNumber(e.b)&&dn.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(dn.isNumber(e.r)&&dn.isNumber(e.g)&&dn.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(dn.isNumber(e.h)&&dn.isNumber(e.s)&&dn.isNumber(e.v)&&dn.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(dn.isNumber(e.h)&&dn.isNumber(e.s)&&dn.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],hn=void 0,pn=void 0,_n=function(){pn=!1;var e=arguments.length>1?dn.toArray(arguments):arguments[0];return dn.each(fn,(function(t){if(t.litmus(e))return dn.each(t.conversions,(function(t,n){if(hn=t.read(e),!1===pn&&!1!==hn)return pn=hn,hn.conversionName=n,hn.conversion=t,dn.BREAK})),dn.BREAK})),pn},mn=void 0,gn={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),i=n*(1-t),a=n*(1-o*t),s=n*(1-(1-o)*t),u=[[n,s,i],[a,n,i],[i,n,s],[i,a,n],[s,i,n],[n,i,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),o=Math.max(e,t,n),i=o-r,a=void 0;return 0===o?{h:NaN,s:0,v:0}:(a=e===o?(t-n)/i:t===o?2+(n-e)/i:4+(e-t)/i,(a/=6)<0&&(a+=1),{h:360*a,s:i/o,v:o/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(mn=8*t)|e&~(255<<mn)}},bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},yn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),En=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},Sn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},wn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},An=function(){function e(){if(vn(this,e),this.__state=_n.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return yn(e,[{key:"toString",value:function(){return un(this)}},{key:"toHexString",value:function(){return un(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Mn(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||An.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(An.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function xn(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||An.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(An.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}An.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=gn.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");dn.extend(e.__state,gn.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},An.recalculateHSV=function(e){var t=gn.rgb_to_hsv(e.r,e.g,e.b);dn.extend(e.__state,{s:t.s,v:t.v}),dn.isNaN(t.h)?dn.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},An.COMPONENTS=["r","g","b","h","s","v","hex","a"],Mn(An.prototype,"r",2),Mn(An.prototype,"g",1),Mn(An.prototype,"b",0),xn(An.prototype,"h"),xn(An.prototype,"s"),xn(An.prototype,"v"),Object.defineProperty(An.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(An.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=gn.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var In=function(){function e(t,n){vn(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return yn(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),Cn={};dn.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){dn.each(e,(function(e){Cn[e]=t}))}));var Tn=/(\d+(\.\d+)?)px/;function On(e){if("0"===e||dn.isUndefined(e))return 0;var t=e.match(Tn);return dn.isNull(t)?0:parseFloat(t[1])}var Nn={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,o=t;dn.isUndefined(o)&&(o=!0),dn.isUndefined(r)&&(r=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var o=n||{},i=Cn[t];if(!i)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(i);switch(i){case"MouseEvents":var s=o.x||o.clientX||0,u=o.y||o.clientY||0;a.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=a.initKeyboardEvent||a.initKeyEvent;dn.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(t,o.bubbles||!1,o.cancelable||!0)}dn.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,n,r){var o=r||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),Nn},unbind:function(e,t,n,r){var o=r||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),Nn},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Nn},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return Nn},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return On(t["border-left-width"])+On(t["border-right-width"])+On(t["padding-left"])+On(t["padding-right"])+On(t.width)},getHeight:function(e){var t=getComputedStyle(e);return On(t["border-top-width"])+On(t["border-bottom-width"])+On(t["padding-top"])+On(t["padding-bottom"])+On(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},kn=function(e){function t(e,n){vn(this,t);var r=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),Nn.bind(r.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return Sn(t,e),yn(t,[{key:"setValue",value:function(e){var n=En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(In),Rn=function(e){function t(e,n,r){vn(this,t);var o=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r,a=o;if(o.__select=document.createElement("select"),dn.isArray(i)){var s={};dn.each(i,(function(e){s[e]=e})),i=s}return dn.each(i,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)})),o.updateDisplay(),Nn.bind(o.__select,"change",(function(){var e=this.options[this.selectedIndex].value;a.setValue(e)})),o.domElement.appendChild(o.__select),o}return Sn(t,e),yn(t,[{key:"setValue",value:function(e){var n=En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Nn.isActive(this.__select)?this:(this.__select.value=this.getValue(),En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(In),Dn=function(e){function t(e,n){vn(this,t);var r=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;function i(){o.setValue(o.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),Nn.bind(r.__input,"keyup",i),Nn.bind(r.__input,"change",i),Nn.bind(r.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),Nn.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Sn(t,e),yn(t,[{key:"updateDisplay",value:function(){return Nn.isActive(this.__input)||(this.__input.value=this.getValue()),En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(In);function Pn(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var Ln=function(e){function t(e,n,r){vn(this,t);var o=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r||{};return o.__min=i.min,o.__max=i.max,o.__step=i.step,dn.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=Pn(o.__impliedStep),o}return Sn(t,e),yn(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=Pn(e),this}}]),t}(In);var Hn=function(e){function t(e,n,r){vn(this,t);var o=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));o.__truncationSuspended=!1;var i=o,a=void 0;function s(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function u(e){var t=a-e.clientY;i.setValue(i.getValue()+t*i.__impliedStep),a=e.clientY}function l(){Nn.unbind(window,"mousemove",u),Nn.unbind(window,"mouseup",l),s()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Nn.bind(o.__input,"change",(function(){var e=parseFloat(i.__input.value);dn.isNaN(e)||i.setValue(e)})),Nn.bind(o.__input,"blur",(function(){s()})),Nn.bind(o.__input,"mousedown",(function(e){Nn.bind(window,"mousemove",u),Nn.bind(window,"mouseup",l),a=e.clientY})),Nn.bind(o.__input,"keydown",(function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,s())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return Sn(t,e),yn(t,[{key:"updateDisplay",value:function(){var e,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(e*r)/r),En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Ln);function Gn(e,t,n,r,o){return r+(e-t)/(n-t)*(o-r)}var Bn=function(e){function t(e,n,r,o,i){vn(this,t);var a=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:o,step:i})),s=a;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(Gn(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function l(){Nn.unbind(window,"mousemove",u),Nn.unbind(window,"mouseup",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(Gn(t,n.left,n.right,s.__min,s.__max))}function d(){Nn.unbind(window,"touchmove",c),Nn.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),Nn.bind(a.__background,"mousedown",(function(e){document.activeElement.blur(),Nn.bind(window,"mousemove",u),Nn.bind(window,"mouseup",l),u(e)})),Nn.bind(a.__background,"touchstart",(function(e){if(1!==e.touches.length)return;Nn.bind(window,"touchmove",c),Nn.bind(window,"touchend",d),c(e)})),Nn.addClass(a.__background,"slider"),Nn.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Sn(t,e),yn(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",En(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Ln),jn=function(e){function t(e,n,r){vn(this,t);var o=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===r?"Fire":r,Nn.bind(o.__button,"click",(function(e){return e.preventDefault(),i.fire(),!1})),Nn.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return Sn(t,e),yn(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(In),Fn=function(e){function t(e,n){vn(this,t);var r=wn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new An(r.getValue()),r.__temp=new An(0);var o=r;r.domElement=document.createElement("div"),Nn.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",Nn.bind(r.__input,"keydown",(function(e){13===e.keyCode&&d.call(this)})),Nn.bind(r.__input,"blur",d),Nn.bind(r.__selector,"mousedown",(function(){Nn.addClass(this,"drag").bind(window,"mouseup",(function(){Nn.removeClass(o.__selector,"drag")}))})),Nn.bind(r.__selector,"touchstart",(function(){Nn.addClass(this,"drag").bind(window,"touchend",(function(){Nn.removeClass(o.__selector,"drag")}))}));var i,a=document.createElement("div");function s(e){h(e),Nn.bind(window,"mousemove",h),Nn.bind(window,"touchmove",h),Nn.bind(window,"mouseup",l),Nn.bind(window,"touchend",l)}function u(e){p(e),Nn.bind(window,"mousemove",p),Nn.bind(window,"touchmove",p),Nn.bind(window,"mouseup",c),Nn.bind(window,"touchend",c)}function l(){Nn.unbind(window,"mousemove",h),Nn.unbind(window,"touchmove",h),Nn.unbind(window,"mouseup",l),Nn.unbind(window,"touchend",l),f()}function c(){Nn.unbind(window,"mousemove",p),Nn.unbind(window,"touchmove",p),Nn.unbind(window,"mouseup",c),Nn.unbind(window,"touchend",c),f()}function d(){var e=_n(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function f(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,i=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(i-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),o.__color.v=s,o.__color.s=a,o.setValue(o.__color.toOriginal()),!1}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return dn.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),dn.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),dn.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),dn.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),dn.extend(a.style,{width:"100%",height:"100%",background:"none"}),zn(a,"top","rgba(0,0,0,0)","#000"),dn.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(i=r.__hue_field).style.background="",i.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",i.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",dn.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),Nn.bind(r.__saturation_field,"mousedown",s),Nn.bind(r.__saturation_field,"touchstart",s),Nn.bind(r.__field_knob,"mousedown",s),Nn.bind(r.__field_knob,"touchstart",s),Nn.bind(r.__hue_field,"mousedown",u),Nn.bind(r.__hue_field,"touchstart",u),r.__saturation_field.appendChild(a),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return Sn(t,e),yn(t,[{key:"updateDisplay",value:function(){var e=_n(this.getValue());if(!1!==e){var t=!1;dn.each(An.COMPONENTS,(function(n){if(!dn.isUndefined(e[n])&&!dn.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&dn.extend(this.__color.__state,e)}dn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;dn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,zn(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),dn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(In),Vn=["-moz-","-o-","-webkit-","-ms-",""];function zn(e,t,n,r){e.style.background="",dn.each(Vn,(function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}var Un=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(r)}catch(e){}},Yn='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',Wn=function(e,t){var n=e[t];return dn.isArray(arguments[2])||dn.isObject(arguments[2])?new Rn(e,t,arguments[2]):dn.isNumber(n)?dn.isNumber(arguments[2])&&dn.isNumber(arguments[3])?dn.isNumber(arguments[4])?new Bn(e,t,arguments[2],arguments[3],arguments[4]):new Bn(e,t,arguments[2],arguments[3]):dn.isNumber(arguments[4])?new Hn(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Hn(e,t,{min:arguments[2],max:arguments[3]}):dn.isString(n)?new Dn(e,t):dn.isFunction(n)?new jn(e,t,""):dn.isBoolean(n)?new kn(e,t):null};var Xn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Kn=function(){function e(){vn(this,e),this.backgroundElement=document.createElement("div"),dn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Nn.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),dn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Nn.bind(this.backgroundElement,"click",(function(){t.hide()}))}return yn(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),dn.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Nn.unbind(e.domElement,"webkitTransitionEnd",t),Nn.unbind(e.domElement,"transitionend",t),Nn.unbind(e.domElement,"oTransitionEnd",t)};Nn.bind(this.domElement,"webkitTransitionEnd",t),Nn.bind(this.domElement,"transitionend",t),Nn.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Nn.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Nn.getHeight(this.domElement)/2+"px"}}]),e}();Un(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Jn=function(){try{return!!window.localStorage}catch(e){return!1}}(),qn=void 0,Qn=!0,Zn=void 0,$n=!1,er=[],tr=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Nn.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=dn.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=dn.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),dn.isUndefined(r.load)?r.load={preset:"Default"}:r.preset&&(r.load.preset=r.preset),dn.isUndefined(r.parent)&&r.hideable&&er.push(this),r.resizable=dn.isUndefined(r.parent)&&r.resizable,r.autoPlace&&dn.isUndefined(r.scrollable)&&(r.scrollable=!0);var o,i=Jn&&"true"===localStorage.getItem(sr(this,"isLocal")),a=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,fr(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?Nn.addClass(n.__ul,e.CLASS_CLOSED):Nn.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(e){Jn&&(i=e,e?Nn.bind(window,"unload",a):Nn.unbind(window,"unload",a),localStorage.setItem(sr(n,"isLocal"),e))}}}),dn.isUndefined(r.parent)){if(this.closed=r.closed||!1,Nn.addClass(this.domElement,e.CLASS_MAIN),Nn.makeSelectable(this.domElement,!1),Jn&&i){n.useLocalStorage=!0;var u=localStorage.getItem(sr(this,"gui"));u&&(r.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Nn.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(Nn.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Nn.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Nn.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var l=document.createTextNode(r.name);Nn.addClass(l,"controller-name"),s=nr(n,l);Nn.addClass(this.__ul,e.CLASS_CLOSED),Nn.addClass(s,"title"),Nn.bind(s,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(dn.isUndefined(r.parent)&&(Qn&&(Zn=document.createElement("div"),Nn.addClass(Zn,"dg"),Nn.addClass(Zn,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Zn),Qn=!1),Zn.appendChild(this.domElement),Nn.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||fr(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Nn.bind(window,"resize",this.__resizeHandler),Nn.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Nn.bind(this.__ul,"transitionend",this.__resizeHandler),Nn.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&dr(this),a=function(){Jn&&"true"===localStorage.getItem(sr(n,"isLocal"))&&localStorage.setItem(sr(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,r.parent||((o=n.getRoot()).width+=1,dn.defer((function(){o.width-=1})))};function nr(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function rr(e){Nn.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Nn.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function or(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function ir(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var o=n.__rememberedObjectIndecesToControllers[r];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[r]=o),o[t.property]=t,n.load&&n.load.remembered){var i=n.load.remembered,a=void 0;if(i[e.preset])a=i[e.preset];else{if(!i.Default)return;a=i.Default}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function ar(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(r.color)o=new Fn(t,n);else{var i=[t,n].concat(r.factoryArgs);o=Wn.apply(e,i)}r.before instanceof In&&(r.before=r.before.__li),ir(e,o),Nn.addClass(o.domElement,"c");var a=document.createElement("span");Nn.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var u=nr(e,s,r.before);return Nn.addClass(u,tr.CLASS_CONTROLLER_ROW),o instanceof Fn?Nn.addClass(u,"color"):Nn.addClass(u,bn(o.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,dn.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),ar(e,n.object,n.property,{before:r,factoryArgs:[dn.toArray(arguments)]})}if(dn.isArray(t)||dn.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),ar(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Bn){var r=new Hn(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});dn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],o=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(r,e),t.apply(n,e)}})),Nn.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof Hn){var o=function(t){if(dn.isNumber(n.__min)&&dn.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var i=ar(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return i.name(r),o&&i.listen(),i}return t};n.min=dn.compose(o,n.min),n.max=dn.compose(o,n.max)}else n instanceof kn?(Nn.bind(t,"click",(function(){Nn.fakeEvent(n.__checkbox,"click")})),Nn.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof jn?(Nn.bind(t,"click",(function(){Nn.fakeEvent(n.__button,"click")})),Nn.bind(t,"mouseover",(function(){Nn.addClass(n.__button,"hover")})),Nn.bind(t,"mouseout",(function(){Nn.removeClass(n.__button,"hover")}))):n instanceof Fn&&(Nn.addClass(t,"color"),n.updateDisplay=dn.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=dn.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&or(e.getRoot(),!0),t}),n.setValue)}(e,u,o),e.__controllers.push(o),o}function sr(e,t){return document.location.href+"."+t}function ur(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function lr(e,t){t.style.display=e.useLocalStorage?"block":"none"}function cr(e){var t=e.__save_row=document.createElement("li");Nn.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Nn.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Nn.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",Nn.addClass(r,"button"),Nn.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",Nn.addClass(o,"button"),Nn.addClass(o,"save-as");var i=document.createElement("span");i.innerHTML="Revert",Nn.addClass(i,"button"),Nn.addClass(i,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?dn.each(e.load.remembered,(function(t,n){ur(e,n,n===e.preset)})):ur(e,"Default",!1),Nn.bind(a,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(i),Jn){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(sr(0,"isLocal"))&&u.setAttribute("checked","checked"),lr(e,s),Nn.bind(u,"change",(function(){e.useLocalStorage=!e.useLocalStorage,lr(e,s)}))}var l=document.getElementById("dg-new-constructor");Nn.bind(l,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||qn.hide()})),Nn.bind(n,"click",(function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),qn.show(),l.focus(),l.select()})),Nn.bind(r,"click",(function(){e.save()})),Nn.bind(o,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),Nn.bind(i,"click",(function(){e.revert()}))}function dr(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){Nn.removeClass(e.__closeButton,tr.CLASS_DRAG),Nn.unbind(window,"mousemove",n),Nn.unbind(window,"mouseup",r)}function o(o){return o.preventDefault(),t=o.clientX,Nn.addClass(e.__closeButton,tr.CLASS_DRAG),Nn.bind(window,"mousemove",n),Nn.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),dn.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Nn.bind(e.__resize_handle,"mousedown",o),Nn.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function fr(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function hr(e,t){var n={};return dn.each(e.__rememberedObjects,(function(r,o){var i={},a=e.__rememberedObjectIndecesToControllers[o];dn.each(a,(function(e,n){i[n]=t?e.initialValue:e.getValue()})),n[o]=i})),n}tr.toggleHide=function(){$n=!$n,dn.each(er,(function(e){e.domElement.style.display=$n?"none":""}))},tr.CLASS_AUTO_PLACE="a",tr.CLASS_AUTO_PLACE_CONTAINER="ac",tr.CLASS_MAIN="main",tr.CLASS_CONTROLLER_ROW="cr",tr.CLASS_TOO_TALL="taller-than-window",tr.CLASS_CLOSED="closed",tr.CLASS_CLOSE_BUTTON="close-button",tr.CLASS_CLOSE_TOP="close-top",tr.CLASS_CLOSE_BOTTOM="close-bottom",tr.CLASS_DRAG="drag",tr.DEFAULT_WIDTH=245,tr.TEXT_CLOSED="Close Controls",tr.TEXT_OPEN="Open Controls",tr._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||tr.toggleHide()},Nn.bind(window,"keydown",tr._keydownHandler,!1),dn.extend(tr.prototype,{add:function(e,t){return ar(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return ar(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;dn.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Zn.removeChild(this.domElement);var e=this;dn.each(this.__folders,(function(t){e.removeFolder(t)})),Nn.unbind(window,"keydown",tr._keydownHandler,!1),rr(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new tr(t);this.__folders[e]=n;var r=nr(this,n.domElement);return Nn.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],rr(e);var t=this;dn.each(e.__folders,(function(t){e.removeFolder(t)})),dn.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Nn.getOffset(e.__ul).top,n=0;dn.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=Nn.getHeight(t))})),window.innerHeight-t-20<n?(Nn.addClass(e.domElement,tr.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(Nn.removeClass(e.domElement,tr.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&dn.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:dn.debounce((function(){this.onResize()}),50),remember:function(){if(dn.isUndefined(qn)&&((qn=new Kn).domElement.innerHTML=Yn),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;dn.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&cr(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&fr(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=hr(this)),e.folders={},dn.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=hr(this),or(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=hr(this,!0)),this.load.remembered[e]=hr(this),this.preset=e,ur(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){dn.each(this.__controllers,(function(t){this.getRoot().load.remembered?ir(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),dn.each(this.__folders,(function(e){e.revert(e)})),e||or(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&Xn.call(window,(function(){e(t)}));dn.each(t,(function(e){e.updateDisplay()}))}(this.__listening)},updateDisplay:function(){dn.each(this.__controllers,(function(e){e.updateDisplay()})),dn.each(this.__folders,(function(e){e.updateDisplay()}))}});var pr={color:{Color:An,math:gn,interpret:_n},controllers:{Controller:In,BooleanController:kn,OptionController:Rn,StringController:Dn,NumberController:Ln,NumberControllerBox:Hn,NumberControllerSlider:Bn,FunctionController:jn,ColorController:Fn},dom:{dom:Nn},gui:{GUI:tr},GUI:tr},_r=t((function(t){!function(e){function n(){if(n.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(n.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(e){return this._nrpnEventsEnabled=e,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var r=new n;function o(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function i(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}n.prototype.enable=function(e,t){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:t}).then(function(t){var n,r=[],o=[];this.interface=t,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){r.push(e)};for(var i=t.inputs.values(),a=i.next();a&&!a.done;a=i.next())o.push(a.value.open());for(var s=t.outputs.values(),u=s.next();u&&!u.done;u=s.next())o.push(u.value.open());function l(){clearTimeout(n),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),r.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}n=setTimeout(l.bind(this),200),Promise&&Promise.all(o).catch((function(e){})).then(l.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):"function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},n.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},n.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},n.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},n.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(e))if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},n.prototype.toMIDIChannels=function(e){var t;if("all"===e||void 0===e)t=["all"];else{if("none"===e)return[];t=Array.isArray(e)?e:[e]}return-1<t.indexOf("all")&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map((function(e){return parseInt(e)})).filter((function(e){return 1<=e&&e<=16}))},n.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},n.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},n.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},n.prototype.getOctave=function(e){if(null!=e&&0<=e&&e<=127)return Math.floor(Math.floor(e)/12-1)+Math.floor(r.octaveOffset)},n.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},n.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&0<=e&&e<=127?t=Math.round(e):0<=parseInt(e)&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},n.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var n=r._semitones[t[1].toUpperCase()],o=12*(parseInt(t[3])+1-Math.floor(r.octaveOffset))+n;if(-1<t[2].toLowerCase().indexOf("b")?o-=t[2].length:-1<t[2].toLowerCase().indexOf("#")&&(o+=t[2].length),o<0||127<o)throw new RangeError("Invalid note name or note outside valid range.");return o},n.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},n.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._inputs[e]._midiInput===r.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new o(e))}.bind(this))},n.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new i(e))}.bind(this))},n.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach((function(e){e(t)}))},n.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},o.prototype.on=o.prototype.addListener=function(e,t,n){var o=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach((function(e){if("all"!==e&&!(1<=e&&e<=16))throw new RangeError("The 'channel' parameter is invalid.")})),"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==r.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(n);else{if(void 0===r.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(-1<t.indexOf("all")){t=[];for(var i=1;i<=16;i++)t.push(i)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach((function(t){o._userHandlers.channel[e][t]||(o._userHandlers.channel[e][t]=[]),o._userHandlers.channel[e][t].push(n)}))}return this},o.prototype.hasListener=function(e,t,n){var o=this;if("function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==r.MIDI_SYSTEM_MESSAGES[e]){for(var i=0;i<this._userHandlers.system[e].length;i++)if(this._userHandlers.system[e][i]===n)return!0}else if(void 0!==r.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}return!!this._userHandlers.channel[e]&&t.every((function(t){var r=o._userHandlers.channel[e][t];return r&&-1<r.indexOf(n)}))}return!1},o.prototype.removeListener=function(e,t,n){var o=this;if(void 0!==n&&"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==r.MIDI_SYSTEM_MESSAGES[e])if(void 0===n)this._userHandlers.system[e]=[];else for(var i=0;i<this._userHandlers.system[e].length;i++)this._userHandlers.system[e][i]===n&&this._userHandlers.system[e].splice(i,1);else if(void 0!==r.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}if(!this._userHandlers.channel[e])return this;t.forEach((function(t){var r=o._userHandlers.channel[e][t];if(r)if(void 0===n)o._userHandlers.channel[e][t]=[];else for(var i=0;i<r.length;i++)r[i]===n&&r.splice(i,1)}))}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},o.prototype._initializeUserHandlers=function(){for(var e in r.MIDI_CHANNEL_MESSAGES)r.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in r.MIDI_SYSTEM_MESSAGES)r.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},o.prototype._onMidiMessage=function(e){if(0<this._userHandlers.system.midimessage.length){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach((function(e){e(t)}))}e.data[0]<240?(this._parseChannelEvent(e),this._parseNrpnEvent(e)):e.data[0]<=255&&this._parseSystemEvent(e)},o.prototype._parseNrpnEvent=function(e){var t,n,o=e.data[0]>>4,i=15&e.data[0],a=1+i;if(1<e.data.length&&(t=e.data[1],n=2<e.data.length?e.data[2]:void 0),r.nrpnEventsEnabled&&o===r.MIDI_CHANNEL_MESSAGES.controlchange&&(t>=r.MIDI_NRPN_MESSAGES.increment&&t<=r.MIDI_NRPN_MESSAGES.parammsb||t===r.MIDI_NRPN_MESSAGES.entrymsb||t===r.MIDI_NRPN_MESSAGES.entrylsb)){var s={target:this,type:"controlchange",data:e.data,timestamp:e.timeStamp,channel:a,controller:{number:t,name:this.getCcNameByNumber(t)},value:n};if(s.controller.number===r.MIDI_NRPN_MESSAGES.parammsb&&s.value!=r.MIDI_NRPN_MESSAGES.nullactiveparameter)r._nrpnBuffer[i]=[],r._nrpnBuffer[i][0]=s;else if(1===r._nrpnBuffer[i].length&&s.controller.number===r.MIDI_NRPN_MESSAGES.paramlsb)r._nrpnBuffer[i].push(s);else if(2!==r._nrpnBuffer[i].length||s.controller.number!==r.MIDI_NRPN_MESSAGES.increment&&s.controller.number!==r.MIDI_NRPN_MESSAGES.decrement&&s.controller.number!==r.MIDI_NRPN_MESSAGES.entrymsb)if(3===r._nrpnBuffer[i].length&&r._nrpnBuffer[i][2].number===r.MIDI_NRPN_MESSAGES.entrymsb&&s.controller.number===r.MIDI_NRPN_MESSAGES.entrylsb)r._nrpnBuffer[i].push(s);else if(3<=r._nrpnBuffer[i].length&&r._nrpnBuffer[i].length<=4&&s.controller.number===r.MIDI_NRPN_MESSAGES.parammsb&&s.value===r.MIDI_NRPN_MESSAGES.nullactiveparameter)r._nrpnBuffer[i].push(s);else if(4<=r._nrpnBuffer[i].length&&r._nrpnBuffer[i].length<=5&&s.controller.number===r.MIDI_NRPN_MESSAGES.paramlsb&&s.value===r.MIDI_NRPN_MESSAGES.nullactiveparameter){r._nrpnBuffer[i].push(s);var u=[];r._nrpnBuffer[i].forEach((function(e){u.push(e.data)}));var l=r._nrpnBuffer[i][0].value<<7|r._nrpnBuffer[i][1].value,c=r._nrpnBuffer[i][2].value;6===r._nrpnBuffer[i].length&&(c=r._nrpnBuffer[i][2].value<<7|r._nrpnBuffer[i][3].value);var d="";switch(r._nrpnBuffer[i][2].controller.number){case r.MIDI_NRPN_MESSAGES.entrymsb:d=r._nrpnTypes[0];break;case r.MIDI_NRPN_MESSAGES.increment:d=r._nrpnTypes[1];break;case r.MIDI_NRPN_MESSAGES.decrement:d=r._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var f={timestamp:s.timestamp,channel:s.channel,type:"nrpn",data:u,controller:{number:l,type:d,name:"Non-Registered Parameter "+l},value:c};r._nrpnBuffer[i]=[],this._userHandlers.channel[f.type]&&this._userHandlers.channel[f.type][f.channel]&&this._userHandlers.channel[f.type][f.channel].forEach((function(e){e(f)}))}else r._nrpnBuffer[i]=[];else r._nrpnBuffer[i].push(s)}},o.prototype._parseChannelEvent=function(e){var t,n,o=e.data[0]>>4,i=1+(15&e.data[0]);1<e.data.length&&(t=e.data[1],n=2<e.data.length?e.data[2]:void 0);var a={target:this,data:e.data,timestamp:e.timeStamp,channel:i};o===r.MIDI_CHANNEL_MESSAGES.noteoff||o===r.MIDI_CHANNEL_MESSAGES.noteon&&0===n?(a.type="noteoff",a.note={number:t,name:r._notes[t%12],octave:r.getOctave(t)},a.velocity=n/127,a.rawVelocity=n):o===r.MIDI_CHANNEL_MESSAGES.noteon?(a.type="noteon",a.note={number:t,name:r._notes[t%12],octave:r.getOctave(t)},a.velocity=n/127,a.rawVelocity=n):o===r.MIDI_CHANNEL_MESSAGES.keyaftertouch?(a.type="keyaftertouch",a.note={number:t,name:r._notes[t%12],octave:r.getOctave(t)},a.value=n/127):o===r.MIDI_CHANNEL_MESSAGES.controlchange&&0<=t&&t<=119?(a.type="controlchange",a.controller={number:t,name:this.getCcNameByNumber(t)},a.value=n):o===r.MIDI_CHANNEL_MESSAGES.channelmode&&120<=t&&t<=127?(a.type="channelmode",a.controller={number:t,name:this.getChannelModeByNumber(t)},a.value=n):o===r.MIDI_CHANNEL_MESSAGES.programchange?(a.type="programchange",a.value=t):o===r.MIDI_CHANNEL_MESSAGES.channelaftertouch?(a.type="channelaftertouch",a.value=t/127):o===r.MIDI_CHANNEL_MESSAGES.pitchbend?(a.type="pitchbend",a.value=((n<<7)+t-8192)/8192):a.type="unknownchannelmessage",this._userHandlers.channel[a.type]&&this._userHandlers.channel[a.type][i]&&this._userHandlers.channel[a.type][i].forEach((function(e){e(a)}))},o.prototype.getCcNameByNumber=function(e){if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var t in r.MIDI_CONTROL_CHANGE_MESSAGES)if(r.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===r.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},o.prototype.getChannelModeByNumber=function(e){if(!(120<=(e=Math.floor(e))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in r.MIDI_CHANNEL_MODE_MESSAGES)if(r.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===r.MIDI_CHANNEL_MODE_MESSAGES[t])return t},o.prototype._parseSystemEvent=function(e){var t=e.data[0],n={target:this,data:e.data,timestamp:e.timeStamp};t===r.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===r.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===r.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===r.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]):t===r.MIDI_SYSTEM_MESSAGES.tuningrequest?n.type="tuningrequest":t===r.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===r.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===r.MIDI_SYSTEM_MESSAGES.continue?n.type="continue":t===r.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===r.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===r.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownsystemmessage",this._userHandlers.system[n.type]&&this._userHandlers.system[n.type].forEach((function(e){e(n)}))},i.prototype.send=function(e,t,n){if(!(128<=e&&e<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach((function(e){var t=Math.floor(e);if(!(0<=t&&t<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(t)})),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},i.prototype.sendSysex=function(e,t,n){if(!r.sysexEnabled)throw new Error("Sysex message support must first be activated.");return n=n||{},e=[].concat(e),t.forEach((function(e){if(e<0||127<e)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")})),t=e.concat(t,r.MIDI_SYSTEM_MESSAGES.sysexend),this.send(r.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(n.time)),this},i.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},i.prototype.sendSongPosition=function(e,t){t=t||{};var n=(e=Math.floor(e)||0)>>7&127,o=127&e;return this.send(r.MIDI_SYSTEM_MESSAGES.songposition,[n,o],this._parseTimeParameter(t.time)),this},i.prototype.sendSongSelect=function(e,t){if(t=t||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(r.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},i.prototype.sendTuningRequest=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendClock=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStart=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendContinue=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStop=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendActiveSensing=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},i.prototype.sendReset=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},i.prototype.stopNote=function(e,t,n){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,n);var o=64;return(n=n||{}).rawVelocity?!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=127&&(o=n.velocity):!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=1&&(o=127*n.velocity),this._convertNoteToArray(e).forEach(function(e){r.toMIDIChannels(t).forEach(function(t){this.send((r.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(o)],this._parseTimeParameter(n.time))}.bind(this))}.bind(this)),this},i.prototype.playNote=function(e,t,n){var o,i=64;if((n=n||{}).rawVelocity?!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=127&&(i=n.velocity):!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=1&&(i=127*n.velocity),o=this._parseTimeParameter(n.time),this._convertNoteToArray(e).forEach(function(e){r.toMIDIChannels(t).forEach(function(t){this.send((r.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(i)],o)}.bind(this))}.bind(this)),!isNaN(n.duration)){n.duration<=0&&(n.duration=0);var a=64;n.rawVelocity?!isNaN(n.release)&&0<=n.release&&n.release<=127&&(a=n.release):!isNaN(n.release)&&0<=n.release&&n.release<=1&&(a=127*n.release),this._convertNoteToArray(e).forEach(function(e){r.toMIDIChannels(t).forEach(function(t){this.send((r.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(a)],(o||r.time)+n.duration)}.bind(this))}.bind(this))}return this},i.prototype.sendKeyAftertouch=function(e,t,n,o){var i=this;if(o=o||{},t<1||16<t)throw new RangeError("The channel must be between 1 and 16.");(isNaN(n)||n<0||1<n)&&(n=.5);var a=Math.round(127*n);return this._convertNoteToArray(e).forEach((function(e){r.toMIDIChannels(t).forEach((function(t){i.send((r.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,a],i._parseTimeParameter(o.time))}))})),this},i.prototype.sendControlChange=function(e,t,n,o){if(o=o||{},"string"==typeof e){if(void 0===(e=r.MIDI_CONTROL_CHANGE_MESSAGES[e]))throw new TypeError("Invalid controller name.")}else if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("Controller value must be between 0 and 127.");return r.toMIDIChannels(n).forEach(function(n){this.send((r.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(n-1),[e,t],this._parseTimeParameter(o.time))}.bind(this)),this},i.prototype._selectRegisteredParameter=function(e,t,n){var o=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){o.sendControlChange(101,e[0],t,{time:n}),o.sendControlChange(100,e[1],t,{time:n})})),this},i.prototype._selectNonRegisteredParameter=function(e,t,n){var o=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){o.sendControlChange(99,e[0],t,{time:n}),o.sendControlChange(98,e[1],t,{time:n})})),this},i.prototype._setCurrentRegisteredParameter=function(e,t,n){var o=this;if((e=[].concat(e))[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){o.sendControlChange(6,e[0],t,{time:n})})),e[1]=Math.floor(e[1]),0<=e[1]&&e[1]<=127&&r.toMIDIChannels(t).forEach((function(){o.sendControlChange(38,e[1],t,{time:n})})),this},i.prototype._deselectRegisteredParameter=function(e,t){var n=this;return r.toMIDIChannels(e).forEach((function(){n.sendControlChange(101,127,e,{time:t}),n.sendControlChange(100,127,e,{time:t})})),this},i.prototype.setRegisteredParameter=function(e,t,n,o){var i=this;if(o=o||{},!Array.isArray(e)){if(!r.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=r.MIDI_REGISTERED_PARAMETER[e]}return r.toMIDIChannels(n).forEach((function(){i._selectRegisteredParameter(e,n,o.time),i._setCurrentRegisteredParameter(t,n,o.time),i._deselectRegisteredParameter(n,o.time)})),this},i.prototype.setNonRegisteredParameter=function(e,t,n,o){var i=this;if(o=o||{},!(0<=e[0]&&e[0]<=127&&0<=e[1]&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),r.toMIDIChannels(n).forEach((function(){i._selectNonRegisteredParameter(e,n,o.time),i._setCurrentRegisteredParameter(t,n,o.time),i._deselectRegisteredParameter(n,o.time)})),this},i.prototype.incrementRegisteredParameter=function(e,t,n){var o=this;if(n=n||{},!Array.isArray(e)){if(!r.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=r.MIDI_REGISTERED_PARAMETER[e]}return r.toMIDIChannels(t).forEach((function(){o._selectRegisteredParameter(e,t,n.time),o.sendControlChange(96,0,t,{time:n.time}),o._deselectRegisteredParameter(t,n.time)})),this},i.prototype.decrementRegisteredParameter=function(e,t,n){if(n=n||{},!Array.isArray(e)){if(!r.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=r.MIDI_REGISTERED_PARAMETER[e]}return r.toMIDIChannels(t).forEach(function(){this._selectRegisteredParameter(e,t,n.time),this.sendControlChange(97,0,t,{time:n.time}),this._deselectRegisteredParameter(t,n.time)}.bind(this)),this},i.prototype.setPitchBendRange=function(e,t,n,o){var i=this;if(o=o||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return r.toMIDIChannels(n).forEach((function(){i.setRegisteredParameter("pitchbendrange",[e,t],n,{time:o.time})})),this},i.prototype.setModulationRange=function(e,t,n,o){var i=this;if(o=o||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return r.toMIDIChannels(n).forEach((function(){i.setRegisteredParameter("modulationrange",[e,t],n,{time:o.time})})),this},i.prototype.setMasterTuning=function(e,t,n){var o=this;if(n=n||{},(e=parseFloat(e)||0)<=-65||64<=e)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var i=Math.floor(e)+64,a=e-Math.floor(e),s=(a=Math.round((a+1)/2*16383))>>7&127,u=127&a;return r.toMIDIChannels(t).forEach((function(){o.setRegisteredParameter("channelcoarsetuning",i,t,{time:n.time}),o.setRegisteredParameter("channelfinetuning",[s,u],t,{time:n.time})})),this},i.prototype.setTuningProgram=function(e,t,n){var o=this;if(n=n||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The program value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){o.setRegisteredParameter("tuningprogram",e,t,{time:n.time})})),this},i.prototype.setTuningBank=function(e,t,n){var o=this;if(n=n||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The bank value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){o.setRegisteredParameter("tuningbank",e,t,{time:n.time})})),this},i.prototype.sendChannelMode=function(e,t,n,o){if(o=o||{},"string"==typeof e){if(!(e=r.MIDI_CHANNEL_MODE_MESSAGES[e]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(e=Math.floor(e))&&e<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((t=Math.floor(t)||0)<0||127<t)throw new RangeError("Value must be an integer between 0 and 127.");return r.toMIDIChannels(n).forEach(function(n){this.send((r.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(n-1),[e,t],this._parseTimeParameter(o.time))}.bind(this)),this},i.prototype.sendProgramChange=function(e,t,n){var o=this;if(n=n||{},e=Math.floor(e),isNaN(e)||e<0||127<e)throw new RangeError("Program numbers must be between 0 and 127.");return r.toMIDIChannels(t).forEach((function(t){o.send((r.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],o._parseTimeParameter(n.time))})),this},i.prototype.sendChannelAftertouch=function(e,t,n){var o=this;n=n||{},e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=.5);var i=Math.round(127*e);return r.toMIDIChannels(t).forEach((function(e){o.send((r.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[i],o._parseTimeParameter(n.time))})),this},i.prototype.sendPitchBend=function(e,t,n){var o=this;if(n=n||{},isNaN(e)||e<-1||1<e)throw new RangeError("Pitch bend value must be between -1 and 1.");var i=Math.round((e+1)/2*16383),a=i>>7&127,s=127&i;return r.toMIDIChannels(t).forEach((function(e){o.send((r.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[s,a],o._parseTimeParameter(n.time))})),this},i.prototype._parseTimeParameter=function(e){var t,n=parseFloat(e);return"string"==typeof e&&"+"===e.substring(0,1)?n&&0<n&&(t=r.time+n):n>r.time&&(t=n),t},i.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach((function(e){t.push(r.guessNoteNumber(e))})),t},t.exports?t.exports=r:e.WebMidi||(e.WebMidi=r)}(e)}));return function(e){var t=Object.assign({},{enabled:!0,gui:new pr.GUI,midiPerColor:2,colors:["#ee907b","#2ed9c3","#5887da","#b4b3df"]},e),n=[],r=t.gui,o=[],i={},a=!1,s=!1,u=null,l=function(){navigator.requestMIDIAccess&&(!window.env||"production"!==window.env)&&(u=_r).enable((function(e){e?console.error("WebMIDI is not supported in this browser."):(console.log("MIDI devices successfully connected."),f())}))},c=function(){document.addEventListener("keydown",(function(e){18===e.keyCode&&(a=!0)})),document.addEventListener("keyup",(function(e){18===e.keyCode&&(a=!1)})),document.addEventListener("keyup",(function(e){17===e.keyCode&&t.toggle()}))},d=function(){var e=document.createElement("style");e.type="text/css";var n=1;t.colors.forEach((function(r,o){for(var i=0,a=t.midiPerColor;i<a;i++)e.appendChild(document.createTextNode("\n          .dg .cr:nth-child(".concat(t.colors.length*t.midiPerColor,"n + ").concat(n,") {\n            border-left-color: ").concat(r,";\n          }\n        "))),n++})),document.querySelector("head").appendChild(e)},f=function(){u.inputs.forEach((function(e){e.addListener("midimessage","all",h)}))},h=function(e){var t=an(e.data,3),n=t[0],r=t[1],o=t[2];a&&console.log("command: ".concat(n," / note: ").concat(r," / velocity: ").concat(o)),p(r,o),_(r,o)},p=function(e,n){var r=o.indexOf(e);if(!(r<0)){var i=t._getNumericControllerAtIndex(r);if(i){var a=i.__min,s=i.__max,u=i.__step,l=u||(s-a)/127,c=t._mapRange(0,127,a,s,n),d=t._snap(l.toFixed(5),c);i.setValue(d)}}},_=function(e,n){i[e]&&i[e].call(t,n)};return t._mapRange=function(e,t,n,r,o){return(o-e)*(r-n)/(t-e)+n},t._snap=function(e,t){return Math.round(t/e)*e},t._getNumericControllerAtIndex=function(e){return t.getControllers().filter((function(e){return void 0!==on(e.min)&&void 0!==on(e.max)}))[e]},t.add=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=r.add.apply(r,t);return o},t.addColor=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=r.addColor.apply(r,t);return o},t.setFolder=function(e){var o=t.gui.addFolder(e);return n.push(o),r=o,o},t.getControllers=function(){return(n.length?n:[t.gui]).filter((function(e){return!e.closed})).reduce((function(e,t){return e.concat(t.__controllers)}),[])},t.removeFolder=function(e){var o=n.findIndex((function(t){return t.name===e.name}));n.splice(o,1),t.gui.removeFolder(e),r=t.gui},t.connectMidiRange=function(e,t){for(var n=e,r=t+1;n<r;n++)o.push(n)},t.addControl=function(e,t){i[e]=t},t.destroy=function(){t.gui.destroy(),u&&(u.inputs.forEach((function(e){e.removeListener("midimessage","all")})),u.disable())},t.clear=function(){t.gui.destroy(),t.gui=new pr.GUI,r=t.gui,i={}},t.hide=function(){s=!0,t.gui.hide()},t.show=function(){s=!1,t.gui.show()},t.toggle=function(){(s=!s)?t.hide():t.show()},t.update=function(){t.getControllers().forEach((function(e){e.updateDisplay()}))},l(),c(),d(),t}}));
