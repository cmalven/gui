(function(ie,z){typeof exports=="object"&&typeof module!="undefined"?module.exports=z():typeof define=="function"&&define.amd?define(z):(ie=typeof globalThis!="undefined"?globalThis:ie||self,ie.Gui=z())})(this,function(){"use strict";function ie(o){if(!!o&&typeof window!="undefined"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=o,document.head.appendChild(e),o}}function z(o,e){var n=o.__state.conversionName.toString(),r=Math.round(o.r),s=Math.round(o.g),u=Math.round(o.b),t=o.a,i=Math.round(o.h),a=o.s.toFixed(1),l=o.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var c=o.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}else{if(n==="CSS_RGB")return"rgb("+r+","+s+","+u+")";if(n==="CSS_RGBA")return"rgba("+r+","+s+","+u+","+t+")";if(n==="HEX")return"0x"+o.hex.toString(16);if(n==="RGB_ARRAY")return"["+r+","+s+","+u+"]";if(n==="RGBA_ARRAY")return"["+r+","+s+","+u+","+t+"]";if(n==="RGB_OBJ")return"{r:"+r+",g:"+s+",b:"+u+"}";if(n==="RGBA_OBJ")return"{r:"+r+",g:"+s+",b:"+u+",a:"+t+"}";if(n==="HSV_OBJ")return"{h:"+i+",s:"+a+",v:"+l+"}";if(n==="HSVA_OBJ")return"{h:"+i+",s:"+a+",v:"+l+",a:"+t+"}"}return"unknown format"}var Re=Array.prototype.forEach,oe=Array.prototype.slice,h={BREAK:{},extend:function(e){return this.each(oe.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(n[s])||(e[s]=n[s])}.bind(this))},this),e},defaults:function(e){return this.each(oe.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(e[s])&&(e[s]=n[s])}.bind(this))},this),e},compose:function(){var e=oe.call(arguments);return function(){for(var n=oe.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(e,n,r){if(!!e){if(Re&&e.forEach&&e.forEach===Re)e.forEach(n,r);else if(e.length===e.length+0){var s=void 0,u=void 0;for(s=0,u=e.length;s<u;s++)if(s in e&&n.call(r,e[s],s)===this.BREAK)return}else for(var t in e)if(n.call(r,e[t],t)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,n,r){var s=void 0;return function(){var u=this,t=arguments;function i(){s=null,r||e.apply(u,t)}var a=r||!s;clearTimeout(s),s=setTimeout(i,n),a&&e.apply(u,t)}},toArray:function(e){return e.toArray?e.toArray():oe.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(o){function e(n){return o.apply(this,arguments)}return e.toString=function(){return o.toString()},e}(function(o){return isNaN(o)}),isArray:Array.isArray||function(o){return o.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},Ze=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:z},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:z},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:z},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:z}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],ae=void 0,_e=void 0,pe=function(){_e=!1;var e=arguments.length>1?h.toArray(arguments):arguments[0];return h.each(Ze,function(n){if(n.litmus(e))return h.each(n.conversions,function(r,s){if(ae=r.read(e),_e===!1&&ae!==!1)return _e=ae,ae.conversionName=s,ae.conversion=r,h.BREAK}),h.BREAK}),_e},ke=void 0,se={hsv_to_rgb:function(e,n,r){var s=Math.floor(e/60)%6,u=e/60-Math.floor(e/60),t=r*(1-n),i=r*(1-u*n),a=r*(1-(1-u)*n),l=[[r,a,t],[i,r,t],[t,r,a],[t,i,r],[a,t,r],[r,t,i]][s];return{r:l[0]*255,g:l[1]*255,b:l[2]*255}},rgb_to_hsv:function(e,n,r){var s=Math.min(e,n,r),u=Math.max(e,n,r),t=u-s,i=void 0,a=void 0;if(u!==0)a=t/u;else return{h:NaN,s:0,v:0};return e===u?i=(n-r)/t:n===u?i=2+(r-e)/t:i=4+(e-n)/t,i/=6,i<0&&(i+=1),{h:i*360,s:a,v:u/255}},rgb_to_hex:function(e,n,r){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,n),s=this.hex_with_component(s,0,r),s},component_from_hex:function(e,n){return e>>n*8&255},hex_with_component:function(e,n,r){return r<<(ke=n*8)|e&~(255<<ke)}},et=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},F=function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")},V=function(){function o(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&o(e.prototype,n),r&&o(e,r),e}}(),j=function o(e,n,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(s===void 0){var u=Object.getPrototypeOf(e);return u===null?void 0:o(u,n,r)}else{if("value"in s)return s.value;var t=s.get;return t===void 0?void 0:t.call(r)}},J=function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)},Q=function(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:o},L=function(){function o(){if(F(this,o),this.__state=pe.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return V(o,[{key:"toString",value:function(){return z(this)}},{key:"toHexString",value:function(){return z(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),o}();function ye(o,e,n){Object.defineProperty(o,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(L.recalculateRGB(this,e,n),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(L.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=s}})}function Ee(o,e){Object.defineProperty(o,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(L.recalculateHSV(this),this.__state[e])},set:function(r){this.__state.space!=="HSV"&&(L.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=r}})}L.recalculateRGB=function(o,e,n){if(o.__state.space==="HEX")o.__state[e]=se.component_from_hex(o.__state.hex,n);else if(o.__state.space==="HSV")h.extend(o.__state,se.hsv_to_rgb(o.__state.h,o.__state.s,o.__state.v));else throw new Error("Corrupted color state")},L.recalculateHSV=function(o){var e=se.rgb_to_hsv(o.r,o.g,o.b);h.extend(o.__state,{s:e.s,v:e.v}),h.isNaN(e.h)?h.isUndefined(o.__state.h)&&(o.__state.h=0):o.__state.h=e.h},L.COMPONENTS=["r","g","b","h","s","v","hex","a"],ye(L.prototype,"r",2),ye(L.prototype,"g",1),ye(L.prototype,"b",0),Ee(L.prototype,"h"),Ee(L.prototype,"s"),Ee(L.prototype,"v"),Object.defineProperty(L.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(L.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=se.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Z=function(){function o(e,n){F(this,o),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return V(o,[{key:"onChange",value:function(n){return this.__onChange=n,this}},{key:"onFinishChange",value:function(n){return this.__onFinishChange=n,this}},{key:"setValue",value:function(n){return this.object[this.property]=n,this.__onChange&&this.__onChange.call(this,n),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),o}(),tt={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},De={};h.each(tt,function(o,e){h.each(o,function(n){De[n]=e})});var nt=/(\d+(\.\d+)?)px/;function $(o){if(o==="0"||h.isUndefined(o))return 0;var e=o.match(nt);return h.isNull(e)?0:parseFloat(e[1])}var d={makeSelectable:function(e,n){e===void 0||e.style===void 0||(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,r){var s=r,u=n;h.isUndefined(u)&&(u=!0),h.isUndefined(s)&&(s=!0),e.style.position="absolute",u&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,r,s){var u=r||{},t=De[n];if(!t)throw new Error("Event type "+n+" not supported.");var i=document.createEvent(t);switch(t){case"MouseEvents":{var a=u.x||u.clientX||0,l=u.y||u.clientY||0;i.initMouseEvent(n,u.bubbles||!1,u.cancelable||!0,window,u.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var c=i.initKeyboardEvent||i.initKeyEvent;h.defaults(u,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(n,u.bubbles||!1,u.cancelable,window,u.ctrlKey,u.altKey,u.shiftKey,u.metaKey,u.keyCode,u.charCode);break}default:{i.initEvent(n,u.bubbles||!1,u.cancelable||!0);break}}h.defaults(i,s),e.dispatchEvent(i)},bind:function(e,n,r,s){var u=s||!1;return e.addEventListener?e.addEventListener(n,r,u):e.attachEvent&&e.attachEvent("on"+n,r),d},unbind:function(e,n,r,s){var u=s||!1;return e.removeEventListener?e.removeEventListener(n,r,u):e.detachEvent&&e.detachEvent("on"+n,r),d},addClass:function(e,n){if(e.className===void 0)e.className=n;else if(e.className!==n){var r=e.className.split(/ +/);r.indexOf(n)===-1&&(r.push(n),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var r=e.className.split(/ +/),s=r.indexOf(n);s!==-1&&(r.splice(s,1),e.className=r.join(" "))}else e.className=void 0;return d},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return $(n["border-left-width"])+$(n["border-right-width"])+$(n["padding-left"])+$(n["padding-right"])+$(n.width)},getHeight:function(e){var n=getComputedStyle(e);return $(n["border-top-width"])+$(n["border-bottom-width"])+$(n["padding-top"])+$(n["padding-bottom"])+$(n.height)},getOffset:function(e){var n=e,r={left:0,top:0};if(n.offsetParent)do r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;while(n);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Se=function(o){J(e,o);function e(n,r){F(this,e);var s=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),u=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function t(){u.setValue(!u.__prev)}return d.bind(s.__checkbox,"change",t,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return V(e,[{key:"setValue",value:function(r){var s=j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Z),Oe=function(o){J(e,o);function e(n,r,s){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),t=s,i=u;if(u.__select=document.createElement("select"),h.isArray(t)){var a={};h.each(t,function(l){a[l]=l}),t=a}return h.each(t,function(l,c){var f=document.createElement("option");f.innerHTML=c,f.setAttribute("value",l),i.__select.appendChild(f)}),u.updateDisplay(),d.bind(u.__select,"change",function(){var l=this.options[this.selectedIndex].value;i.setValue(l)}),u.domElement.appendChild(u.__select),u}return V(e,[{key:"setValue",value:function(r){var s=j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return d.isActive(this.__select)?this:(this.__select.value=this.getValue(),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Z),Pe=function(o){J(e,o);function e(n,r){F(this,e);var s=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),u=s;function t(){u.setValue(u.__input.value)}function i(){u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),d.bind(s.__input,"keyup",t),d.bind(s.__input,"change",t),d.bind(s.__input,"blur",i),d.bind(s.__input,"keydown",function(a){a.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return V(e,[{key:"updateDisplay",value:function(){return d.isActive(this.__input)||(this.__input.value=this.getValue()),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Z);function Le(o){var e=o.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var we=function(o){J(e,o);function e(n,r,s){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),t=s||{};return u.__min=t.min,u.__max=t.max,u.__step=t.step,h.isUndefined(u.__step)?u.initialValue===0?u.__impliedStep=1:u.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(u.initialValue))/Math.LN10))/10:u.__impliedStep=u.__step,u.__precision=Le(u.__impliedStep),u}return V(e,[{key:"setValue",value:function(r){var s=r;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!=0&&(s=Math.round(s/this.__step)*this.__step),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=Le(r),this}}]),e}(Z);function rt(o,e){var n=Math.pow(10,e);return Math.round(o*n)/n}var ue=function(o){J(e,o);function e(n,r,s){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,s));u.__truncationSuspended=!1;var t=u,i=void 0;function a(){var A=parseFloat(t.__input.value);h.isNaN(A)||t.setValue(A)}function l(){t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}function c(){l()}function f(A){var b=i-A.clientY;t.setValue(t.getValue()+b*t.__impliedStep),i=A.clientY}function m(){d.unbind(window,"mousemove",f),d.unbind(window,"mouseup",m),l()}function y(A){d.bind(window,"mousemove",f),d.bind(window,"mouseup",m),i=A.clientY}return u.__input=document.createElement("input"),u.__input.setAttribute("type","text"),d.bind(u.__input,"change",a),d.bind(u.__input,"blur",c),d.bind(u.__input,"mousedown",y),d.bind(u.__input,"keydown",function(A){A.keyCode===13&&(t.__truncationSuspended=!0,this.blur(),t.__truncationSuspended=!1,l())}),u.updateDisplay(),u.domElement.appendChild(u.__input),u}return V(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():rt(this.getValue(),this.__precision),j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(we);function He(o,e,n,r,s){return r+(s-r)*((o-e)/(n-e))}var me=function(o){J(e,o);function e(n,r,s,u,t){F(this,e);var i=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,{min:s,max:u,step:t})),a=i;i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),d.bind(i.__background,"mousedown",l),d.bind(i.__background,"touchstart",m),d.addClass(i.__background,"slider"),d.addClass(i.__foreground,"slider-fg");function l(b){document.activeElement.blur(),d.bind(window,"mousemove",c),d.bind(window,"mouseup",f),c(b)}function c(b){b.preventDefault();var x=a.__background.getBoundingClientRect();return a.setValue(He(b.clientX,x.left,x.right,a.__min,a.__max)),!1}function f(){d.unbind(window,"mousemove",c),d.unbind(window,"mouseup",f),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function m(b){b.touches.length===1&&(d.bind(window,"touchmove",y),d.bind(window,"touchend",A),y(b))}function y(b){var x=b.touches[0].clientX,k=a.__background.getBoundingClientRect();a.setValue(He(x,k.left,k.right,a.__min,a.__max))}function A(){d.unbind(window,"touchmove",y),d.unbind(window,"touchend",A),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}return V(e,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",j(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(we),Ce=function(o){J(e,o);function e(n,r,s){F(this,e);var u=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),t=u;return u.__button=document.createElement("div"),u.__button.innerHTML=s===void 0?"Fire":s,d.bind(u.__button,"click",function(i){return i.preventDefault(),t.fire(),!1}),d.addClass(u.__button,"button"),u.domElement.appendChild(u.__button),u}return V(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Z),ge=function(o){J(e,o);function e(n,r){F(this,e);var s=Q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r));s.__color=new L(s.getValue()),s.__temp=new L(0);var u=s;s.domElement=document.createElement("div"),d.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",d.bind(s.__input,"keydown",function(b){b.keyCode===13&&f.call(this)}),d.bind(s.__input,"blur",f),d.bind(s.__selector,"mousedown",function(){d.addClass(this,"drag").bind(window,"mouseup",function(){d.removeClass(u.__selector,"drag")})}),d.bind(s.__selector,"touchstart",function(){d.addClass(this,"drag").bind(window,"touchend",function(){d.removeClass(u.__selector,"drag")})});var t=document.createElement("div");h.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),h.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),h.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),h.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),h.extend(t.style,{width:"100%",height:"100%",background:"none"}),Ge(t,"top","rgba(0,0,0,0)","#000"),h.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),ot(s.__hue_field),h.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),d.bind(s.__saturation_field,"mousedown",i),d.bind(s.__saturation_field,"touchstart",i),d.bind(s.__field_knob,"mousedown",i),d.bind(s.__field_knob,"touchstart",i),d.bind(s.__hue_field,"mousedown",a),d.bind(s.__hue_field,"touchstart",a);function i(b){y(b),d.bind(window,"mousemove",y),d.bind(window,"touchmove",y),d.bind(window,"mouseup",l),d.bind(window,"touchend",l)}function a(b){A(b),d.bind(window,"mousemove",A),d.bind(window,"touchmove",A),d.bind(window,"mouseup",c),d.bind(window,"touchend",c)}function l(){d.unbind(window,"mousemove",y),d.unbind(window,"touchmove",y),d.unbind(window,"mouseup",l),d.unbind(window,"touchend",l),m()}function c(){d.unbind(window,"mousemove",A),d.unbind(window,"touchmove",A),d.unbind(window,"mouseup",c),d.unbind(window,"touchend",c),m()}function f(){var b=pe(this.value);b!==!1?(u.__color.__state=b,u.setValue(u.__color.toOriginal())):this.value=u.__color.toString()}function m(){u.__onFinishChange&&u.__onFinishChange.call(u,u.__color.toOriginal())}s.__saturation_field.appendChild(t),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function y(b){b.type.indexOf("touch")===-1&&b.preventDefault();var x=u.__saturation_field.getBoundingClientRect(),k=b.touches&&b.touches[0]||b,U=k.clientX,B=k.clientY,Y=(U-x.left)/(x.right-x.left),K=1-(B-x.top)/(x.bottom-x.top);return K>1?K=1:K<0&&(K=0),Y>1?Y=1:Y<0&&(Y=0),u.__color.v=K,u.__color.s=Y,u.setValue(u.__color.toOriginal()),!1}function A(b){b.type.indexOf("touch")===-1&&b.preventDefault();var x=u.__hue_field.getBoundingClientRect(),k=b.touches&&b.touches[0]||b,U=k.clientY,B=1-(U-x.top)/(x.bottom-x.top);return B>1?B=1:B<0&&(B=0),u.__color.h=B*360,u.setValue(u.__color.toOriginal()),!1}return s}return V(e,[{key:"updateDisplay",value:function(){var r=pe(this.getValue());if(r!==!1){var s=!1;h.each(L.COMPONENTS,function(i){if(!h.isUndefined(r[i])&&!h.isUndefined(this.__color.__state[i])&&r[i]!==this.__color.__state[i])return s=!0,{}},this),s&&h.extend(this.__color.__state,r)}h.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var u=this.__color.v<.5||this.__color.s>.5?255:0,t=255-u;h.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+u+","+u+","+u+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Ge(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),h.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+u+","+u+","+u+")",textShadow:this.__input_textShadow+"rgba("+t+","+t+","+t+",.7)"})}}]),e}(Z),it=["-moz-","-o-","-webkit-","-ms-",""];function Ge(o,e,n,r){o.style.background="",h.each(it,function(s){o.style.cssText+="background: "+s+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "})}function ot(o){o.style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var at={load:function(e,n){var r=n||document,s=r.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,r.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,n){var r=n||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var u=r.getElementsByTagName("head")[0];try{u.appendChild(s)}catch{}}},st=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,ut=function(e,n){var r=e[n];return h.isArray(arguments[2])||h.isObject(arguments[2])?new Oe(e,n,arguments[2]):h.isNumber(r)?h.isNumber(arguments[2])&&h.isNumber(arguments[3])?h.isNumber(arguments[4])?new me(e,n,arguments[2],arguments[3],arguments[4]):new me(e,n,arguments[2],arguments[3]):h.isNumber(arguments[4])?new ue(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ue(e,n,{min:arguments[2],max:arguments[3]}):h.isString(r)?new Pe(e,n):h.isFunction(r)?new Ce(e,n,""):h.isBoolean(r)?new Se(e,n):null};function lt(o){setTimeout(o,1e3/60)}var dt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||lt,ct=function(){function o(){F(this,o),this.backgroundElement=document.createElement("div"),h.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),d.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),h.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;d.bind(this.backgroundElement,"click",function(){e.hide()})}return V(o,[{key:"show",value:function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),h.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var n=this,r=function s(){n.domElement.style.display="none",n.backgroundElement.style.display="none",d.unbind(n.domElement,"webkitTransitionEnd",s),d.unbind(n.domElement,"transitionend",s),d.unbind(n.domElement,"oTransitionEnd",s)};d.bind(this.domElement,"webkitTransitionEnd",r),d.bind(this.domElement,"transitionend",r),d.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"}}]),o}(),ft=ie(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);at.inject(ft);var Be="dg",Fe=72,Ve=20,le="Default",de=function(){try{return!!window.localStorage}catch{return!1}}(),ce=void 0,Ue=!0,te=void 0,Ae=!1,ze=[],T=function o(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),d.addClass(this.domElement,Be),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=h.defaults(r,{closeOnTop:!1,autoPlace:!0,width:o.DEFAULT_WIDTH}),r=h.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),h.isUndefined(r.load)?r.load={preset:le}:r.preset&&(r.load.preset=r.preset),h.isUndefined(r.parent)&&r.hideable&&ze.push(this),r.resizable=h.isUndefined(r.parent)&&r.resizable,r.autoPlace&&h.isUndefined(r.scrollable)&&(r.scrollable=!0);var s=de&&localStorage.getItem(ne(this,"isLocal"))==="true",u=void 0,t=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(m){n.parent?n.getRoot().preset=m:r.load.preset=m,mt(this),n.revert()}},width:{get:function(){return r.width},set:function(m){r.width=m,Te(n,m)}},name:{get:function(){return r.name},set:function(m){r.name=m,t&&(t.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(m){r.closed=m,r.closed?d.addClass(n.__ul,o.CLASS_CLOSED):d.removeClass(n.__ul,o.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=m?o.TEXT_OPEN:o.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(m){de&&(s=m,m?d.bind(window,"unload",u):d.unbind(window,"unload",u),localStorage.setItem(ne(n,"isLocal"),m))}}}),h.isUndefined(r.parent)){if(this.closed=r.closed||!1,d.addClass(this.domElement,o.CLASS_MAIN),d.makeSelectable(this.domElement,!1),de&&s){n.useLocalStorage=!0;var i=localStorage.getItem(ne(this,"gui"));i&&(r.load=JSON.parse(i))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=o.TEXT_CLOSED,d.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON),r.closeOnTop?(d.addClass(this.__closeButton,o.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(d.addClass(this.__closeButton,o.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),d.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{r.closed===void 0&&(r.closed=!0);var a=document.createTextNode(r.name);d.addClass(a,"controller-name"),t=Me(n,a);var l=function(m){return m.preventDefault(),n.closed=!n.closed,!1};d.addClass(this.__ul,o.CLASS_CLOSED),d.addClass(t,"title"),d.bind(t,"click",l),r.closed||(this.closed=!1)}r.autoPlace&&(h.isUndefined(r.parent)&&(Ue&&(te=document.createElement("div"),d.addClass(te,Be),d.addClass(te,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(te),Ue=!1),te.appendChild(this.domElement),d.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||Te(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},d.bind(window,"resize",this.__resizeHandler),d.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),d.bind(this.__ul,"transitionend",this.__resizeHandler),d.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&pt(this),u=function(){de&&localStorage.getItem(ne(n,"isLocal"))==="true"&&localStorage.setItem(ne(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=u;function c(){var f=n.getRoot();f.width+=1,h.defer(function(){f.width-=1})}r.parent||c()};T.toggleHide=function(){Ae=!Ae,h.each(ze,function(o){o.domElement.style.display=Ae?"none":""})},T.CLASS_AUTO_PLACE="a",T.CLASS_AUTO_PLACE_CONTAINER="ac",T.CLASS_MAIN="main",T.CLASS_CONTROLLER_ROW="cr",T.CLASS_TOO_TALL="taller-than-window",T.CLASS_CLOSED="closed",T.CLASS_CLOSE_BUTTON="close-button",T.CLASS_CLOSE_TOP="close-top",T.CLASS_CLOSE_BOTTOM="close-bottom",T.CLASS_DRAG="drag",T.DEFAULT_WIDTH=245,T.TEXT_CLOSED="Close Controls",T.TEXT_OPEN="Open Controls",T._keydownHandler=function(o){document.activeElement.type!=="text"&&(o.which===Fe||o.keyCode===Fe)&&T.toggleHide()},d.bind(window,"keydown",T._keydownHandler,!1),h.extend(T.prototype,{add:function(e,n){return fe(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return fe(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;h.defer(function(){n.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&te.removeChild(this.domElement);var e=this;h.each(this.__folders,function(n){e.removeFolder(n)}),d.unbind(window,"keydown",T._keydownHandler,!1),$e(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var r=new T(n);this.__folders[e]=r;var s=Me(this,r.domElement);return d.addClass(s,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],$e(e);var n=this;h.each(e.__folders,function(r){e.removeFolder(r)}),h.defer(function(){n.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=d.getOffset(e.__ul).top,r=0;h.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(r+=d.getHeight(s))}),window.innerHeight-n-Ve<r?(d.addClass(e.domElement,T.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-Ve+"px"):(d.removeClass(e.domElement,T.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&h.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:h.debounce(function(){this.onResize()},50),remember:function(){if(h.isUndefined(ce)&&(ce=new ct,ce.domElement.innerHTML=st),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;h.each(Array.prototype.slice.call(arguments),function(n){e.__rememberedObjects.length===0&&_t(e),e.__rememberedObjects.indexOf(n)===-1&&e.__rememberedObjects.push(n)}),this.autoPlace&&Te(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ve(this)),e.folders={},h.each(this.__folders,function(n,r){e.folders[r]=n.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ve(this),xe(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[le]=ve(this,!0)),this.load.remembered[e]=ve(this),this.preset=e,Ie(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){h.each(this.__controllers,function(n){this.getRoot().load.remembered?Ye(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())},this),h.each(this.__folders,function(n){n.revert(n)}),e||xe(this.getRoot(),!1)},listen:function(e){var n=this.__listening.length===0;this.__listening.push(e),n&&We(this.__listening)},updateDisplay:function(){h.each(this.__controllers,function(e){e.updateDisplay()}),h.each(this.__folders,function(e){e.updateDisplay()})}});function Me(o,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?o.__ul.insertBefore(r,n):o.__ul.appendChild(r),o.onResize(),r}function $e(o){d.unbind(window,"resize",o.__resizeHandler),o.saveToLocalStorageIfPossible&&d.unbind(window,"unload",o.saveToLocalStorageIfPossible)}function xe(o,e){var n=o.__preset_select[o.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function ht(o,e,n){if(n.__li=e,n.__gui=o,h.extend(n,{options:function(t){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),fe(o,n.object,n.property,{before:i,factoryArgs:[h.toArray(arguments)]})}if(h.isArray(t)||h.isObject(t)){var a=n.__li.nextElementSibling;return n.remove(),fe(o,n.object,n.property,{before:a,factoryArgs:[t]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof me){var r=new ue(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});h.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(u){var t=n[u],i=r[u];n[u]=r[u]=function(){var a=Array.prototype.slice.call(arguments);return i.apply(r,a),t.apply(n,a)}}),d.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ue){var s=function(t){if(h.isNumber(n.__min)&&h.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,a=n.__gui.__listening.indexOf(n)>-1;n.remove();var l=fe(o,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return l.name(i),a&&l.listen(),l}return t};n.min=h.compose(s,n.min),n.max=h.compose(s,n.max)}else n instanceof Se?(d.bind(e,"click",function(){d.fakeEvent(n.__checkbox,"click")}),d.bind(n.__checkbox,"click",function(u){u.stopPropagation()})):n instanceof Ce?(d.bind(e,"click",function(){d.fakeEvent(n.__button,"click")}),d.bind(e,"mouseover",function(){d.addClass(n.__button,"hover")}),d.bind(e,"mouseout",function(){d.removeClass(n.__button,"hover")})):n instanceof ge&&(d.addClass(e,"color"),n.updateDisplay=h.compose(function(u){return e.style.borderLeftColor=n.__color.toString(),u},n.updateDisplay),n.updateDisplay());n.setValue=h.compose(function(u){return o.getRoot().__preset_select&&n.isModified()&&xe(o.getRoot(),!0),u},n.setValue)}function Ye(o,e){var n=o.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=n.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},n.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,n.load&&n.load.remembered){var u=n.load.remembered,t=void 0;if(u[o.preset])t=u[o.preset];else if(u[le])t=u[le];else return;if(t[r]&&t[r][e.property]!==void 0){var i=t[r][e.property];e.initialValue=i,e.setValue(i)}}}}function fe(o,e,n,r){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var s=void 0;if(r.color)s=new ge(e,n);else{var u=[e,n].concat(r.factoryArgs);s=ut.apply(o,u)}r.before instanceof Z&&(r.before=r.before.__li),Ye(o,s),d.addClass(s.domElement,"c");var t=document.createElement("span");d.addClass(t,"property-name"),t.innerHTML=s.property;var i=document.createElement("div");i.appendChild(t),i.appendChild(s.domElement);var a=Me(o,i,r.before);return d.addClass(a,T.CLASS_CONTROLLER_ROW),s instanceof ge?d.addClass(a,"color"):d.addClass(a,et(s.getValue())),ht(o,a,s),o.__controllers.push(s),s}function ne(o,e){return document.location.href+"."+e}function Ie(o,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,o.__preset_select.appendChild(r),n&&(o.__preset_select.selectedIndex=o.__preset_select.length-1)}function Ke(o,e){e.style.display=o.useLocalStorage?"block":"none"}function _t(o){var e=o.__save_row=document.createElement("li");d.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),d.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",d.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",d.addClass(r,"button"),d.addClass(r,"save");var s=document.createElement("span");s.innerHTML="New",d.addClass(s,"button"),d.addClass(s,"save-as");var u=document.createElement("span");u.innerHTML="Revert",d.addClass(u,"button"),d.addClass(u,"revert");var t=o.__preset_select=document.createElement("select");if(o.load&&o.load.remembered?h.each(o.load.remembered,function(f,m){Ie(o,m,m===o.preset)}):Ie(o,le,!1),d.bind(t,"change",function(){for(var f=0;f<o.__preset_select.length;f++)o.__preset_select[f].innerHTML=o.__preset_select[f].value;o.preset=this.value}),e.appendChild(t),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(u),de){var i=document.getElementById("dg-local-explain"),a=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(ne(o,"isLocal"))==="true"&&a.setAttribute("checked","checked"),Ke(o,i),d.bind(a,"change",function(){o.useLocalStorage=!o.useLocalStorage,Ke(o,i)})}var c=document.getElementById("dg-new-constructor");d.bind(c,"keydown",function(f){f.metaKey&&(f.which===67||f.keyCode===67)&&ce.hide()}),d.bind(n,"click",function(){c.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),ce.show(),c.focus(),c.select()}),d.bind(r,"click",function(){o.save()}),d.bind(s,"click",function(){var f=prompt("Enter a new preset name.");f&&o.saveAs(f)}),d.bind(u,"click",function(){o.revert()})}function pt(o){var e=void 0;o.__resize_handle=document.createElement("div"),h.extend(o.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(u){return u.preventDefault(),o.width+=e-u.clientX,o.onResize(),e=u.clientX,!1}function r(){d.removeClass(o.__closeButton,T.CLASS_DRAG),d.unbind(window,"mousemove",n),d.unbind(window,"mouseup",r)}function s(u){return u.preventDefault(),e=u.clientX,d.addClass(o.__closeButton,T.CLASS_DRAG),d.bind(window,"mousemove",n),d.bind(window,"mouseup",r),!1}d.bind(o.__resize_handle,"mousedown",s),d.bind(o.__closeButton,"mousedown",s),o.domElement.insertBefore(o.__resize_handle,o.domElement.firstElementChild)}function Te(o,e){o.domElement.style.width=e+"px",o.__save_row&&o.autoPlace&&(o.__save_row.style.width=e+"px"),o.__closeButton&&(o.__closeButton.style.width=e+"px")}function ve(o,e){var n={};return h.each(o.__rememberedObjects,function(r,s){var u={},t=o.__rememberedObjectIndecesToControllers[s];h.each(t,function(i,a){u[a]=e?i.initialValue:i.getValue()}),n[s]=u}),n}function mt(o){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].value===o.preset&&(o.__preset_select.selectedIndex=e)}function We(o){o.length!==0&&dt.call(window,function(){We(o)}),h.each(o,function(e){e.updateDisplay()})}var gt={Color:L,math:se,interpret:pe},vt={Controller:Z,BooleanController:Se,OptionController:Oe,StringController:Pe,NumberController:we,NumberControllerBox:ue,NumberControllerSlider:me,FunctionController:Ce,ColorController:ge},bt={dom:d},yt={GUI:T},Et=T,qe={color:gt,controllers:vt,dom:bt,gui:yt,GUI:Et},St=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Xe={exports:{}};(function(o){(function(e){function n(){if(n.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(n.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return this.interface!==void 0}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(t){return this._nrpnEventsEnabled=t,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var r=new n;function s(t){var i=this;this._userHandlers={channel:{},system:{}},this._midiInput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiInput.connection}},id:{enumerable:!0,get:function(){return i._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiInput.name}},state:{enumerable:!0,get:function(){return i._midiInput.state}},type:{enumerable:!0,get:function(){return i._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function u(t){var i=this;this._midiOutput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiOutput.connection}},id:{enumerable:!0,get:function(){return i._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiOutput.name}},state:{enumerable:!0,get:function(){return i._midiOutput.state}},type:{enumerable:!0,get:function(){return i._midiOutput.type}}})}n.prototype.enable=function(t,i){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:i}).then(function(a){var l,c=[],f=[];this.interface=a,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(k){c.push(k)};for(var m=a.inputs.values(),y=m.next();y&&!y.done;y=m.next())f.push(y.value.open());for(var A=a.outputs.values(),b=A.next();b&&!b.done;b=A.next())f.push(b.value.open());function x(){clearTimeout(l),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),typeof t=="function"&&t.call(this),c.forEach(function(k){this._onInterfaceStateChange(k)}.bind(this))}l=setTimeout(x.bind(this),200),Promise&&Promise.all(f).catch(function(k){}).then(x.bind(this))}.bind(this),function(a){typeof t=="function"&&t.call(this,a)}.bind(this)):typeof t=="function"&&t(new Error("The Web MIDI API is not supported by your browser.")))},n.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},n.prototype.addListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if(typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[t].push(i),this},n.prototype.hasListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if(typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");for(var a=0;a<this._userHandlers[t].length;a++)if(this._userHandlers[t][a]===i)return!0;return!1},n.prototype.removeListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(i!==void 0&&typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(t))if(i)for(var a=0;a<this._userHandlers[t].length;a++)this._userHandlers[t][a]===i&&this._userHandlers[t].splice(a,1);else this._userHandlers[t]=[];else{if(t!==void 0)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},n.prototype.toMIDIChannels=function(t){var i;if(t==="all"||t===void 0)i=["all"];else{if(t==="none")return i=[];i=Array.isArray(t)?t:[t]}return-1<i.indexOf("all")&&(i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),i.map(function(a){return parseInt(a)}).filter(function(a){return 1<=a&&a<=16})},n.prototype.getInputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===t)return this.inputs[i];return!1},n.prototype.getOutputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===t)return this.outputs[i];return!1},n.prototype.getInputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(t))return this.inputs[i];return!1},n.prototype.getOctave=function(t){if(t!=null&&0<=t&&t<=127)return Math.floor(Math.floor(t)/12-1)+Math.floor(r.octaveOffset)},n.prototype.getOutputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(t))return this.outputs[i];return!1},n.prototype.guessNoteNumber=function(t){var i=!1;if(t&&t.toFixed&&0<=t&&t<=127?i=Math.round(t):0<=parseInt(t)&&parseInt(t)<=127?i=parseInt(t):(typeof t=="string"||t instanceof String)&&(i=this.noteNameToNumber(t)),i===!1)throw new Error("Invalid input value ("+t+").");return i},n.prototype.noteNameToNumber=function(t){typeof t!="string"&&(t="");var i=t.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!i)throw new RangeError("Invalid note name.");var a=r._semitones[i[1].toUpperCase()],l=12*(parseInt(i[3])+1-Math.floor(r.octaveOffset))+a;if(-1<i[2].toLowerCase().indexOf("b")?l-=i[2].length:-1<i[2].toLowerCase().indexOf("#")&&(l+=i[2].length),l<0||127<l)throw new RangeError("Invalid note name or note outside valid range.");return l},n.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},n.prototype._updateInputs=function(){for(var t=0;t<this._inputs.length;t++){for(var i=!0,a=this.interface.inputs.values(),l=a.next();l&&!l.done;l=a.next())if(this._inputs[t]._midiInput===l.value){i=!1;break}i&&this._inputs.splice(t,1)}this.interface&&this.interface.inputs.forEach(function(c){for(var f=!0,m=0;m<this._inputs.length;m++)this._inputs[m]._midiInput===c&&(f=!1);f&&this._inputs.push(new s(c))}.bind(this))},n.prototype._updateOutputs=function(){for(var t=0;t<this._outputs.length;t++){for(var i=!0,a=this.interface.outputs.values(),l=a.next();l&&!l.done;l=a.next())if(this._outputs[t]._midiOutput===l.value){i=!1;break}i&&this._outputs.splice(t,1)}this.interface&&this.interface.outputs.forEach(function(c){for(var f=!0,m=0;m<this._outputs.length;m++)this._outputs[m]._midiOutput===c&&(f=!1);f&&this._outputs.push(new u(c))}.bind(this))},n.prototype._onInterfaceStateChange=function(t){this._updateInputsAndOutputs();var i={timestamp:t.timeStamp,type:t.port.state};this.interface&&t.port.state==="connected"?t.port.type==="output"?i.port=this.getOutputById(t.port.id):t.port.type==="input"&&(i.port=this.getInputById(t.port.id)):i.port={connection:"closed",id:t.port.id,manufacturer:t.port.manufacturer,name:t.port.name,state:t.port.state,type:t.port.type},this._userHandlers[t.port.state].forEach(function(a){a(i)})},n.prototype._resetInterfaceUserHandlers=function(){for(var t=0;t<this._midiInterfaceEvents.length;t++)this._userHandlers[this._midiInterfaceEvents[t]]=[]},s.prototype.on=s.prototype.addListener=function(t,i,a){var l=this;if(i===void 0&&(i="all"),Array.isArray(i)||(i=[i]),i.forEach(function(f){if(f!=="all"&&!(1<=f&&f<=16))throw new RangeError("The 'channel' parameter is invalid.")}),typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(r.MIDI_SYSTEM_MESSAGES[t]!==void 0)this._userHandlers.system[t]||(this._userHandlers.system[t]=[]),this._userHandlers.system[t].push(a);else{if(r.MIDI_CHANNEL_MESSAGES[t]===void 0)throw new TypeError("The specified event type is not supported.");if(-1<i.indexOf("all")){i=[];for(var c=1;c<=16;c++)i.push(c)}this._userHandlers.channel[t]||(this._userHandlers.channel[t]=[]),i.forEach(function(f){l._userHandlers.channel[t][f]||(l._userHandlers.channel[t][f]=[]),l._userHandlers.channel[t][f].push(a)})}return this},s.prototype.hasListener=function(t,i,a){var l=this;if(typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i===void 0&&(i="all"),i.constructor!==Array&&(i=[i]),r.MIDI_SYSTEM_MESSAGES[t]!==void 0){for(var c=0;c<this._userHandlers.system[t].length;c++)if(this._userHandlers.system[t][c]===a)return!0}else if(r.MIDI_CHANNEL_MESSAGES[t]!==void 0){if(-1<i.indexOf("all")){i=[];for(var f=1;f<=16;f++)i.push(f)}return!!this._userHandlers.channel[t]&&i.every(function(m){var y=l._userHandlers.channel[t][m];return y&&-1<y.indexOf(a)})}return!1},s.prototype.removeListener=function(t,i,a){var l=this;if(a!==void 0&&typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i===void 0&&(i="all"),i.constructor!==Array&&(i=[i]),r.MIDI_SYSTEM_MESSAGES[t]!==void 0)if(a===void 0)this._userHandlers.system[t]=[];else for(var c=0;c<this._userHandlers.system[t].length;c++)this._userHandlers.system[t][c]===a&&this._userHandlers.system[t].splice(c,1);else if(r.MIDI_CHANNEL_MESSAGES[t]!==void 0){if(-1<i.indexOf("all")){i=[];for(var f=1;f<=16;f++)i.push(f)}if(!this._userHandlers.channel[t])return this;i.forEach(function(m){var y=l._userHandlers.channel[t][m];if(y)if(a===void 0)l._userHandlers.channel[t][m]=[];else for(var A=0;A<y.length;A++)y[A]===a&&y.splice(A,1)})}else{if(t!==void 0)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},s.prototype._initializeUserHandlers=function(){for(var t in r.MIDI_CHANNEL_MESSAGES)r.MIDI_CHANNEL_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.channel[t]={});for(var i in r.MIDI_SYSTEM_MESSAGES)r.MIDI_SYSTEM_MESSAGES.hasOwnProperty(i)&&(this._userHandlers.system[i]=[])},s.prototype._onMidiMessage=function(t){if(0<this._userHandlers.system.midimessage.length){var i={target:this,data:t.data,timestamp:t.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(a){a(i)})}t.data[0]<240?(this._parseChannelEvent(t),this._parseNrpnEvent(t)):t.data[0]<=255&&this._parseSystemEvent(t)},s.prototype._parseNrpnEvent=function(t){var i,a,l=t.data[0]>>4,c=15&t.data[0],f=1+c;if(1<t.data.length&&(i=t.data[1],a=2<t.data.length?t.data[2]:void 0),r.nrpnEventsEnabled&&l===r.MIDI_CHANNEL_MESSAGES.controlchange&&(i>=r.MIDI_NRPN_MESSAGES.increment&&i<=r.MIDI_NRPN_MESSAGES.parammsb||i===r.MIDI_NRPN_MESSAGES.entrymsb||i===r.MIDI_NRPN_MESSAGES.entrylsb)){var m={target:this,type:"controlchange",data:t.data,timestamp:t.timeStamp,channel:f,controller:{number:i,name:this.getCcNameByNumber(i)},value:a};if(m.controller.number===r.MIDI_NRPN_MESSAGES.parammsb&&m.value!=r.MIDI_NRPN_MESSAGES.nullactiveparameter)r._nrpnBuffer[c]=[],r._nrpnBuffer[c][0]=m;else if(r._nrpnBuffer[c].length===1&&m.controller.number===r.MIDI_NRPN_MESSAGES.paramlsb)r._nrpnBuffer[c].push(m);else if(r._nrpnBuffer[c].length!==2||m.controller.number!==r.MIDI_NRPN_MESSAGES.increment&&m.controller.number!==r.MIDI_NRPN_MESSAGES.decrement&&m.controller.number!==r.MIDI_NRPN_MESSAGES.entrymsb)if(r._nrpnBuffer[c].length===3&&r._nrpnBuffer[c][2].number===r.MIDI_NRPN_MESSAGES.entrymsb&&m.controller.number===r.MIDI_NRPN_MESSAGES.entrylsb)r._nrpnBuffer[c].push(m);else if(3<=r._nrpnBuffer[c].length&&r._nrpnBuffer[c].length<=4&&m.controller.number===r.MIDI_NRPN_MESSAGES.parammsb&&m.value===r.MIDI_NRPN_MESSAGES.nullactiveparameter)r._nrpnBuffer[c].push(m);else if(4<=r._nrpnBuffer[c].length&&r._nrpnBuffer[c].length<=5&&m.controller.number===r.MIDI_NRPN_MESSAGES.paramlsb&&m.value===r.MIDI_NRPN_MESSAGES.nullactiveparameter){r._nrpnBuffer[c].push(m);var y=[];r._nrpnBuffer[c].forEach(function(U){y.push(U.data)});var A=r._nrpnBuffer[c][0].value<<7|r._nrpnBuffer[c][1].value,b=r._nrpnBuffer[c][2].value;r._nrpnBuffer[c].length===6&&(b=r._nrpnBuffer[c][2].value<<7|r._nrpnBuffer[c][3].value);var x="";switch(r._nrpnBuffer[c][2].controller.number){case r.MIDI_NRPN_MESSAGES.entrymsb:x=r._nrpnTypes[0];break;case r.MIDI_NRPN_MESSAGES.increment:x=r._nrpnTypes[1];break;case r.MIDI_NRPN_MESSAGES.decrement:x=r._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var k={timestamp:m.timestamp,channel:m.channel,type:"nrpn",data:y,controller:{number:A,type:x,name:"Non-Registered Parameter "+A},value:b};r._nrpnBuffer[c]=[],this._userHandlers.channel[k.type]&&this._userHandlers.channel[k.type][k.channel]&&this._userHandlers.channel[k.type][k.channel].forEach(function(U){U(k)})}else r._nrpnBuffer[c]=[];else r._nrpnBuffer[c].push(m)}},s.prototype._parseChannelEvent=function(t){var i,a,l=t.data[0]>>4,c=1+(15&t.data[0]);1<t.data.length&&(i=t.data[1],a=2<t.data.length?t.data[2]:void 0);var f={target:this,data:t.data,timestamp:t.timeStamp,channel:c};l===r.MIDI_CHANNEL_MESSAGES.noteoff||l===r.MIDI_CHANNEL_MESSAGES.noteon&&a===0?(f.type="noteoff",f.note={number:i,name:r._notes[i%12],octave:r.getOctave(i)},f.velocity=a/127,f.rawVelocity=a):l===r.MIDI_CHANNEL_MESSAGES.noteon?(f.type="noteon",f.note={number:i,name:r._notes[i%12],octave:r.getOctave(i)},f.velocity=a/127,f.rawVelocity=a):l===r.MIDI_CHANNEL_MESSAGES.keyaftertouch?(f.type="keyaftertouch",f.note={number:i,name:r._notes[i%12],octave:r.getOctave(i)},f.value=a/127):l===r.MIDI_CHANNEL_MESSAGES.controlchange&&0<=i&&i<=119?(f.type="controlchange",f.controller={number:i,name:this.getCcNameByNumber(i)},f.value=a):l===r.MIDI_CHANNEL_MESSAGES.channelmode&&120<=i&&i<=127?(f.type="channelmode",f.controller={number:i,name:this.getChannelModeByNumber(i)},f.value=a):l===r.MIDI_CHANNEL_MESSAGES.programchange?(f.type="programchange",f.value=i):l===r.MIDI_CHANNEL_MESSAGES.channelaftertouch?(f.type="channelaftertouch",f.value=i/127):l===r.MIDI_CHANNEL_MESSAGES.pitchbend?(f.type="pitchbend",f.value=((a<<7)+i-8192)/8192):f.type="unknownchannelmessage",this._userHandlers.channel[f.type]&&this._userHandlers.channel[f.type][c]&&this._userHandlers.channel[f.type][c].forEach(function(m){m(f)})},s.prototype.getCcNameByNumber=function(t){if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var i in r.MIDI_CONTROL_CHANGE_MESSAGES)if(r.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(i)&&t===r.MIDI_CONTROL_CHANGE_MESSAGES[i])return i},s.prototype.getChannelModeByNumber=function(t){if(!(120<=(t=Math.floor(t))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var i in r.MIDI_CHANNEL_MODE_MESSAGES)if(r.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(i)&&t===r.MIDI_CHANNEL_MODE_MESSAGES[i])return i},s.prototype._parseSystemEvent=function(t){var i=t.data[0],a={target:this,data:t.data,timestamp:t.timeStamp};i===r.MIDI_SYSTEM_MESSAGES.sysex?a.type="sysex":i===r.MIDI_SYSTEM_MESSAGES.timecode?a.type="timecode":i===r.MIDI_SYSTEM_MESSAGES.songposition?a.type="songposition":i===r.MIDI_SYSTEM_MESSAGES.songselect?(a.type="songselect",a.song=t.data[1]):i===r.MIDI_SYSTEM_MESSAGES.tuningrequest?a.type="tuningrequest":i===r.MIDI_SYSTEM_MESSAGES.clock?a.type="clock":i===r.MIDI_SYSTEM_MESSAGES.start?a.type="start":i===r.MIDI_SYSTEM_MESSAGES.continue?a.type="continue":i===r.MIDI_SYSTEM_MESSAGES.stop?a.type="stop":i===r.MIDI_SYSTEM_MESSAGES.activesensing?a.type="activesensing":i===r.MIDI_SYSTEM_MESSAGES.reset?a.type="reset":a.type="unknownsystemmessage",this._userHandlers.system[a.type]&&this._userHandlers.system[a.type].forEach(function(l){l(a)})},u.prototype.send=function(t,i,a){if(!(128<=t&&t<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");i===void 0&&(i=[]),Array.isArray(i)||(i=[i]);var l=[];return i.forEach(function(c){var f=Math.floor(c);if(!(0<=f&&f<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");l.push(f)}),this._midiOutput.send([t].concat(l),parseFloat(a)||0),this},u.prototype.sendSysex=function(t,i,a){if(!r.sysexEnabled)throw new Error("Sysex message support must first be activated.");return a=a||{},t=[].concat(t),i.forEach(function(l){if(l<0||127<l)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),i=t.concat(i,r.MIDI_SYSTEM_MESSAGES.sysexend),this.send(r.MIDI_SYSTEM_MESSAGES.sysex,i,this._parseTimeParameter(a.time)),this},u.prototype.sendTimecodeQuarterFrame=function(t,i){return i=i||{},this.send(r.MIDI_SYSTEM_MESSAGES.timecode,t,this._parseTimeParameter(i.time)),this},u.prototype.sendSongPosition=function(t,i){i=i||{};var a=(t=Math.floor(t)||0)>>7&127,l=127&t;return this.send(r.MIDI_SYSTEM_MESSAGES.songposition,[a,l],this._parseTimeParameter(i.time)),this},u.prototype.sendSongSelect=function(t,i){if(i=i||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(r.MIDI_SYSTEM_MESSAGES.songselect,[t],this._parseTimeParameter(i.time)),this},u.prototype.sendTuningRequest=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendClock=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendStart=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendContinue=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendStop=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(t.time)),this},u.prototype.sendActiveSensing=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(t.time)),this},u.prototype.sendReset=function(t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(t.time)),this},u.prototype.stopNote=function(t,i,a){if(t==="all")return this.sendChannelMode("allnotesoff",0,i,a);var l=64;return(a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(l=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(l=127*a.velocity),this._convertNoteToArray(t).forEach(function(c){r.toMIDIChannels(i).forEach(function(f){this.send((r.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(f-1),[c,Math.round(l)],this._parseTimeParameter(a.time))}.bind(this))}.bind(this)),this},u.prototype.playNote=function(t,i,a){var l,c=64;if((a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(c=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(c=127*a.velocity),l=this._parseTimeParameter(a.time),this._convertNoteToArray(t).forEach(function(m){r.toMIDIChannels(i).forEach(function(y){this.send((r.MIDI_CHANNEL_MESSAGES.noteon<<4)+(y-1),[m,Math.round(c)],l)}.bind(this))}.bind(this)),!isNaN(a.duration)){a.duration<=0&&(a.duration=0);var f=64;a.rawVelocity?!isNaN(a.release)&&0<=a.release&&a.release<=127&&(f=a.release):!isNaN(a.release)&&0<=a.release&&a.release<=1&&(f=127*a.release),this._convertNoteToArray(t).forEach(function(m){r.toMIDIChannels(i).forEach(function(y){this.send((r.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(y-1),[m,Math.round(f)],(l||r.time)+a.duration)}.bind(this))}.bind(this))}return this},u.prototype.sendKeyAftertouch=function(t,i,a,l){var c=this;if(l=l||{},i<1||16<i)throw new RangeError("The channel must be between 1 and 16.");(isNaN(a)||a<0||1<a)&&(a=.5);var f=Math.round(127*a);return this._convertNoteToArray(t).forEach(function(m){r.toMIDIChannels(i).forEach(function(y){c.send((r.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(y-1),[m,f],c._parseTimeParameter(l.time))})}),this},u.prototype.sendControlChange=function(t,i,a,l){if(l=l||{},typeof t=="string"){if((t=r.MIDI_CONTROL_CHANGE_MESSAGES[t])===void 0)throw new TypeError("Invalid controller name.")}else if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("Controller value must be between 0 and 127.");return r.toMIDIChannels(a).forEach(function(c){this.send((r.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(c-1),[t,i],this._parseTimeParameter(l.time))}.bind(this)),this},u.prototype._selectRegisteredParameter=function(t,i,a){var l=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return r.toMIDIChannels(i).forEach(function(){l.sendControlChange(101,t[0],i,{time:a}),l.sendControlChange(100,t[1],i,{time:a})}),this},u.prototype._selectNonRegisteredParameter=function(t,i,a){var l=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return r.toMIDIChannels(i).forEach(function(){l.sendControlChange(99,t[0],i,{time:a}),l.sendControlChange(98,t[1],i,{time:a})}),this},u.prototype._setCurrentRegisteredParameter=function(t,i,a){var l=this;if((t=[].concat(t))[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return r.toMIDIChannels(i).forEach(function(){l.sendControlChange(6,t[0],i,{time:a})}),t[1]=Math.floor(t[1]),0<=t[1]&&t[1]<=127&&r.toMIDIChannels(i).forEach(function(){l.sendControlChange(38,t[1],i,{time:a})}),this},u.prototype._deselectRegisteredParameter=function(t,i){var a=this;return r.toMIDIChannels(t).forEach(function(){a.sendControlChange(101,127,t,{time:i}),a.sendControlChange(100,127,t,{time:i})}),this},u.prototype.setRegisteredParameter=function(t,i,a,l){var c=this;if(l=l||{},!Array.isArray(t)){if(!r.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=r.MIDI_REGISTERED_PARAMETER[t]}return r.toMIDIChannels(a).forEach(function(){c._selectRegisteredParameter(t,a,l.time),c._setCurrentRegisteredParameter(i,a,l.time),c._deselectRegisteredParameter(a,l.time)}),this},u.prototype.setNonRegisteredParameter=function(t,i,a,l){var c=this;if(l=l||{},!(0<=t[0]&&t[0]<=127&&0<=t[1]&&t[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return i=[].concat(i),r.toMIDIChannels(a).forEach(function(){c._selectNonRegisteredParameter(t,a,l.time),c._setCurrentRegisteredParameter(i,a,l.time),c._deselectRegisteredParameter(a,l.time)}),this},u.prototype.incrementRegisteredParameter=function(t,i,a){var l=this;if(a=a||{},!Array.isArray(t)){if(!r.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=r.MIDI_REGISTERED_PARAMETER[t]}return r.toMIDIChannels(i).forEach(function(){l._selectRegisteredParameter(t,i,a.time),l.sendControlChange(96,0,i,{time:a.time}),l._deselectRegisteredParameter(i,a.time)}),this},u.prototype.decrementRegisteredParameter=function(t,i,a){if(a=a||{},!Array.isArray(t)){if(!r.MIDI_REGISTERED_PARAMETER[t])throw new TypeError("The specified parameter is not available.");t=r.MIDI_REGISTERED_PARAMETER[t]}return r.toMIDIChannels(i).forEach(function(){this._selectRegisteredParameter(t,i,a.time),this.sendControlChange(97,0,i,{time:a.time}),this._deselectRegisteredParameter(i,a.time)}.bind(this)),this},u.prototype.setPitchBendRange=function(t,i,a,l){var c=this;if(l=l||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return r.toMIDIChannels(a).forEach(function(){c.setRegisteredParameter("pitchbendrange",[t,i],a,{time:l.time})}),this},u.prototype.setModulationRange=function(t,i,a,l){var c=this;if(l=l||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return r.toMIDIChannels(a).forEach(function(){c.setRegisteredParameter("modulationrange",[t,i],a,{time:l.time})}),this},u.prototype.setMasterTuning=function(t,i,a){var l=this;if(a=a||{},(t=parseFloat(t)||0)<=-65||64<=t)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var c=Math.floor(t)+64,f=t-Math.floor(t),m=(f=Math.round((f+1)/2*16383))>>7&127,y=127&f;return r.toMIDIChannels(i).forEach(function(){l.setRegisteredParameter("channelcoarsetuning",c,i,{time:a.time}),l.setRegisteredParameter("channelfinetuning",[m,y],i,{time:a.time})}),this},u.prototype.setTuningProgram=function(t,i,a){var l=this;if(a=a||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The program value must be between 0 and 127");return r.toMIDIChannels(i).forEach(function(){l.setRegisteredParameter("tuningprogram",t,i,{time:a.time})}),this},u.prototype.setTuningBank=function(t,i,a){var l=this;if(a=a||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The bank value must be between 0 and 127");return r.toMIDIChannels(i).forEach(function(){l.setRegisteredParameter("tuningbank",t,i,{time:a.time})}),this},u.prototype.sendChannelMode=function(t,i,a,l){if(l=l||{},typeof t=="string"){if(!(t=r.MIDI_CHANNEL_MODE_MESSAGES[t]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(t=Math.floor(t))&&t<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((i=Math.floor(i)||0)<0||127<i)throw new RangeError("Value must be an integer between 0 and 127.");return r.toMIDIChannels(a).forEach(function(c){this.send((r.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(c-1),[t,i],this._parseTimeParameter(l.time))}.bind(this)),this},u.prototype.sendProgramChange=function(t,i,a){var l=this;if(a=a||{},t=Math.floor(t),isNaN(t)||t<0||127<t)throw new RangeError("Program numbers must be between 0 and 127.");return r.toMIDIChannels(i).forEach(function(c){l.send((r.MIDI_CHANNEL_MESSAGES.programchange<<4)+(c-1),[t],l._parseTimeParameter(a.time))}),this},u.prototype.sendChannelAftertouch=function(t,i,a){var l=this;a=a||{},t=parseFloat(t),(isNaN(t)||t<0||1<t)&&(t=.5);var c=Math.round(127*t);return r.toMIDIChannels(i).forEach(function(f){l.send((r.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(f-1),[c],l._parseTimeParameter(a.time))}),this},u.prototype.sendPitchBend=function(t,i,a){var l=this;if(a=a||{},isNaN(t)||t<-1||1<t)throw new RangeError("Pitch bend value must be between -1 and 1.");var c=Math.round((t+1)/2*16383),f=c>>7&127,m=127&c;return r.toMIDIChannels(i).forEach(function(y){l.send((r.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(y-1),[m,f],l._parseTimeParameter(a.time))}),this},u.prototype._parseTimeParameter=function(t){var i,a=parseFloat(t);return typeof t=="string"&&t.substring(0,1)==="+"?a&&0<a&&(i=r.time+a):a>r.time&&(i=a),i},u.prototype._convertNoteToArray=function(t){var i=[];return Array.isArray(t)||(t=[t]),t.forEach(function(a){i.push(r.guessNoteNumber(a))}),i},o.exports?o.exports=r:e.WebMidi||(e.WebMidi=r)})(St)})(Xe);var wt=Xe.exports,je={exports:{}};(function(o){(function(e,n,r){if(!e)return;for(var s={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},i={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},a,l=1;l<20;++l)s[111+l]="f"+l;for(l=0;l<=9;++l)s[l+96]=l.toString();function c(_,g,C){if(_.addEventListener){_.addEventListener(g,C,!1);return}_.attachEvent("on"+g,C)}function f(_){if(_.type=="keypress"){var g=String.fromCharCode(_.which);return _.shiftKey||(g=g.toLowerCase()),g}return s[_.which]?s[_.which]:u[_.which]?u[_.which]:String.fromCharCode(_.which).toLowerCase()}function m(_,g){return _.sort().join(",")===g.sort().join(",")}function y(_){var g=[];return _.shiftKey&&g.push("shift"),_.altKey&&g.push("alt"),_.ctrlKey&&g.push("ctrl"),_.metaKey&&g.push("meta"),g}function A(_){if(_.preventDefault){_.preventDefault();return}_.returnValue=!1}function b(_){if(_.stopPropagation){_.stopPropagation();return}_.cancelBubble=!0}function x(_){return _=="shift"||_=="ctrl"||_=="alt"||_=="meta"}function k(){if(!a){a={};for(var _ in s)_>95&&_<112||s.hasOwnProperty(_)&&(a[s[_]]=_)}return a}function U(_,g,C){return C||(C=k()[_]?"keydown":"keypress"),C=="keypress"&&g.length&&(C="keydown"),C}function B(_){return _==="+"?["+"]:(_=_.replace(/\+{2}/g,"+plus"),_.split("+"))}function Y(_,g){var C,D,p,v=[];for(C=B(_),p=0;p<C.length;++p)D=C[p],i[D]&&(D=i[D]),g&&g!="keypress"&&t[D]&&(D=t[D],v.push("shift")),x(D)&&v.push(D);return g=U(D,v,g),{key:D,modifiers:v,action:g}}function K(_,g){return _===null||_===n?!1:_===g?!0:K(_.parentNode,g)}function H(_){var g=this;if(_=_||n,!(g instanceof H))return new H(_);g.target=_,g._callbacks={},g._directMap={};var C={},D,p=!1,v=!1,E=!1;function w(S){S=S||{};var I=!1,R;for(R in C){if(S[R]){I=!0;continue}C[R]=0}I||(E=!1)}function O(S,I,R,M,P,X){var N,G,re=[],ee=R.type;if(!g._callbacks[S])return[];for(ee=="keyup"&&x(S)&&(I=[S]),N=0;N<g._callbacks[S].length;++N)if(G=g._callbacks[S][N],!(!M&&G.seq&&C[G.seq]!=G.level)&&ee==G.action&&(ee=="keypress"&&!R.metaKey&&!R.ctrlKey||m(I,G.modifiers))){var Nt=!M&&G.combo==P,Rt=M&&G.seq==M&&G.level==X;(Nt||Rt)&&g._callbacks[S].splice(N,1),re.push(G)}return re}function q(S,I,R,M){g.stopCallback(I,I.target||I.srcElement,R,M)||S(I,R)===!1&&(A(I),b(I))}g._handleKey=function(S,I,R){var M=O(S,I,R),P,X={},N=0,G=!1;for(P=0;P<M.length;++P)M[P].seq&&(N=Math.max(N,M[P].level));for(P=0;P<M.length;++P){if(M[P].seq){if(M[P].level!=N)continue;G=!0,X[M[P].seq]=1,q(M[P].callback,R,M[P].combo,M[P].seq);continue}G||q(M[P].callback,R,M[P].combo)}var re=R.type=="keypress"&&v;R.type==E&&!x(S)&&!re&&w(X),v=G&&R.type=="keydown"};function W(S){typeof S.which!="number"&&(S.which=S.keyCode);var I=f(S);if(!!I){if(S.type=="keyup"&&p===I){p=!1;return}g.handleKey(I,y(S),S)}}function he(){clearTimeout(D),D=setTimeout(w,1e3)}function Ne(S,I,R,M){C[S]=0;function P(ee){return function(){E=ee,++C[S],he()}}function X(ee){q(R,ee,S),M!=="keyup"&&(p=f(ee)),setTimeout(w,10)}for(var N=0;N<I.length;++N){var G=N+1===I.length,re=G?X:P(M||Y(I[N+1]).action);be(I[N],re,M,S,N)}}function be(S,I,R,M,P){g._directMap[S+":"+R]=I,S=S.replace(/\s+/g," ");var X=S.split(" "),N;if(X.length>1){Ne(S,X,I,R);return}N=Y(S,R),g._callbacks[N.key]=g._callbacks[N.key]||[],O(N.key,N.modifiers,{type:N.action},M,S,P),g._callbacks[N.key][M?"unshift":"push"]({callback:I,modifiers:N.modifiers,action:N.action,seq:M,level:P,combo:S})}g._bindMultiple=function(S,I,R){for(var M=0;M<S.length;++M)be(S[M],I,R)},c(_,"keypress",W),c(_,"keydown",W),c(_,"keyup",W)}H.prototype.bind=function(_,g,C){var D=this;return _=_ instanceof Array?_:[_],D._bindMultiple.call(D,_,g,C),D},H.prototype.unbind=function(_,g){var C=this;return C.bind.call(C,_,function(){},g)},H.prototype.trigger=function(_,g){var C=this;return C._directMap[_+":"+g]&&C._directMap[_+":"+g]({},_),C},H.prototype.reset=function(){var _=this;return _._callbacks={},_._directMap={},_},H.prototype.stopCallback=function(_,g){var C=this;if((" "+g.className+" ").indexOf(" mousetrap ")>-1||K(g,C.target))return!1;if("composedPath"in _&&typeof _.composedPath=="function"){var D=_.composedPath()[0];D!==_.target&&(g=D)}return g.tagName=="INPUT"||g.tagName=="SELECT"||g.tagName=="TEXTAREA"||g.isContentEditable},H.prototype.handleKey=function(){var _=this;return _._handleKey.apply(_,arguments)},H.addKeycodes=function(_){for(var g in _)_.hasOwnProperty(g)&&(s[g]=_[g]);a=null},H.init=function(){var _=H(n);for(var g in _)g.charAt(0)!=="_"&&(H[g]=function(C){return function(){return _[C].apply(_,arguments)}}(g))},H.init(),e.Mousetrap=H,o.exports&&(o.exports=H),typeof r=="function"&&r.amd&&r(function(){return H})})(typeof window!="undefined"?window:null,typeof window!="undefined"?document:null)})(je);var Je=je.exports,Ct=function(){var o=document.getSelection();if(!o.rangeCount)return function(){};for(var e=document.activeElement,n=[],r=0;r<o.rangeCount;r++)n.push(o.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return o.removeAllRanges(),function(){o.type==="Caret"&&o.removeAllRanges(),o.rangeCount||n.forEach(function(s){o.addRange(s)}),e&&e.focus()}},At=Ct,Qe={"text/plain":"Text","text/html":"Url",default:"Text"},Mt="Copy to clipboard: #{key}, Enter";function xt(o){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return o.replace(/#{\s*key\s*}/g,e)}function It(o,e){var n,r,s,u,t,i,a=!1;e||(e={}),n=e.debug||!1;try{s=At(),u=document.createRange(),t=document.getSelection(),i=document.createElement("span"),i.textContent=o,i.style.all="unset",i.style.position="fixed",i.style.top=0,i.style.clip="rect(0, 0, 0, 0)",i.style.whiteSpace="pre",i.style.webkitUserSelect="text",i.style.MozUserSelect="text",i.style.msUserSelect="text",i.style.userSelect="text",i.addEventListener("copy",function(c){if(c.stopPropagation(),e.format)if(c.preventDefault(),typeof c.clipboardData=="undefined"){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var f=Qe[e.format]||Qe.default;window.clipboardData.setData(f,o)}else c.clipboardData.clearData(),c.clipboardData.setData(e.format,o);e.onCopy&&(c.preventDefault(),e.onCopy(c.clipboardData))}),document.body.appendChild(i),u.selectNodeContents(i),t.addRange(u);var l=document.execCommand("copy");if(!l)throw new Error("copy command was unsuccessful");a=!0}catch(c){n&&console.error("unable to copy using execCommand: ",c),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",o),e.onCopy&&e.onCopy(window.clipboardData),a=!0}catch(f){n&&console.error("unable to copy using clipboardData: ",f),n&&console.error("falling back to prompt"),r=xt("message"in e?e.message:Mt),window.prompt(r,o)}}finally{t&&(typeof t.removeRange=="function"?t.removeRange(u):t.removeAllRanges()),i&&document.body.removeChild(i),s()}return a}var Tt=It;return function(o){let e=Object.assign({},{enabled:!0,gui:new qe.GUI,midiPerColor:4,midi:!0,colors:["#ee907b","#2ed9c3","#4888f5","#aa82ff"]},o);const n={"Midi Fighter Twister":{sync:(p,v,E)=>{p.sendControlChange(v,E,1),p.sendControlChange(v,47,6)},clear:(p,v)=>{p.sendControlChange(v,0,1),p.sendControlChange(v,20,6)},configure:()=>{e.connectMidiRange(0,15)}},"nanoKONTROL2 CTRL":{configure:()=>{e.connectMidiRange(16,23),e.connectMidiRange(0,7)}}};let r=[],s=e.gui,u=[],t={},i=!1,a=!1,l=null,c=null;const f=function(){m(),y(),A(),b(),Y()},m=function(){!e.midi||(c=new Promise(p=>{navigator.requestMIDIAccess&&(l=wt,l.enable(E=>{E?console.error("WebMIDI is not supported in this browser."):(console.log("MIDI devices successfully connected."),K(),p(l))},!0))}).catch(p=>{console.error(p)}))},y=function(){document.addEventListener("keydown",({keyCode:p})=>{p===18&&(i=!0)}),document.addEventListener("keyup",({keyCode:p})=>{p===18&&(i=!1)}),document.addEventListener("keyup",({keyCode:p})=>{p===17&&e.toggle()})},A=()=>{const p=`
      <div class="gui-save__inner">
        <span class="gui-save__close">&times;</span>
        <p class="gui-save__clipboard-notification">This code has been saved to your clipboard.</p>
        <textarea
          class="gui-save__textarea"
          name="gui-save-text"
          id="gui-save-text"
          autocomplete="off" autocapitalize="off" spellcheck="false"
        ></textarea>
      </div>
    `,v=document.querySelector("body"),E=document.createElement("div");E.classList.add("gui-save"),E.innerHTML=p,v.appendChild(E),v.insertBefore(E,null),v.insertBefore(E,v.childNodes[0]||null)},b=()=>{Je.bind("alt+s",x),Je.bind("esc",B),document.querySelector(".gui-save__close").addEventListener("click",B)},x=()=>{let p=e._getAggregatedSettings();p=JSON.stringify(p,null,1),p.replace(/\\"/g,"\uFFFF"),p=p.replace(/"([^"]+)":/g,"$1:").replace(/\uFFFF/g,'\\"'),p.replace(/"/g,"'"),document.querySelector(".gui-save__textarea").value=p,k(),U()},k=()=>{document.querySelector(".gui-save").classList.add("is-visible")},U=()=>{Tt(document.querySelector(".gui-save__textarea").value);const p=document.querySelector(".gui-save__clipboard-notification");p.classList.add("is-visible"),window.setTimeout(()=>{p.classList.remove("is-visible")},2e3)},B=()=>{document.querySelector(".gui-save").classList.remove("is-visible")},Y=function(){let p=document.createElement("style");p.type="text/css",p.appendChild(document.createTextNode(`
      .dg.ac {
        z-index: 9999;
      }

      .gui-save {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        background-color: rgba(255, 255, 255, 0.1);
        z-index: 999;
      }

      .gui-save *, .gui-save *:before, .gui-save *:after {
        box-sizing: inherit;
      }

      .gui-save.is-visible {
        display: flex;
      }

      .gui-save__inner {
        position: relative;
        width: 100%;
        max-width: 400px;
        margin: 20px;
      }

      .gui-save__textarea {
        appearance: none;
        border-radius: 5px;
        border: none;
        background-color: #1f1f1f;
        width: 100%;
        height: 300px;
        padding: 25px 23px;
        border-left: 4px solid #5887da;
        font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
        font-size: 14px;
        line-height: 1.5;
        font-weight: normal;
        color: white;
        transition: border-color 0.2s;
      }

      .gui-save__textarea:focus {
        outline: none;
        border-color: #ee907b;
      }

      .gui-save__clipboard-notification {
        font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
        font-size: 13px;
        pointer-events: none;
        position: absolute;
        bottom: -45px;
        left: 0;
        right: 0;
        opacity: 0;
        color: #5887da;
        transition: opacity 0.4s;
      }

      .gui-save__clipboard-notification.is-visible {
        opacity: 1;
      }

      .gui-save__close {
        position: absolute;
        width: 35px;
        height: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 0;
        right: 0;
        z-index: 1;
        font-size: 18px;
        cursor: pointer;
        color: #fff;
      }

      .gui-save__close:active {
        opacity: 0.7;
      }
    `)),document.querySelector("head").appendChild(p)},K=function(){l.inputs.forEach(p=>{p.addListener("midimessage","all",H)})},H=function(p){let[v,E,w]=p.data;i&&console.log(`command: ${v} / note: ${E} / velocity: ${w}`),_(E,w),g(E,w)},_=function(p,v){const E=u.indexOf(p);if(E<0)return;const w=e._getNumericControllerAtIndex(E);if(!w)return;const{__min:O,__max:q,__step:W}=w,he=W||(q-O)/127,Ne=e._mapRange(0,127,O,q,v),be=e._snap(he.toFixed(5),Ne);w.setValue(be)},g=function(p,v){t[p]&&t[p].call(e,v)},C=()=>r.length?r:[e.gui],D=function(){e.getControllers(!1).forEach((v,E)=>{const w=Math.floor(E/e.midiPerColor),O=e.colors[w],W=v.domElement.closest(".cr.number.has-slider");if(W){W.style.borderLeftColor=`${O}`;const he=W.querySelector(".slider-fg");he.style.backgroundColor=`${O}`}})};return e._mapRange=function(p,v,E,w,O){return(O-p)*(w-E)/(v-p)+E},e._snap=function(p,v){return Math.round(v/p)*p},e._getNumericControllerAtIndex=function(p,v=!1){const w=e.getControllers(v)[p];return typeof w!="undefined"&&typeof w.min!="undefined"&&typeof w.max!="undefined"?w:null},e._getAggregatedSettings=function(){return C().reduce((v,E)=>(v[E.name]=E.__controllers.reduce((w,O)=>(w[O.property]=O.getValue(),w),{}),v),{})},e._controllerValueToMidi=function(p){const v=p.getValue(),E=p.__min,w=p.__max,O=e._mapRange(E,w,1,127,v);return Math.round(O)},e.add=function(...p){const v=s.add.apply(s,p);return D(),e.syncMidi(),v},e.addColor=function(...p){return s.addColor.apply(s,p)},e.setFolder=function(p){const v=e.gui.addFolder(p);return r.push(v),s=v,v},e.getControllers=function(p=!1){const v=C();return(p?v.filter(w=>!w.closed):v).reduce((w,O)=>w.concat(O.__controllers),[])},e.removeFolder=function(p){const v=r.findIndex(E=>E.name===p.name);r.splice(v,1),e.gui.removeFolder(p),s=e.gui},e.connectMidiRange=function(p,v){for(var E=p,w=v+1;E<w;E++)u.push(E)},e.addControl=function(p,v){t[p]=v},e.destroy=function(){e.gui.destroy(),l&&(l.inputs.forEach(p=>{p.removeListener("midimessage","all")}),l.disable())},e.clear=function(){e.gui.destroy(),e.gui=new qe.GUI,s=e.gui,t={}},e.hide=function(){a=!0,e.gui.hide()},e.show=function(){a=!1,e.gui.show()},e.toggle=function(){a=!a,a?e.hide():e.show()},e.update=function(){e.getControllers().forEach(p=>{p.updateDisplay()})},e.configureDevice=function(p){const v=n[p];if(!v||!v.configure)return console.warn(`No built-in configuration is available for "${p}"`);v.configure()},e.syncMidi=function(){!l||u.forEach((p,v)=>{const E=e._getNumericControllerAtIndex(v);c.then(()=>{l.outputs.forEach(w=>{const O=n[w.name];if(!!O)if(E){const q=e._controllerValueToMidi(E);O.sync&&O.sync(w,p,q)}else O.clear&&O.clear(w,p)})})})},f(),e}});
